{"ast":null,"code":"/**\r\n * DevExtreme (ui/collection/ui.collection_widget.base.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _events_engine = require(\"../../events/core/events_engine\");\nvar _events_engine2 = _interopRequireDefault(_events_engine);\nvar _common = require(\"../../core/utils/common\");\nvar _common2 = _interopRequireDefault(_common);\nvar _dom = require(\"../../core/utils/dom\");\nvar _dom_adapter = require(\"../../core/dom_adapter\");\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\nvar _type = require(\"../../core/utils/type\");\nvar _deferred = require(\"../../core/utils/deferred\");\nvar _extend = require(\"../../core/utils/extend\");\nvar _array = require(\"../../core/utils/array\");\nvar _iterator = require(\"../../core/utils/iterator\");\nvar _iterator2 = _interopRequireDefault(_iterator);\nvar _action = require(\"../../core/action\");\nvar _action2 = _interopRequireDefault(_action);\nvar _guid = require(\"../../core/guid\");\nvar _guid2 = _interopRequireDefault(_guid);\nvar _ui = require(\"../widget/ui.widget\");\nvar _ui2 = _interopRequireDefault(_ui);\nvar _utils = require(\"../../events/utils\");\nvar _utils2 = _interopRequireDefault(_utils);\nvar _pointer = require(\"../../events/pointer\");\nvar _pointer2 = _interopRequireDefault(_pointer);\nvar _data_helper = require(\"../../data_helper\");\nvar _data_helper2 = _interopRequireDefault(_data_helper);\nvar _item = require(\"./item\");\nvar _item2 = _interopRequireDefault(_item);\nvar _selectors = require(\"../widget/selectors\");\nvar _selectors2 = _interopRequireDefault(_selectors);\nvar _message = require(\"../../localization/message\");\nvar _message2 = _interopRequireDefault(_message);\nvar _hold = require(\"../../events/hold\");\nvar _hold2 = _interopRequireDefault(_hold);\nvar _data = require(\"../../core/utils/data\");\nvar _click = require(\"../../events/click\");\nvar _click2 = _interopRequireDefault(_click);\nvar _contextmenu = require(\"../../events/contextmenu\");\nvar _contextmenu2 = _interopRequireDefault(_contextmenu);\nvar _bindable_template = require(\"../../core/templates/bindable_template\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar COLLECTION_CLASS = \"dx-collection\";\nvar ITEM_CLASS = \"dx-item\";\nvar CONTENT_CLASS_POSTFIX = \"-content\";\nvar ITEM_CONTENT_PLACEHOLDER_CLASS = \"dx-item-content-placeholder\";\nvar ITEM_DATA_KEY = \"dxItemData\";\nvar ITEM_INDEX_KEY = \"dxItemIndex\";\nvar ITEM_TEMPLATE_ID_PREFIX = \"tmpl-\";\nvar ITEMS_SELECTOR = \"[data-options*='dxItem']\";\nvar SELECTED_ITEM_CLASS = \"dx-item-selected\";\nvar ITEM_RESPONSE_WAIT_CLASS = \"dx-item-response-wait\";\nvar EMPTY_COLLECTION = \"dx-empty-collection\";\nvar TEMPLATE_WRAPPER_CLASS = \"dx-template-wrapper\";\nvar ITEM_PATH_REGEX = /^([^.]+\\[\\d+\\]\\.)+([\\w.]+)$/;\nvar FOCUS_UP = \"up\";\nvar FOCUS_DOWN = \"down\";\nvar FOCUS_LEFT = \"left\";\nvar FOCUS_RIGHT = \"right\";\nvar FOCUS_PAGE_UP = \"pageup\";\nvar FOCUS_PAGE_DOWN = \"pagedown\";\nvar FOCUS_LAST = \"last\";\nvar FOCUS_FIRST = \"first\";\nvar CollectionWidget = _ui2.default.inherit({\n  _activeStateUnit: \".\" + ITEM_CLASS,\n  _supportedKeys: function _supportedKeys() {\n    var enter = function enter(e) {\n        var $itemElement = (0, _renderer2.default)(this.option(\"focusedElement\"));\n        if (!$itemElement.length) {\n          return;\n        }\n        this._itemClickHandler((0, _extend.extend)({}, e, {\n          target: $itemElement,\n          currentTarget: $itemElement\n        }));\n      },\n      space = function space(e) {\n        e.preventDefault();\n        enter.call(this, e);\n      },\n      move = function move(location, e) {\n        e.preventDefault();\n        e.stopPropagation();\n        this._moveFocus(location, e);\n      };\n    return (0, _extend.extend)(this.callBase(), {\n      space: space,\n      enter: enter,\n      leftArrow: move.bind(this, FOCUS_LEFT),\n      rightArrow: move.bind(this, FOCUS_RIGHT),\n      upArrow: move.bind(this, FOCUS_UP),\n      downArrow: move.bind(this, FOCUS_DOWN),\n      pageUp: move.bind(this, FOCUS_UP),\n      pageDown: move.bind(this, FOCUS_DOWN),\n      home: move.bind(this, FOCUS_FIRST),\n      end: move.bind(this, FOCUS_LAST)\n    });\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      selectOnFocus: false,\n      loopItemFocus: true,\n      items: [],\n      itemTemplate: \"item\",\n      onItemRendered: null,\n      onItemClick: null,\n      onItemHold: null,\n      itemHoldTimeout: 750,\n      onItemContextMenu: null,\n      onFocusedItemChanged: null,\n      noDataText: _message2.default.format(\"dxCollectionWidget-noDataText\"),\n      dataSource: null,\n      _itemAttributes: {},\n      itemTemplateProperty: \"template\",\n      focusOnSelectedItem: true,\n      focusedElement: null,\n      displayExpr: void 0,\n      disabledExpr: function disabledExpr(data) {\n        return data ? data.disabled : void 0;\n      },\n      visibleExpr: function visibleExpr(data) {\n        return data ? data.visible : void 0;\n      }\n    });\n  },\n  _getAnonymousTemplateName: function _getAnonymousTemplateName() {\n    return \"item\";\n  },\n  _init: function _init() {\n    this._compileDisplayGetter();\n    this.callBase();\n    this._cleanRenderedItems();\n    this._refreshDataSource();\n  },\n  _compileDisplayGetter: function _compileDisplayGetter() {\n    var displayExpr = this.option(\"displayExpr\");\n    this._displayGetter = displayExpr ? (0, _data.compileGetter)(this.option(\"displayExpr\")) : void 0;\n  },\n  _initTemplates: function _initTemplates() {\n    this._initItemsFromMarkup();\n    this.callBase();\n    this._initDefaultItemTemplate();\n  },\n  _initDefaultItemTemplate: function _initDefaultItemTemplate() {\n    var fieldsMap = this._getFieldsMap();\n    this._defaultTemplates.item = new _bindable_template.BindableTemplate(function ($container, data) {\n      if ((0, _type.isPlainObject)(data)) {\n        this._prepareDefaultItemTemplate(data, $container);\n      } else {\n        if (fieldsMap && (0, _type.isFunction)(fieldsMap.text)) {\n          data = fieldsMap.text(data);\n        }\n        $container.text(String(_common2.default.ensureDefined(data, \"\")));\n      }\n    }.bind(this), this._getBindableFields(), this.option(\"integrationOptions.watchMethod\"), fieldsMap);\n  },\n  _getBindableFields: function _getBindableFields() {\n    return [\"text\", \"html\"];\n  },\n  _getFieldsMap: function _getFieldsMap() {\n    if (this._displayGetter) {\n      return {\n        text: this._displayGetter\n      };\n    }\n  },\n  _prepareDefaultItemTemplate: function _prepareDefaultItemTemplate(data, $container) {\n    if (data.text) {\n      $container.text(data.text);\n    }\n    if (data.html) {\n      $container.html(data.html);\n    }\n  },\n  _initItemsFromMarkup: function _initItemsFromMarkup() {\n    var _this = this;\n    var $items = this.$element().contents().filter(ITEMS_SELECTOR);\n    if (!$items.length || this.option(\"items\").length) {\n      return;\n    }\n    var items = [].slice.call($items).map(function (item) {\n      var $item = (0, _renderer2.default)(item);\n      var result = (0, _dom.getElementOptions)(item).dxItem;\n      var isTemplateRequired = $item.html().trim() && !result.template;\n      if (isTemplateRequired) {\n        result.template = _this._prepareItemTemplate($item);\n      } else {\n        $item.remove();\n      }\n      return result;\n    });\n    this.option(\"items\", items);\n  },\n  _prepareItemTemplate: function _prepareItemTemplate($item) {\n    var templateId = ITEM_TEMPLATE_ID_PREFIX + new _guid2.default();\n    var $template = $item.detach().clone().removeAttr(\"data-options\").addClass(TEMPLATE_WRAPPER_CLASS);\n    this._saveTemplate(templateId, $template);\n    return templateId;\n  },\n  _dataSourceOptions: function _dataSourceOptions() {\n    return {\n      paginate: false\n    };\n  },\n  _cleanRenderedItems: function _cleanRenderedItems() {\n    this._renderedItemsCount = 0;\n  },\n  _focusTarget: function _focusTarget() {\n    return this.$element();\n  },\n  _focusInHandler: function _focusInHandler(e) {\n    this.callBase.apply(this, arguments);\n    if ((0, _array.inArray)(e.target, this._focusTarget()) === -1) {\n      return;\n    }\n    var $focusedElement = (0, _renderer2.default)(this.option(\"focusedElement\"));\n    if ($focusedElement.length) {\n      this._setFocusedItem($focusedElement);\n    } else {\n      var $activeItem = this._getActiveItem();\n      if ($activeItem.length) {\n        this.option(\"focusedElement\", (0, _dom.getPublicElement)($activeItem));\n      }\n    }\n  },\n  _focusOutHandler: function _focusOutHandler() {\n    this.callBase.apply(this, arguments);\n    var $target = (0, _renderer2.default)(this.option(\"focusedElement\"));\n    if ($target.length) {\n      this._toggleFocusClass(false, $target);\n    }\n  },\n  _getActiveItem: function _getActiveItem(last) {\n    var $focusedElement = (0, _renderer2.default)(this.option(\"focusedElement\"));\n    if ($focusedElement.length) {\n      return $focusedElement;\n    }\n    var index = this.option(\"focusOnSelectedItem\") ? this.option(\"selectedIndex\") : 0;\n    var activeElements = this._getActiveElement();\n    var lastIndex = activeElements.length - 1;\n    if (index < 0) {\n      index = last ? lastIndex : 0;\n    }\n    return activeElements.eq(index);\n  },\n  _renderFocusTarget: function _renderFocusTarget() {\n    this.callBase.apply(this, arguments);\n    this._refreshActiveDescendant();\n  },\n  _moveFocus: function _moveFocus(location) {\n    var $newTarget,\n      $items = this._getAvailableItems();\n    switch (location) {\n      case FOCUS_PAGE_UP:\n      case FOCUS_UP:\n        $newTarget = this._prevItem($items);\n        break;\n      case FOCUS_PAGE_DOWN:\n      case FOCUS_DOWN:\n        $newTarget = this._nextItem($items);\n        break;\n      case FOCUS_RIGHT:\n        $newTarget = this.option(\"rtlEnabled\") ? this._prevItem($items) : this._nextItem($items);\n        break;\n      case FOCUS_LEFT:\n        $newTarget = this.option(\"rtlEnabled\") ? this._nextItem($items) : this._prevItem($items);\n        break;\n      case FOCUS_FIRST:\n        $newTarget = $items.first();\n        break;\n      case FOCUS_LAST:\n        $newTarget = $items.last();\n        break;\n      default:\n        return false;\n    }\n    if (0 !== $newTarget.length) {\n      this.option(\"focusedElement\", (0, _dom.getPublicElement)($newTarget));\n    }\n  },\n  _getVisibleItems: function _getVisibleItems($itemElements) {\n    $itemElements = $itemElements || this._itemElements();\n    return $itemElements.filter(\":visible\");\n  },\n  _getAvailableItems: function _getAvailableItems($itemElements) {\n    return this._getVisibleItems($itemElements).not(\".dx-state-disabled\");\n  },\n  _prevItem: function _prevItem($items) {\n    var $target = this._getActiveItem(),\n      targetIndex = $items.index($target),\n      $last = $items.last(),\n      $item = (0, _renderer2.default)($items[targetIndex - 1]),\n      loop = this.option(\"loopItemFocus\");\n    if (0 === $item.length && loop) {\n      $item = $last;\n    }\n    return $item;\n  },\n  _nextItem: function _nextItem($items) {\n    var $target = this._getActiveItem(true),\n      targetIndex = $items.index($target),\n      $first = $items.first(),\n      $item = (0, _renderer2.default)($items[targetIndex + 1]),\n      loop = this.option(\"loopItemFocus\");\n    if (0 === $item.length && loop) {\n      $item = $first;\n    }\n    return $item;\n  },\n  _selectFocusedItem: function _selectFocusedItem($target) {\n    this.selectItem($target);\n  },\n  _removeFocusedItem: function _removeFocusedItem(target) {\n    var $target = (0, _renderer2.default)(target);\n    if ($target.length) {\n      this._toggleFocusClass(false, $target);\n      $target.removeAttr(\"id\");\n    }\n  },\n  _refreshActiveDescendant: function _refreshActiveDescendant() {\n    this.setAria(\"activedescendant\", \"\");\n    this.setAria(\"activedescendant\", this.getFocusedItemId());\n  },\n  _setFocusedItem: function _setFocusedItem($target) {\n    if (!$target || !$target.length) {\n      return;\n    }\n    $target.attr(\"id\", this.getFocusedItemId());\n    this._toggleFocusClass(true, $target);\n    this.onFocusedItemChanged(this.getFocusedItemId());\n    this._refreshActiveDescendant();\n    if (this.option(\"selectOnFocus\")) {\n      this._selectFocusedItem($target);\n    }\n  },\n  _findItemElementByItem: function _findItemElementByItem(item) {\n    var result = (0, _renderer2.default)(),\n      that = this;\n    this.itemElements().each(function () {\n      var $item = (0, _renderer2.default)(this);\n      if ($item.data(that._itemDataKey()) === item) {\n        result = $item;\n        return false;\n      }\n    });\n    return result;\n  },\n  _getIndexByItem: function _getIndexByItem(item) {\n    return this.option(\"items\").indexOf(item);\n  },\n  _itemOptionChanged: function _itemOptionChanged(item, property, value, oldValue) {\n    var $item = this._findItemElementByItem(item);\n    if (!$item.length) {\n      return;\n    }\n    if (!this.constructor.ItemClass.getInstance($item).setDataField(property, value)) {\n      this._refreshItem($item, item);\n    }\n    var isDisabling = \"disabled\" === property && value;\n    if (isDisabling && $item.is(this.option(\"focusedElement\"))) {\n      this.option(\"focusedElement\", null);\n    }\n  },\n  _refreshItem: function _refreshItem($item) {\n    var itemData = this._getItemData($item),\n      index = $item.data(this._itemIndexKey());\n    this._renderItem(this._renderedItemsCount + index, itemData, null, $item);\n  },\n  _optionChanged: function _optionChanged(args) {\n    if (\"items\" === args.name) {\n      var matches = args.fullName.match(ITEM_PATH_REGEX);\n      if (matches && matches.length) {\n        var property = matches[matches.length - 1],\n          itemPath = args.fullName.replace(\".\" + property, \"\"),\n          item = this.option(itemPath);\n        this._itemOptionChanged(item, property, args.value, args.previousValue);\n        return;\n      }\n    }\n    switch (args.name) {\n      case \"items\":\n      case \"_itemAttributes\":\n      case \"itemTemplateProperty\":\n      case \"showItemDataTitle\":\n        this._cleanRenderedItems();\n        this._invalidate();\n        break;\n      case \"dataSource\":\n        this._refreshDataSource();\n        this._renderEmptyMessage();\n        break;\n      case \"noDataText\":\n        this._renderEmptyMessage();\n        break;\n      case \"itemTemplate\":\n        this._invalidate();\n        break;\n      case \"onItemRendered\":\n        this._createItemRenderAction();\n        break;\n      case \"onItemClick\":\n        break;\n      case \"onItemHold\":\n      case \"itemHoldTimeout\":\n        this._attachHoldEvent();\n        break;\n      case \"onItemContextMenu\":\n        this._attachContextMenuEvent();\n        break;\n      case \"onFocusedItemChanged\":\n        this.onFocusedItemChanged = this._createActionByOption(\"onFocusedItemChanged\");\n        break;\n      case \"selectOnFocus\":\n      case \"loopItemFocus\":\n      case \"focusOnSelectedItem\":\n        break;\n      case \"focusedElement\":\n        this._removeFocusedItem(args.previousValue);\n        this._setFocusedItem((0, _renderer2.default)(args.value));\n        break;\n      case \"displayExpr\":\n        this._compileDisplayGetter();\n        this._initDefaultItemTemplate();\n        this._invalidate();\n        break;\n      case \"visibleExpr\":\n      case \"disabledExpr\":\n        this._invalidate();\n        break;\n      default:\n        this.callBase(args);\n    }\n  },\n  _invalidate: function _invalidate() {\n    this.option(\"focusedElement\", null);\n    return this.callBase.apply(this, arguments);\n  },\n  _loadNextPage: function _loadNextPage() {\n    var dataSource = this._dataSource;\n    this._expectNextPageLoading();\n    dataSource.pageIndex(1 + dataSource.pageIndex());\n    return dataSource.load();\n  },\n  _expectNextPageLoading: function _expectNextPageLoading() {\n    this._startIndexForAppendedItems = 0;\n  },\n  _expectLastItemLoading: function _expectLastItemLoading() {\n    this._startIndexForAppendedItems = -1;\n  },\n  _forgetNextPageLoading: function _forgetNextPageLoading() {\n    this._startIndexForAppendedItems = null;\n  },\n  _dataSourceChangedHandler: function _dataSourceChangedHandler(newItems) {\n    var items = this.option(\"items\");\n    if (this._initialized && items && this._shouldAppendItems()) {\n      this._renderedItemsCount = items.length;\n      if (!this._isLastPage() || this._startIndexForAppendedItems !== -1) {\n        this.option().items = items.concat(newItems.slice(this._startIndexForAppendedItems));\n      }\n      this._forgetNextPageLoading();\n      this._refreshContent();\n      this._renderFocusTarget();\n    } else {\n      this.option(\"items\", newItems.slice());\n    }\n  },\n  _refreshContent: function _refreshContent() {\n    this._prepareContent();\n    this._renderContent();\n  },\n  _dataSourceLoadErrorHandler: function _dataSourceLoadErrorHandler() {\n    this._forgetNextPageLoading();\n    this.option(\"items\", this.option(\"items\"));\n  },\n  _shouldAppendItems: function _shouldAppendItems() {\n    return null != this._startIndexForAppendedItems && this._allowDynamicItemsAppend();\n  },\n  _allowDynamicItemsAppend: function _allowDynamicItemsAppend() {\n    return false;\n  },\n  _clean: function _clean() {\n    this._cleanFocusState();\n    this._cleanItemContainer();\n  },\n  _cleanItemContainer: function _cleanItemContainer() {\n    (0, _renderer2.default)(this._itemContainer()).empty();\n  },\n  _dispose: function _dispose() {\n    this.callBase();\n    clearTimeout(this._itemFocusTimeout);\n  },\n  _refresh: function _refresh() {\n    this._cleanRenderedItems();\n    this.callBase.apply(this, arguments);\n  },\n  _itemContainer: function _itemContainer() {\n    return this.$element();\n  },\n  _itemClass: function _itemClass() {\n    return ITEM_CLASS;\n  },\n  _itemContentClass: function _itemContentClass() {\n    return this._itemClass() + CONTENT_CLASS_POSTFIX;\n  },\n  _selectedItemClass: function _selectedItemClass() {\n    return SELECTED_ITEM_CLASS;\n  },\n  _itemResponseWaitClass: function _itemResponseWaitClass() {\n    return ITEM_RESPONSE_WAIT_CLASS;\n  },\n  _itemSelector: function _itemSelector() {\n    return \".\" + this._itemClass();\n  },\n  _itemDataKey: function _itemDataKey() {\n    return ITEM_DATA_KEY;\n  },\n  _itemIndexKey: function _itemIndexKey() {\n    return ITEM_INDEX_KEY;\n  },\n  _itemElements: function _itemElements() {\n    return this._itemContainer().find(this._itemSelector());\n  },\n  _initMarkup: function _initMarkup() {\n    this.callBase();\n    this.onFocusedItemChanged = this._createActionByOption(\"onFocusedItemChanged\");\n    this.$element().addClass(COLLECTION_CLASS);\n    this._prepareContent();\n  },\n  _prepareContent: _common2.default.deferRenderer(function () {\n    this._renderContentImpl();\n  }),\n  _renderContent: function _renderContent() {\n    this._fireContentReadyAction();\n  },\n  _render: function _render() {\n    this.callBase();\n    this._attachClickEvent();\n    this._attachHoldEvent();\n    this._attachContextMenuEvent();\n  },\n  _attachClickEvent: function _attachClickEvent() {\n    var itemSelector = this._itemSelector(),\n      clickEventNamespace = _utils2.default.addNamespace(_click2.default.name, this.NAME),\n      pointerDownEventNamespace = _utils2.default.addNamespace(_pointer2.default.down, this.NAME),\n      that = this;\n    var pointerDownAction = new _action2.default(function (args) {\n      var event = args.event;\n      that._itemPointerDownHandler(event);\n    });\n    _events_engine2.default.off(this._itemContainer(), clickEventNamespace, itemSelector);\n    _events_engine2.default.off(this._itemContainer(), pointerDownEventNamespace, itemSelector);\n    _events_engine2.default.on(this._itemContainer(), clickEventNamespace, itemSelector, function (e) {\n      this._itemClickHandler(e);\n    }.bind(this));\n    _events_engine2.default.on(this._itemContainer(), pointerDownEventNamespace, itemSelector, function (e) {\n      pointerDownAction.execute({\n        element: (0, _renderer2.default)(e.target),\n        event: e\n      });\n    });\n  },\n  _itemClickHandler: function _itemClickHandler(e, args, config) {\n    this._itemDXEventHandler(e, \"onItemClick\", args, config);\n  },\n  _itemPointerDownHandler: function _itemPointerDownHandler(e) {\n    if (!this.option(\"focusStateEnabled\")) {\n      return;\n    }\n    this._itemFocusHandler = function () {\n      clearTimeout(this._itemFocusTimeout);\n      this._itemFocusHandler = null;\n      if (e.isDefaultPrevented()) {\n        return;\n      }\n      var $target = (0, _renderer2.default)(e.target),\n        $closestItem = $target.closest(this._itemElements()),\n        $closestFocusable = this._closestFocusable($target);\n      if ($closestItem.length && $closestFocusable && (0, _array.inArray)($closestFocusable.get(0), this._focusTarget()) !== -1) {\n        this.option(\"focusedElement\", (0, _dom.getPublicElement)($closestItem));\n      }\n    }.bind(this);\n    this._itemFocusTimeout = setTimeout(this._forcePointerDownFocus.bind(this));\n  },\n  _closestFocusable: function _closestFocusable($target) {\n    if ($target.is(_selectors2.default.focusable)) {\n      return $target;\n    } else {\n      $target = $target.parent();\n      while ($target.length && !_dom_adapter2.default.isDocument($target.get(0))) {\n        if ($target.is(_selectors2.default.focusable)) {\n          return $target;\n        }\n        $target = $target.parent();\n      }\n    }\n  },\n  _forcePointerDownFocus: function _forcePointerDownFocus() {\n    this._itemFocusHandler && this._itemFocusHandler();\n  },\n  _updateFocusState: function _updateFocusState() {\n    this.callBase.apply(this, arguments);\n    this._forcePointerDownFocus();\n  },\n  _attachHoldEvent: function _attachHoldEvent() {\n    var $itemContainer = this._itemContainer(),\n      itemSelector = this._itemSelector(),\n      eventName = _utils2.default.addNamespace(_hold2.default.name, this.NAME);\n    _events_engine2.default.off($itemContainer, eventName, itemSelector);\n    _events_engine2.default.on($itemContainer, eventName, itemSelector, {\n      timeout: this._getHoldTimeout()\n    }, this._itemHoldHandler.bind(this));\n  },\n  _getHoldTimeout: function _getHoldTimeout() {\n    return this.option(\"itemHoldTimeout\");\n  },\n  _shouldFireHoldEvent: function _shouldFireHoldEvent() {\n    return this.hasActionSubscription(\"onItemHold\");\n  },\n  _itemHoldHandler: function _itemHoldHandler(e) {\n    if (this._shouldFireHoldEvent()) {\n      this._itemDXEventHandler(e, \"onItemHold\");\n    } else {\n      e.cancel = true;\n    }\n  },\n  _attachContextMenuEvent: function _attachContextMenuEvent() {\n    var $itemContainer = this._itemContainer(),\n      itemSelector = this._itemSelector(),\n      eventName = _utils2.default.addNamespace(_contextmenu2.default.name, this.NAME);\n    _events_engine2.default.off($itemContainer, eventName, itemSelector);\n    _events_engine2.default.on($itemContainer, eventName, itemSelector, this._itemContextMenuHandler.bind(this));\n  },\n  _shouldFireContextMenuEvent: function _shouldFireContextMenuEvent() {\n    return this.hasActionSubscription(\"onItemContextMenu\");\n  },\n  _itemContextMenuHandler: function _itemContextMenuHandler(e) {\n    if (this._shouldFireContextMenuEvent()) {\n      this._itemDXEventHandler(e, \"onItemContextMenu\");\n    } else {\n      e.cancel = true;\n    }\n  },\n  _renderContentImpl: function _renderContentImpl() {\n    var items = this.option(\"items\") || [];\n    if (this._renderedItemsCount) {\n      this._renderItems(items.slice(this._renderedItemsCount));\n    } else {\n      this._renderItems(items);\n    }\n  },\n  _renderItems: function _renderItems(items) {\n    if (items.length) {\n      _iterator2.default.each(items, function (index, itemData) {\n        this._renderItem(this._renderedItemsCount + index, itemData);\n      }.bind(this));\n    }\n    this._renderEmptyMessage();\n  },\n  _renderItem: function _renderItem(index, itemData, $container, $itemToReplace) {\n    $container = $container || this._itemContainer();\n    var $itemFrame = this._renderItemFrame(index, itemData, $container, $itemToReplace);\n    this._setElementData($itemFrame, itemData, index);\n    $itemFrame.attr(this.option(\"_itemAttributes\"));\n    this._attachItemClickEvent(itemData, $itemFrame);\n    var $itemContent = this._getItemContent($itemFrame);\n    var renderContentPromise = this._renderItemContent({\n      index: index,\n      itemData: itemData,\n      container: (0, _dom.getPublicElement)($itemContent),\n      contentClass: this._itemContentClass(),\n      defaultTemplateName: this.option(\"itemTemplate\")\n    });\n    var that = this;\n    (0, _deferred.when)(renderContentPromise).done(function ($itemContent) {\n      that._postprocessRenderItem({\n        itemElement: $itemFrame,\n        itemContent: $itemContent,\n        itemData: itemData,\n        itemIndex: index\n      });\n      that._executeItemRenderAction(index, itemData, (0, _dom.getPublicElement)($itemFrame));\n    });\n    return $itemFrame;\n  },\n  _getItemContent: function _getItemContent($itemFrame) {\n    var $itemContent = $itemFrame.find(\".\" + ITEM_CONTENT_PLACEHOLDER_CLASS);\n    $itemContent.removeClass(ITEM_CONTENT_PLACEHOLDER_CLASS);\n    return $itemContent;\n  },\n  _attachItemClickEvent: function _attachItemClickEvent(itemData, $itemElement) {\n    if (!itemData || !itemData.onClick) {\n      return;\n    }\n    _events_engine2.default.on($itemElement, _click2.default.name, function (e) {\n      this._itemEventHandlerByHandler($itemElement, itemData.onClick, {\n        event: e\n      });\n    }.bind(this));\n  },\n  _renderItemContent: function _renderItemContent(args) {\n    var itemTemplateName = this._getItemTemplateName(args);\n    var itemTemplate = this._getTemplate(itemTemplateName);\n    this._addItemContentClasses(args);\n    var $templateResult = (0, _renderer2.default)(this._createItemByTemplate(itemTemplate, args));\n    if (!$templateResult.hasClass(TEMPLATE_WRAPPER_CLASS)) {\n      return args.container;\n    }\n    return this._renderItemContentByNode(args, $templateResult);\n  },\n  _renderItemContentByNode: function _renderItemContentByNode(args, $node) {\n    (0, _renderer2.default)(args.container).replaceWith($node);\n    args.container = (0, _dom.getPublicElement)($node);\n    this._addItemContentClasses(args);\n    return $node;\n  },\n  _addItemContentClasses: function _addItemContentClasses(args) {\n    var classes = [ITEM_CLASS + CONTENT_CLASS_POSTFIX, args.contentClass];\n    (0, _renderer2.default)(args.container).addClass(classes.join(\" \"));\n  },\n  _appendItemToContainer: function _appendItemToContainer($container, $itemFrame, index) {\n    $itemFrame.appendTo($container);\n  },\n  _renderItemFrame: function _renderItemFrame(index, itemData, $container, $itemToReplace) {\n    var $itemFrame = (0, _renderer2.default)(\"<div>\");\n    new this.constructor.ItemClass($itemFrame, this._itemOptions(), itemData || {});\n    if ($itemToReplace && $itemToReplace.length) {\n      $itemToReplace.replaceWith($itemFrame);\n    } else {\n      this._appendItemToContainer.call(this, $container, $itemFrame, index);\n    }\n    if (this.option(\"showItemDataTitle\")) {\n      var displayValue = this._displayGetter ? this._displayGetter(itemData) : itemData;\n      $itemFrame.attr(\"title\", displayValue);\n    }\n    return $itemFrame;\n  },\n  _itemOptions: function _itemOptions() {\n    var that = this;\n    return {\n      watchMethod: function watchMethod() {\n        return that.option(\"integrationOptions.watchMethod\");\n      },\n      fieldGetter: function fieldGetter(field) {\n        var expr = that.option(field + \"Expr\"),\n          getter = (0, _data.compileGetter)(expr);\n        return getter;\n      }\n    };\n  },\n  _postprocessRenderItem: _common2.default.noop,\n  _executeItemRenderAction: function _executeItemRenderAction(index, itemData, itemElement) {\n    this._getItemRenderAction()({\n      itemElement: itemElement,\n      itemIndex: index,\n      itemData: itemData\n    });\n  },\n  _setElementData: function _setElementData(element, data, index) {\n    element.addClass([ITEM_CLASS, this._itemClass()].join(\" \")).data(this._itemDataKey(), data).data(this._itemIndexKey(), index);\n  },\n  _createItemRenderAction: function _createItemRenderAction() {\n    return this._itemRenderAction = this._createActionByOption(\"onItemRendered\", {\n      element: this.element(),\n      excludeValidators: [\"disabled\", \"readOnly\"],\n      category: \"rendering\"\n    });\n  },\n  _getItemRenderAction: function _getItemRenderAction() {\n    return this._itemRenderAction || this._createItemRenderAction();\n  },\n  _getItemTemplateName: function _getItemTemplateName(args) {\n    var data = args.itemData,\n      templateProperty = args.templateProperty || this.option(\"itemTemplateProperty\"),\n      template = data && data[templateProperty];\n    return template || args.defaultTemplateName;\n  },\n  _createItemByTemplate: function _createItemByTemplate(itemTemplate, renderArgs) {\n    return itemTemplate.render({\n      model: renderArgs.itemData,\n      container: renderArgs.container,\n      index: renderArgs.index\n    });\n  },\n  _emptyMessageContainer: function _emptyMessageContainer() {\n    return this._itemContainer();\n  },\n  _renderEmptyMessage: function _renderEmptyMessage(items) {\n    items = items || this.option(\"items\");\n    var noDataText = this.option(\"noDataText\"),\n      hideNoData = !noDataText || items && items.length || this._isDataSourceLoading();\n    if (hideNoData && this._$noData) {\n      this._$noData.remove();\n      this._$noData = null;\n      this.setAria(\"label\", void 0);\n    }\n    if (!hideNoData) {\n      this._$noData = this._$noData || (0, _renderer2.default)(\"<div>\").addClass(\"dx-empty-message\");\n      this._$noData.appendTo(this._emptyMessageContainer()).html(noDataText);\n      this.setAria(\"label\", noDataText);\n    }\n    this.$element().toggleClass(EMPTY_COLLECTION, !hideNoData);\n  },\n  _itemDXEventHandler: function _itemDXEventHandler(dxEvent, handlerOptionName, actionArgs, actionConfig) {\n    this._itemEventHandler(dxEvent.target, handlerOptionName, (0, _extend.extend)(actionArgs, {\n      event: dxEvent\n    }), actionConfig);\n  },\n  _itemEventHandler: function _itemEventHandler(initiator, handlerOptionName, actionArgs, actionConfig) {\n    var action = this._createActionByOption(handlerOptionName, (0, _extend.extend)({\n      validatingTargetName: \"itemElement\"\n    }, actionConfig));\n    return this._itemEventHandlerImpl(initiator, action, actionArgs);\n  },\n  _itemEventHandlerByHandler: function _itemEventHandlerByHandler(initiator, handler, actionArgs, actionConfig) {\n    var action = this._createAction(handler, (0, _extend.extend)({\n      validatingTargetName: \"itemElement\"\n    }, actionConfig));\n    return this._itemEventHandlerImpl(initiator, action, actionArgs);\n  },\n  _itemEventHandlerImpl: function _itemEventHandlerImpl(initiator, action, actionArgs) {\n    var $itemElement = this._closestItemElement((0, _renderer2.default)(initiator)),\n      args = (0, _extend.extend)({}, actionArgs);\n    return action((0, _extend.extend)(actionArgs, this._extendActionArgs($itemElement), args));\n  },\n  _extendActionArgs: function _extendActionArgs($itemElement) {\n    return {\n      itemElement: (0, _dom.getPublicElement)($itemElement),\n      itemIndex: this._itemElements().index($itemElement),\n      itemData: this._getItemData($itemElement)\n    };\n  },\n  _closestItemElement: function _closestItemElement($element) {\n    return (0, _renderer2.default)($element).closest(this._itemSelector());\n  },\n  _getItemData: function _getItemData(itemElement) {\n    return (0, _renderer2.default)(itemElement).data(this._itemDataKey());\n  },\n  _getSummaryItemsWidth: function _getSummaryItemsWidth(items, includeMargin) {\n    var result = 0;\n    if (items) {\n      _iterator2.default.each(items, function (_, item) {\n        result += (0, _renderer2.default)(item).outerWidth(includeMargin || false);\n      });\n    }\n    return result;\n  },\n  getFocusedItemId: function getFocusedItemId() {\n    if (!this._focusedItemId) {\n      this._focusedItemId = \"dx-\" + new _guid2.default();\n    }\n    return this._focusedItemId;\n  },\n  itemElements: function itemElements() {\n    return this._itemElements();\n  },\n  itemsContainer: function itemsContainer() {\n    return this._itemContainer();\n  }\n}).include(_data_helper2.default);\nCollectionWidget.ItemClass = _item2.default;\nmodule.exports = CollectionWidget;","map":null,"metadata":{},"sourceType":"script"}