{"ast":null,"code":"/**\r\n * DevExtreme (core/utils/selection_filter.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar getKeyHash = require(\"./common\").getKeyHash,\n  equalByValue = require(\"./common\").equalByValue,\n  typeUtils = require(\"./type\");\nvar SelectionFilterCreator = function SelectionFilterCreator(selectedItemKeys, isSelectAll) {\n  this.getLocalFilter = function (keyGetter, equalKeys, equalByReference, keyExpr) {\n    equalKeys = void 0 === equalKeys ? equalByValue : equalKeys;\n    return functionFilter.bind(this, equalKeys, keyGetter, equalByReference, keyExpr);\n  };\n  this.getExpr = function (keyExpr) {\n    if (!keyExpr) {\n      return;\n    }\n    var filterExpr;\n    selectedItemKeys.forEach(function (key, index) {\n      filterExpr = filterExpr || [];\n      var filterExprPart;\n      if (index > 0) {\n        filterExpr.push(isSelectAll ? \"and\" : \"or\");\n      }\n      if (typeUtils.isString(keyExpr)) {\n        filterExprPart = getFilterForPlainKey(keyExpr, key);\n      } else {\n        filterExprPart = getFilterForCompositeKey(keyExpr, key);\n      }\n      filterExpr.push(filterExprPart);\n    });\n    if (filterExpr && 1 === filterExpr.length) {\n      filterExpr = filterExpr[0];\n    }\n    return filterExpr;\n  };\n  this.getCombinedFilter = function (keyExpr, dataSourceFilter) {\n    var filterExpr = this.getExpr(keyExpr),\n      combinedFilter = filterExpr;\n    if (isSelectAll && dataSourceFilter) {\n      if (filterExpr) {\n        combinedFilter = [];\n        combinedFilter.push(filterExpr);\n        combinedFilter.push(dataSourceFilter);\n      } else {\n        combinedFilter = dataSourceFilter;\n      }\n    }\n    return combinedFilter;\n  };\n  var selectedItemKeyHashesMap;\n  var getSelectedItemKeyHashesMap = function getSelectedItemKeyHashesMap(selectedItemKeys) {\n    if (!selectedItemKeyHashesMap) {\n      selectedItemKeyHashesMap = {};\n      for (var i = 0; i < selectedItemKeys.length; i++) {\n        selectedItemKeyHashesMap[getKeyHash(selectedItemKeys[i])] = true;\n      }\n    }\n    return selectedItemKeyHashesMap;\n  };\n  var normalizeKeys = function normalizeKeys(keys, keyOf, keyExpr) {\n    return Array.isArray(keyExpr) ? keys.map(function (key) {\n      return keyOf(key);\n    }) : keys;\n  };\n  var functionFilter = function functionFilter(equalKeys, keyOf, equalByReference, keyExpr, item) {\n    var keyHash,\n      i,\n      key = keyOf(item);\n    if (!equalByReference) {\n      keyHash = getKeyHash(key);\n      if (!typeUtils.isObject(keyHash)) {\n        var selectedKeyHashesMap = getSelectedItemKeyHashesMap(normalizeKeys(selectedItemKeys, keyOf, keyExpr));\n        if (selectedKeyHashesMap[keyHash]) {\n          return !isSelectAll;\n        }\n        return !!isSelectAll;\n      }\n    }\n    for (i = 0; i < selectedItemKeys.length; i++) {\n      if (equalKeys(selectedItemKeys[i], key)) {\n        return !isSelectAll;\n      }\n    }\n    return !!isSelectAll;\n  };\n  var getFilterForPlainKey = function getFilterForPlainKey(keyExpr, keyValue) {\n    if (void 0 === keyValue) {\n      return;\n    }\n    return [keyExpr, isSelectAll ? \"<>\" : \"=\", keyValue];\n  };\n  var getFilterForCompositeKey = function getFilterForCompositeKey(keyExpr, itemKeyValue) {\n    var filterExpr = [];\n    for (var i = 0, length = keyExpr.length; i < length; i++) {\n      var currentKeyExpr = keyExpr[i],\n        currentKeyValue = itemKeyValue && itemKeyValue[currentKeyExpr],\n        filterExprPart = getFilterForPlainKey(currentKeyExpr, currentKeyValue);\n      if (!filterExprPart) {\n        break;\n      }\n      if (i > 0) {\n        filterExpr.push(isSelectAll ? \"or\" : \"and\");\n      }\n      filterExpr.push(filterExprPart);\n    }\n    return filterExpr;\n  };\n};\nexports.SelectionFilterCreator = SelectionFilterCreator;","map":null,"metadata":{},"sourceType":"script"}