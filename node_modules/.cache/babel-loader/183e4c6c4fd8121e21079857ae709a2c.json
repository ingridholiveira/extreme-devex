{"ast":null,"code":"/**\r\n * DevExtreme (ui/editor/editor.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _element_data = require(\"../../core/element_data\");\nvar _element_data2 = _interopRequireDefault(_element_data);\nvar _callbacks = require(\"../../core/utils/callbacks\");\nvar _callbacks2 = _interopRequireDefault(_callbacks);\nvar _common = require(\"../../core/utils/common\");\nvar _common2 = _interopRequireDefault(_common);\nvar _window = require(\"../../core/utils/window\");\nvar _window2 = _interopRequireDefault(_window);\nvar _position = require(\"../../core/utils/position\");\nvar _extend = require(\"../../core/utils/extend\");\nvar _guid = require(\"../../core/guid\");\nvar _guid2 = _interopRequireDefault(_guid);\nvar _ui = require(\"../widget/ui.widget\");\nvar _ui2 = _interopRequireDefault(_ui);\nvar _validation_mixin = require(\"../validation/validation_mixin\");\nvar _validation_mixin2 = _interopRequireDefault(_validation_mixin);\nvar _overlay = require(\"../overlay\");\nvar _overlay2 = _interopRequireDefault(_overlay);\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar READONLY_STATE_CLASS = \"dx-state-readonly\",\n  INVALID_CLASS = \"dx-invalid\",\n  INVALID_MESSAGE = \"dx-invalid-message\",\n  INVALID_MESSAGE_CONTENT = \"dx-invalid-message-content\",\n  INVALID_MESSAGE_AUTO = \"dx-invalid-message-auto\",\n  INVALID_MESSAGE_ALWAYS = \"dx-invalid-message-always\",\n  DX_INVALID_BADGE_CLASS = \"dx-show-invalid-badge\",\n  VALIDATION_TARGET = \"dx-validation-target\",\n  VALIDATION_MESSAGE_MIN_WIDTH = 100,\n  VALIDATION_STATUS_VALID = \"valid\",\n  VALIDATION_STATUS_INVALID = \"invalid\";\nvar getValidationErrorMessage = function getValidationErrorMessage(validationErrors) {\n  var validationErrorMessage = \"\";\n  if (validationErrors) {\n    validationErrors.forEach(function (err) {\n      if (err.message) {\n        validationErrorMessage += (validationErrorMessage ? \"<br />\" : \"\") + err.message;\n      }\n    });\n  }\n  return validationErrorMessage;\n};\nvar Editor = _ui2.default.inherit({\n  ctor: function ctor() {\n    this.showValidationMessageTimeout = null;\n    this.callBase.apply(this, arguments);\n  },\n  _initOptions: function _initOptions(options) {\n    this.callBase.apply(this, arguments);\n    this._initValidationOptions(options);\n  },\n  _init: function _init() {\n    this.callBase();\n    this.validationRequest = (0, _callbacks2.default)();\n    this._initInnerOptionCache(\"validationTooltipOptions\");\n    var $element = this.$element();\n    $element.addClass(DX_INVALID_BADGE_CLASS);\n    if ($element) {\n      _element_data2.default.data($element[0], VALIDATION_TARGET, this);\n    }\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      value: null,\n      name: \"\",\n      onValueChanged: null,\n      readOnly: false,\n      isValid: true,\n      validationError: null,\n      validationErrors: null,\n      validationStatus: VALIDATION_STATUS_VALID,\n      validationMessageMode: \"auto\",\n      validationBoundary: void 0,\n      validationMessageOffset: {\n        h: 0,\n        v: 0\n      },\n      validationTooltipOptions: {}\n    });\n  },\n  _attachKeyboardEvents: function _attachKeyboardEvents() {\n    if (this.option(\"readOnly\")) {\n      return;\n    }\n    this.callBase();\n    if (this._keyboardProcessor) {\n      this._attachChildKeyboardEvents();\n    }\n  },\n  _attachChildKeyboardEvents: _common2.default.noop,\n  _setOptionsByReference: function _setOptionsByReference() {\n    this.callBase();\n    (0, _extend.extend)(this._optionsByReference, {\n      validationError: true\n    });\n  },\n  _createValueChangeAction: function _createValueChangeAction() {\n    this._valueChangeAction = this._createActionByOption(\"onValueChanged\", {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n  },\n  _suppressValueChangeAction: function _suppressValueChangeAction() {\n    this._valueChangeActionSuppressed = true;\n  },\n  _resumeValueChangeAction: function _resumeValueChangeAction() {\n    this._valueChangeActionSuppressed = false;\n  },\n  _initMarkup: function _initMarkup() {\n    this._toggleReadOnlyState();\n    this._setSubmitElementName(this.option(\"name\"));\n    this.callBase();\n    this._renderValidationState();\n  },\n  _raiseValueChangeAction: function _raiseValueChangeAction(value, previousValue) {\n    if (!this._valueChangeAction) {\n      this._createValueChangeAction();\n    }\n    this._valueChangeAction(this._valueChangeArgs(value, previousValue));\n  },\n  _valueChangeArgs: function _valueChangeArgs(value, previousValue) {\n    return {\n      value: value,\n      previousValue: previousValue,\n      event: this._valueChangeEventInstance\n    };\n  },\n  _saveValueChangeEvent: function _saveValueChangeEvent(e) {\n    this._valueChangeEventInstance = e;\n  },\n  _focusInHandler: function _focusInHandler(e) {\n    var _this = this;\n    var isValidationMessageShownOnFocus = \"auto\" === this.option(\"validationMessageMode\");\n    if (this._canValueBeChangedByClick() && isValidationMessageShownOnFocus) {\n      this._$validationMessage && this._$validationMessage.removeClass(INVALID_MESSAGE_AUTO);\n      clearTimeout(this.showValidationMessageTimeout);\n      this.showValidationMessageTimeout = setTimeout(function () {\n        return _this._$validationMessage && _this._$validationMessage.addClass(INVALID_MESSAGE_AUTO);\n      }, 150);\n    }\n    return this.callBase(e);\n  },\n  _canValueBeChangedByClick: function _canValueBeChangedByClick() {\n    return false;\n  },\n  _renderValidationState: function _renderValidationState() {\n    var isValid = this.option(\"isValid\") && this.option(\"validationStatus\") !== VALIDATION_STATUS_INVALID,\n      validationMessageMode = this.option(\"validationMessageMode\"),\n      $element = this.$element();\n    var validationErrors = this.option(\"validationErrors\");\n    if (!validationErrors && this.option(\"validationError\")) {\n      validationErrors = [this.option(\"validationError\")];\n    }\n    $element.toggleClass(INVALID_CLASS, !isValid);\n    this.setAria(VALIDATION_STATUS_INVALID, !isValid || void 0);\n    if (!_window2.default.hasWindow()) {\n      return;\n    }\n    if (this._$validationMessage) {\n      this._$validationMessage.remove();\n      this.setAria(\"describedby\", null);\n      this._$validationMessage = null;\n    }\n    var validationErrorMessage = getValidationErrorMessage(validationErrors);\n    if (!isValid && validationErrorMessage) {\n      this._$validationMessage = (0, _renderer2.default)(\"<div>\").addClass(INVALID_MESSAGE).html(validationErrorMessage).appendTo($element);\n      var validationTarget = this._getValidationMessageTarget();\n      this._validationMessage = this._createComponent(this._$validationMessage, _overlay2.default, (0, _extend.extend)({\n        integrationOptions: {},\n        templatesRenderAsynchronously: false,\n        target: validationTarget,\n        shading: false,\n        width: \"auto\",\n        height: \"auto\",\n        container: $element,\n        position: this._getValidationMessagePosition(\"below\"),\n        closeOnOutsideClick: false,\n        closeOnTargetScroll: false,\n        animation: null,\n        visible: true,\n        propagateOutsideClick: true,\n        _checkParentVisibility: false\n      }, this._getInnerOptionsCache(\"validationTooltipOptions\")));\n      this._$validationMessage.toggleClass(INVALID_MESSAGE_AUTO, \"auto\" === validationMessageMode).toggleClass(INVALID_MESSAGE_ALWAYS, \"always\" === validationMessageMode);\n      var messageId = \"dx-\" + new _guid2.default();\n      this._validationMessage.$content().addClass(INVALID_MESSAGE_CONTENT).attr(\"id\", messageId);\n      this.setAria(\"describedby\", messageId);\n      this._setValidationMessageMaxWidth();\n      this._bindInnerWidgetOptions(this._validationMessage, \"validationTooltipOptions\");\n    }\n  },\n  _setValidationMessageMaxWidth: function _setValidationMessageMaxWidth() {\n    if (!this._validationMessage) {\n      return;\n    }\n    if (0 === this._getValidationMessageTarget().outerWidth()) {\n      this._validationMessage.option(\"maxWidth\", \"100%\");\n      return;\n    }\n    var validationMessageMaxWidth = Math.max(VALIDATION_MESSAGE_MIN_WIDTH, this._getValidationMessageTarget().outerWidth());\n    this._validationMessage.option(\"maxWidth\", validationMessageMaxWidth);\n  },\n  _getValidationMessageTarget: function _getValidationMessageTarget() {\n    return this.$element();\n  },\n  _getValidationMessagePosition: function _getValidationMessagePosition(positionRequest) {\n    var rtlEnabled = this.option(\"rtlEnabled\"),\n      messagePositionSide = (0, _position.getDefaultAlignment)(rtlEnabled),\n      messageOriginalOffset = this.option(\"validationMessageOffset\"),\n      messageOffset = {\n        h: messageOriginalOffset.h,\n        v: messageOriginalOffset.v\n      },\n      verticalPositions = \"below\" === positionRequest ? [\" top\", \" bottom\"] : [\" bottom\", \" top\"];\n    if (rtlEnabled) {\n      messageOffset.h = -messageOffset.h;\n    }\n    if (\"below\" !== positionRequest) {\n      messageOffset.v = -messageOffset.v;\n    }\n    return {\n      offset: messageOffset,\n      boundary: this.option(\"validationBoundary\"),\n      my: messagePositionSide + verticalPositions[0],\n      at: messagePositionSide + verticalPositions[1],\n      collision: \"none flip\"\n    };\n  },\n  _toggleReadOnlyState: function _toggleReadOnlyState() {\n    this.$element().toggleClass(READONLY_STATE_CLASS, !!this.option(\"readOnly\"));\n    this.setAria(\"readonly\", this.option(\"readOnly\") || void 0);\n  },\n  _dispose: function _dispose() {\n    var element = this.$element()[0];\n    _element_data2.default.data(element, VALIDATION_TARGET, null);\n    clearTimeout(this.showValidationMessageTimeout);\n    this.callBase();\n  },\n  _setSubmitElementName: function _setSubmitElementName(name) {\n    var $submitElement = this._getSubmitElement();\n    if (!$submitElement) {\n      return;\n    }\n    if (name.length > 0) {\n      $submitElement.attr(\"name\", name);\n    } else {\n      $submitElement.removeAttr(\"name\");\n    }\n  },\n  _getSubmitElement: function _getSubmitElement() {\n    return null;\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"onValueChanged\":\n        this._createValueChangeAction();\n        break;\n      case \"isValid\":\n      case \"validationError\":\n        this._synchronizeValidationOptions(args);\n        break;\n      case \"validationErrors\":\n      case \"validationStatus\":\n        this._synchronizeValidationOptions(args);\n        this._renderValidationState();\n        break;\n      case \"validationBoundary\":\n      case \"validationMessageMode\":\n        this._renderValidationState();\n        break;\n      case \"validationTooltipOptions\":\n        this._innerOptionChanged(this._validationMessage, args);\n        break;\n      case \"readOnly\":\n        this._toggleReadOnlyState();\n        this._refreshFocusState();\n        break;\n      case \"value\":\n        if (!this._valueChangeActionSuppressed) {\n          this._raiseValueChangeAction(args.value, args.previousValue);\n          this._saveValueChangeEvent(void 0);\n        }\n        if (args.value != args.previousValue) {\n          this.validationRequest.fire({\n            value: args.value,\n            editor: this\n          });\n        }\n        break;\n      case \"width\":\n        this.callBase(args);\n        this._setValidationMessageMaxWidth();\n        break;\n      case \"name\":\n        this._setSubmitElementName(args.value);\n        break;\n      default:\n        this.callBase(args);\n    }\n  },\n  reset: function reset() {\n    var defaultOptions = this._getDefaultOptions();\n    this.option(\"value\", defaultOptions.value);\n  }\n}).include(_validation_mixin2.default);\nmodule.exports = Editor;","map":null,"metadata":{},"sourceType":"script"}