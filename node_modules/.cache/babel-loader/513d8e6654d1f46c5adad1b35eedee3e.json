{"ast":null,"code":"/**\r\n * DevExtreme (events/click.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../core/renderer\"),\n  eventsEngine = require(\"../events/core/events_engine\"),\n  devices = require(\"../core/devices\"),\n  domAdapter = require(\"../core/dom_adapter\"),\n  domUtils = require(\"../core/utils/dom\"),\n  animationFrame = require(\"../animation/frame\"),\n  eventUtils = require(\"./utils\"),\n  pointerEvents = require(\"./pointer\"),\n  Emitter = require(\"./core/emitter\"),\n  registerEmitter = require(\"./core/emitter_registrator\"),\n  compareVersions = require(\"../core/utils/version\").compare;\nvar CLICK_EVENT_NAME = \"dxclick\",\n  TOUCH_BOUNDARY = 10,\n  abs = Math.abs;\nvar isInput = function isInput(element) {\n  return $(element).is(\"input, textarea, select, button ,:focus, :focus *\");\n};\nvar misc = {\n  requestAnimationFrame: animationFrame.requestAnimationFrame,\n  cancelAnimationFrame: animationFrame.cancelAnimationFrame\n};\nvar ClickEmitter = Emitter.inherit({\n  ctor: function ctor(element) {\n    this.callBase(element);\n    this._makeElementClickable($(element));\n  },\n  _makeElementClickable: function _makeElementClickable($element) {\n    if (!$element.attr(\"onclick\")) {\n      $element.attr(\"onclick\", \"void(0)\");\n    }\n  },\n  start: function start(e) {\n    this._blurPrevented = e.isDefaultPrevented();\n    this._startTarget = e.target;\n    this._startEventData = eventUtils.eventData(e);\n  },\n  end: function end(e) {\n    if (this._eventOutOfElement(e, this.getElement().get(0)) || e.type === pointerEvents.cancel) {\n      this._cancel(e);\n      return;\n    }\n    if (!isInput(e.target) && !this._blurPrevented) {\n      domUtils.resetActiveElement();\n    }\n    this._accept(e);\n    this._clickAnimationFrame = misc.requestAnimationFrame(function () {\n      this._fireClickEvent(e);\n    }.bind(this));\n  },\n  _eventOutOfElement: function _eventOutOfElement(e, element) {\n    var target = e.target,\n      targetChanged = !domUtils.contains(element, target) && element !== target,\n      gestureDelta = eventUtils.eventDelta(eventUtils.eventData(e), this._startEventData),\n      boundsExceeded = abs(gestureDelta.x) > TOUCH_BOUNDARY || abs(gestureDelta.y) > TOUCH_BOUNDARY;\n    return targetChanged || boundsExceeded;\n  },\n  _fireClickEvent: function _fireClickEvent(e) {\n    this._fireEvent(CLICK_EVENT_NAME, e, {\n      target: domUtils.closestCommonParent(this._startTarget, e.target)\n    });\n  },\n  dispose: function dispose() {\n    misc.cancelAnimationFrame(this._clickAnimationFrame);\n  }\n});\n!function () {\n  var NATIVE_CLICK_CLASS = \"dx-native-click\";\n  var realDevice = devices.real(),\n    useNativeClick = realDevice.generic || realDevice.ios && compareVersions(realDevice.version, [9, 3]) >= 0 || realDevice.android && compareVersions(realDevice.version, [5]) >= 0;\n  var isNativeClickEvent = function isNativeClickEvent(target) {\n    return useNativeClick || $(target).closest(\".\" + NATIVE_CLICK_CLASS).length;\n  };\n  var prevented = null,\n    lastFiredEvent = null;\n  var clickHandler = function clickHandler(e) {\n    var originalEvent = e.originalEvent,\n      eventAlreadyFired = lastFiredEvent === originalEvent || originalEvent && originalEvent.DXCLICK_FIRED,\n      leftButton = !e.which || 1 === e.which;\n    if (leftButton && !prevented && isNativeClickEvent(e.target) && !eventAlreadyFired) {\n      if (originalEvent) {\n        originalEvent.DXCLICK_FIRED = true;\n      }\n      lastFiredEvent = originalEvent;\n      eventUtils.fireEvent({\n        type: CLICK_EVENT_NAME,\n        originalEvent: e\n      });\n    }\n  };\n  ClickEmitter = ClickEmitter.inherit({\n    _makeElementClickable: function _makeElementClickable($element) {\n      if (!isNativeClickEvent($element)) {\n        this.callBase($element);\n      }\n      eventsEngine.on($element, \"click\", clickHandler);\n    },\n    configure: function configure(data) {\n      this.callBase(data);\n      if (data.useNative) {\n        this.getElement().addClass(NATIVE_CLICK_CLASS);\n      }\n    },\n    start: function start(e) {\n      prevented = null;\n      if (!isNativeClickEvent(e.target)) {\n        this.callBase(e);\n      }\n    },\n    end: function end(e) {\n      if (!isNativeClickEvent(e.target)) {\n        this.callBase(e);\n      }\n    },\n    cancel: function cancel() {\n      prevented = true;\n    },\n    dispose: function dispose() {\n      this.callBase();\n      eventsEngine.off(this.getElement(), \"click\", clickHandler);\n    }\n  });\n}();\n!function () {\n  var desktopDevice = devices.real().generic;\n  if (!desktopDevice) {\n    var startTarget = null,\n      blurPrevented = false;\n    var pointerDownHandler = function pointerDownHandler(e) {\n      startTarget = e.target;\n      blurPrevented = e.isDefaultPrevented();\n    };\n    var clickHandler = function clickHandler(e) {\n      var $target = $(e.target);\n      if (!blurPrevented && startTarget && !$target.is(startTarget) && !$(startTarget).is(\"label\") && isInput($target)) {\n        domUtils.resetActiveElement();\n      }\n      startTarget = null;\n      blurPrevented = false;\n    };\n    var NATIVE_CLICK_FIXER_NAMESPACE = \"NATIVE_CLICK_FIXER\",\n      document = domAdapter.getDocument();\n    eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(pointerEvents.down, NATIVE_CLICK_FIXER_NAMESPACE), pointerDownHandler);\n    eventsEngine.subscribeGlobal(document, eventUtils.addNamespace(\"click\", NATIVE_CLICK_FIXER_NAMESPACE), clickHandler);\n  }\n}();\nregisterEmitter({\n  emitter: ClickEmitter,\n  bubble: true,\n  events: [CLICK_EVENT_NAME]\n});\nexports.name = CLICK_EVENT_NAME;","map":null,"metadata":{},"sourceType":"script"}