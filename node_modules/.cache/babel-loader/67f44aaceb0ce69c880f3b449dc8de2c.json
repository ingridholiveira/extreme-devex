{"ast":null,"code":"/*!\n * devextreme-react\n * Version: 19.2.2-beta\n * Build date: Tue Oct 01 2019\n *\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\n *\n * This software may be modified and distributed under the terms\n * of the MIT license. See the LICENSE file in the root of the project for details.\n *\n * https://github.com/DevExpress/devextreme-react\n */\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar comparer_1 = require(\"./configuration/comparer\");\nvar tree_1 = require(\"./configuration/tree\");\nvar utils_1 = require(\"./configuration/utils\");\nvar OptionsManager = /** @class */function () {\n  function OptionsManager(templatesManager) {\n    this._guards = {};\n    this._isUpdating = false;\n    this._templatesManager = templatesManager;\n    this.onOptionChanged = this.onOptionChanged.bind(this);\n    this._wrapOptionValue = this._wrapOptionValue.bind(this);\n  }\n  OptionsManager.prototype.setInstance = function (instance, config) {\n    this._instance = instance;\n    this._currentConfig = config;\n  };\n  OptionsManager.prototype.getInitialOptions = function (rootNode) {\n    var config = tree_1.buildConfig(rootNode, false);\n    for (var _i = 0, _a = Object.keys(config.templates); _i < _a.length; _i++) {\n      var key = _a[_i];\n      this._templatesManager.add(key, config.templates[key]);\n    }\n    var options = {};\n    for (var _b = 0, _c = Object.keys(config.options); _b < _c.length; _b++) {\n      var key = _c[_b];\n      options[key] = this._wrapOptionValue(key, config.options[key]);\n    }\n    if (this._templatesManager.templatesCount > 0) {\n      options.integrationOptions = {\n        templates: this._templatesManager.templates\n      };\n    }\n    return options;\n  };\n  OptionsManager.prototype.update = function (config) {\n    var changes = comparer_1.getChanges(config, this._currentConfig);\n    for (var _i = 0, _a = Object.keys(changes.templates); _i < _a.length; _i++) {\n      var key = _a[_i];\n      this._templatesManager.add(key, changes.templates[key]);\n    }\n    if (this._templatesManager.templatesCount > 0) {\n      this._setValueInTransaction(\"integrationOptions\", {\n        templates: this._templatesManager.templates\n      });\n    }\n    for (var _b = 0, _c = Object.keys(changes.options); _b < _c.length; _b++) {\n      var key = _c[_b];\n      this._setValueInTransaction(key, changes.options[key]);\n    }\n    if (this._isUpdating) {\n      this._isUpdating = false;\n      this._instance.endUpdate();\n    }\n    this._currentConfig = config;\n  };\n  OptionsManager.prototype.onOptionChanged = function (e) {\n    if (this._isUpdating) {\n      return;\n    }\n    var valueDescriptor = tree_1.findValue(this._currentConfig, e.fullName.split(\".\"));\n    if (!valueDescriptor) {\n      return;\n    }\n    var value = valueDescriptor.value,\n      type = valueDescriptor.type;\n    if (type === tree_1.ValueType.Complex) {\n      for (var _i = 0, _a = Object.keys(value); _i < _a.length; _i++) {\n        var key = _a[_i];\n        if (value[key] === null || value[key] === undefined || value[key] === e.value[key]) {\n          continue;\n        }\n        this._setGuard(utils_1.mergeNameParts(e.fullName, key), value[key]);\n      }\n    } else {\n      if (value === null || value === undefined || value === e.value) {\n        return;\n      }\n      this._setGuard(e.fullName, value);\n    }\n  };\n  OptionsManager.prototype.dispose = function () {\n    for (var _i = 0, _a = Object.keys(this._guards); _i < _a.length; _i++) {\n      var optionName = _a[_i];\n      window.clearTimeout(this._guards[optionName]);\n      delete this._guards[optionName];\n    }\n  };\n  OptionsManager.prototype._wrapOptionValue = function (name, value) {\n    var _this = this;\n    if (name.substr(0, 2) === \"on\" && typeof value === \"function\") {\n      return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        if (!_this._isUpdating) {\n          value.apply(void 0, args);\n        }\n      };\n    }\n    return value;\n  };\n  OptionsManager.prototype._setGuard = function (optionName, optionValue) {\n    var _this = this;\n    if (this._guards[optionName] !== undefined) {\n      return;\n    }\n    var guardId = window.setTimeout(function () {\n      _this._setValue(optionName, optionValue);\n      window.clearTimeout(guardId);\n      delete _this._guards[optionName];\n    });\n    this._guards[optionName] = guardId;\n  };\n  OptionsManager.prototype._setValueInTransaction = function (name, value) {\n    if (!this._isUpdating) {\n      this._instance.beginUpdate();\n      this._isUpdating = true;\n    }\n    this._setValue(name, value);\n  };\n  OptionsManager.prototype._setValue = function (name, value) {\n    if (this._guards[name]) {\n      window.clearTimeout(this._guards[name]);\n      delete this._guards[name];\n    }\n    this._instance.option(name, this._wrapOptionValue(name, value));\n  };\n  return OptionsManager;\n}();\nexports.OptionsManager = OptionsManager;","map":null,"metadata":{},"sourceType":"script"}