{"ast":null,"code":"/**\r\n * DevExtreme (core/dom_component.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _events_engine = require(\"../events/core/events_engine\");\nvar _events_engine2 = _interopRequireDefault(_events_engine);\nvar _window = require(\"../core/utils/window\");\nvar _window2 = _interopRequireDefault(_window);\nvar _extend = require(\"./utils/extend\");\nvar _config = require(\"./config\");\nvar _config2 = _interopRequireDefault(_config);\nvar _errors = require(\"./errors\");\nvar _errors2 = _interopRequireDefault(_errors);\nvar _dom = require(\"../core/utils/dom\");\nvar _resize_callbacks = require(\"../core/utils/resize_callbacks\");\nvar _resize_callbacks2 = _interopRequireDefault(_resize_callbacks);\nvar _common = require(\"./utils/common\");\nvar _common2 = _interopRequireDefault(_common);\nvar _iterator = require(\"./utils/iterator\");\nvar _type = require(\"./utils/type\");\nvar _array = require(\"./utils/array\");\nvar _public_component = require(\"./utils/public_component\");\nvar _public_component2 = _interopRequireDefault(_public_component);\nvar _element_data = require(\"./element_data\");\nvar _element_data2 = _interopRequireDefault(_element_data);\nvar _component = require(\"./component\");\nvar _component2 = _interopRequireDefault(_component);\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar abstract = _component2.default.abstract;\nvar RTL_DIRECTION_CLASS = \"dx-rtl\";\nvar VISIBILITY_CHANGE_CLASS = \"dx-visibility-change-handler\";\nvar VISIBILITY_CHANGE_EVENTNAMESPACE = \"VisibilityChange\";\nvar DOMComponent = _component2.default.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      width: void 0,\n      height: void 0,\n      rtlEnabled: (0, _config2.default)().rtlEnabled,\n      elementAttr: {},\n      disabled: false,\n      integrationOptions: {}\n    });\n  },\n  ctor: function ctor(element, options) {\n    this._$element = (0, _renderer2.default)(element);\n    _public_component2.default.attachInstanceToElement(this._$element, this, this._dispose);\n    this.callBase(options);\n  },\n  _getSynchronizableOptionsForCreateComponent: function _getSynchronizableOptionsForCreateComponent() {\n    return [\"rtlEnabled\", \"disabled\", \"templatesRenderAsynchronously\"];\n  },\n  _visibilityChanged: abstract,\n  _dimensionChanged: abstract,\n  _init: function _init() {\n    this.callBase();\n    this._attachWindowResizeCallback();\n  },\n  _setOptionsByDevice: function _setOptionsByDevice(instanceCustomRules) {\n    this.callBase([].concat(this.constructor._classCustomRules || [], instanceCustomRules || []));\n  },\n  _isInitialOptionValue: function _isInitialOptionValue(name) {\n    var isCustomOption = this.constructor._classCustomRules && Object.prototype.hasOwnProperty.call(this._convertRulesToOptions(this.constructor._classCustomRules), name);\n    return !isCustomOption && this.callBase(name);\n  },\n  _attachWindowResizeCallback: function _attachWindowResizeCallback() {\n    if (this._isDimensionChangeSupported()) {\n      var windowResizeCallBack = this._windowResizeCallBack = this._dimensionChanged.bind(this);\n      _resize_callbacks2.default.add(windowResizeCallBack);\n    }\n  },\n  _isDimensionChangeSupported: function _isDimensionChangeSupported() {\n    return this._dimensionChanged !== abstract;\n  },\n  _renderComponent: function _renderComponent() {\n    this._initMarkup();\n    if (_window2.default.hasWindow()) {\n      this._render();\n    }\n  },\n  _initMarkup: function _initMarkup() {\n    this._renderElementAttributes();\n    this._toggleRTLDirection(this.option(\"rtlEnabled\"));\n    this._renderVisibilityChange();\n    this._renderDimensions();\n  },\n  _render: function _render() {\n    this._attachVisibilityChangeHandlers();\n  },\n  _renderElementAttributes: function _renderElementAttributes() {\n    var attributes = (0, _extend.extend)({}, this.option(\"elementAttr\")),\n      classNames = attributes.class;\n    delete attributes.class;\n    this.$element().attr(attributes).addClass(classNames);\n  },\n  _renderVisibilityChange: function _renderVisibilityChange() {\n    if (this._isDimensionChangeSupported()) {\n      this._attachDimensionChangeHandlers();\n    }\n    if (!this._isVisibilityChangeSupported()) {\n      return;\n    }\n    this.$element().addClass(VISIBILITY_CHANGE_CLASS);\n  },\n  _renderDimensions: function _renderDimensions() {\n    var $element = this.$element();\n    var element = $element.get(0);\n    var width = this._getOptionValue(\"width\", element);\n    var height = this._getOptionValue(\"height\", element);\n    if (this._isCssUpdateRequired(element, height, width)) {\n      $element.css({\n        width: width,\n        height: height\n      });\n    }\n  },\n  _isCssUpdateRequired: function _isCssUpdateRequired(element, height, width) {\n    return !!(width || height || element.style.width || element.style.height);\n  },\n  _attachDimensionChangeHandlers: function _attachDimensionChangeHandlers() {\n    var that = this;\n    var resizeEventName = \"dxresize.\" + this.NAME + VISIBILITY_CHANGE_EVENTNAMESPACE;\n    _events_engine2.default.off(that.$element(), resizeEventName);\n    _events_engine2.default.on(that.$element(), resizeEventName, function () {\n      that._dimensionChanged();\n    });\n  },\n  _attachVisibilityChangeHandlers: function _attachVisibilityChangeHandlers() {\n    if (!this._isVisibilityChangeSupported()) {\n      return;\n    }\n    var that = this;\n    var hidingEventName = \"dxhiding.\" + this.NAME + VISIBILITY_CHANGE_EVENTNAMESPACE;\n    var shownEventName = \"dxshown.\" + this.NAME + VISIBILITY_CHANGE_EVENTNAMESPACE;\n    that._isHidden = !that._isVisible();\n    _events_engine2.default.off(that.$element(), hidingEventName);\n    _events_engine2.default.on(that.$element(), hidingEventName, function () {\n      that._checkVisibilityChanged(\"hiding\");\n    });\n    _events_engine2.default.off(that.$element(), shownEventName);\n    _events_engine2.default.on(that.$element(), shownEventName, function () {\n      that._checkVisibilityChanged(\"shown\");\n    });\n  },\n  _isVisible: function _isVisible() {\n    return this.$element().is(\":visible\");\n  },\n  _checkVisibilityChanged: function _checkVisibilityChanged(event) {\n    if (\"hiding\" === event && this._isVisible() && !this._isHidden) {\n      this._visibilityChanged(false);\n      this._isHidden = true;\n    } else {\n      if (\"shown\" === event && this._isVisible() && this._isHidden) {\n        this._isHidden = false;\n        this._visibilityChanged(true);\n      }\n    }\n  },\n  _isVisibilityChangeSupported: function _isVisibilityChangeSupported() {\n    return this._visibilityChanged !== abstract && _window2.default.hasWindow();\n  },\n  _clean: _common2.default.noop,\n  _modelByElement: function _modelByElement() {\n    var modelByElement = this.option(\"modelByElement\") || _common2.default.noop;\n    return modelByElement(this.$element());\n  },\n  _invalidate: function _invalidate() {\n    if (!this._updateLockCount) {\n      throw _errors2.default.Error(\"E0007\");\n    }\n    this._requireRefresh = true;\n  },\n  _refresh: function _refresh() {\n    this._clean();\n    this._renderComponent();\n  },\n  _dispose: function _dispose() {\n    this.callBase();\n    this._clean();\n    this._detachWindowResizeCallback();\n  },\n  _detachWindowResizeCallback: function _detachWindowResizeCallback() {\n    if (this._isDimensionChangeSupported()) {\n      _resize_callbacks2.default.remove(this._windowResizeCallBack);\n    }\n  },\n  _toggleRTLDirection: function _toggleRTLDirection(rtl) {\n    this.$element().toggleClass(RTL_DIRECTION_CLASS, rtl);\n  },\n  _createComponent: function _createComponent(element, component, config) {\n    var _this = this;\n    var that = this;\n    config = config || {};\n    var synchronizableOptions = _common2.default.grep(this._getSynchronizableOptionsForCreateComponent(), function (value) {\n      return !(value in config);\n    });\n    var nestedComponentOptions = that.option(\"nestedComponentOptions\") || _common2.default.noop;\n    var nestedComponentConfig = (0, _extend.extend)({\n      integrationOptions: this.option(\"integrationOptions\")\n    }, nestedComponentOptions(this));\n    synchronizableOptions.forEach(function (optionName) {\n      nestedComponentConfig[optionName] = _this.option(optionName);\n    });\n    that._extendConfig(config, nestedComponentConfig);\n    var instance;\n    if ((0, _type.isString)(component)) {\n      var $element = (0, _renderer2.default)(element)[component](config);\n      instance = $element[component](\"instance\");\n    } else {\n      if (element) {\n        instance = component.getInstance(element);\n        if (instance) {\n          instance.option(config);\n        } else {\n          instance = new component(element, config);\n        }\n      }\n    }\n    if (instance) {\n      var optionChangedHandler = function optionChangedHandler(args) {\n        if ((0, _array.inArray)(args.name, synchronizableOptions) >= 0) {\n          instance.option(args.name, args.value);\n        }\n      };\n      that.on(\"optionChanged\", optionChangedHandler);\n      instance.on(\"disposing\", function () {\n        that.off(\"optionChanged\", optionChangedHandler);\n      });\n    }\n    return instance;\n  },\n  _extendConfig: function _extendConfig(config, extendConfig) {\n    (0, _iterator.each)(extendConfig, function (key, value) {\n      config[key] = Object.prototype.hasOwnProperty.call(config, key) ? config[key] : value;\n    });\n  },\n  _defaultActionConfig: function _defaultActionConfig() {\n    return (0, _extend.extend)(this.callBase(), {\n      context: this._modelByElement(this.$element())\n    });\n  },\n  _defaultActionArgs: function _defaultActionArgs() {\n    var model = this._modelByElement(this.$element());\n    return (0, _extend.extend)(this.callBase(), {\n      element: this.element(),\n      model: model\n    });\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"width\":\n      case \"height\":\n        this._renderDimensions();\n        break;\n      case \"rtlEnabled\":\n        this._invalidate();\n        break;\n      case \"elementAttr\":\n        this._renderElementAttributes();\n        break;\n      case \"disabled\":\n      case \"integrationOptions\":\n        break;\n      default:\n        this.callBase(args);\n    }\n  },\n  _removeAttributes: function _removeAttributes(element) {\n    var i = element.attributes.length - 1;\n    for (; i >= 0; i--) {\n      var attribute = element.attributes[i];\n      if (!attribute) {\n        return;\n      }\n      var attributeName = attribute.name;\n      if (0 === attributeName.indexOf(\"aria-\") || attributeName.indexOf(\"dx-\") !== -1 || \"role\" === attributeName || \"style\" === attributeName || \"tabindex\" === attributeName) {\n        element.removeAttribute(attributeName);\n      }\n    }\n  },\n  _removeClasses: function _removeClasses(element) {\n    var classes = element.className.split(\" \").filter(function (cssClass) {\n      return 0 !== cssClass.lastIndexOf(\"dx-\", 0);\n    });\n    element.className = classes.join(\" \");\n  },\n  endUpdate: function endUpdate() {\n    var requireRender = !this._initializing && !this._initialized;\n    this.callBase.apply(this, arguments);\n    if (!this._updateLockCount) {\n      if (requireRender) {\n        this._renderComponent();\n      } else {\n        if (this._requireRefresh) {\n          this._requireRefresh = false;\n          this._refresh();\n        }\n      }\n    }\n  },\n  $element: function $element() {\n    return this._$element;\n  },\n  element: function element() {\n    return (0, _dom.getPublicElement)(this.$element());\n  },\n  dispose: function dispose() {\n    var element = this.$element().get(0);\n    _element_data2.default.cleanDataRecursive(element, true);\n    element.textContent = \"\";\n    this._removeAttributes(element);\n    this._removeClasses(element);\n  }\n});\nDOMComponent.getInstance = function (element) {\n  return _public_component2.default.getInstanceByElement((0, _renderer2.default)(element), this);\n};\nDOMComponent.defaultOptions = function (rule) {\n  this._classCustomRules = this._classCustomRules || [];\n  this._classCustomRules.push(rule);\n};\nmodule.exports = DOMComponent;\nmodule.exports.default = module.exports;","map":null,"metadata":{},"sourceType":"script"}