{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.sorting.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _events_engine = require(\"../../events/core/events_engine\");\nvar _events_engine2 = _interopRequireDefault(_events_engine);\nvar _click = require(\"../../events/click\");\nvar _click2 = _interopRequireDefault(_click);\nvar _type = require(\"../../core/utils/type\");\nvar _extend = require(\"../../core/utils/extend\");\nvar _uiGrid_core = require(\"../grid_core/ui.grid_core.sorting_mixin\");\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\nvar _message = require(\"../../localization/message\");\nvar _message2 = _interopRequireDefault(_message);\nvar _utils = require(\"../../events/utils\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar COLUMN_HEADERS_VIEW_NAMESPACE = \"dxDataGridColumnHeadersView\";\nvar ColumnHeadersViewSortingExtender = (0, _extend.extend)({}, _uiGrid_core2.default, {\n  _createRow: function _createRow(row) {\n    var _this = this;\n    var $row = this.callBase(row);\n    if (\"header\" === row.rowType) {\n      _events_engine2.default.on($row, (0, _utils.addNamespace)(_click2.default.name, COLUMN_HEADERS_VIEW_NAMESPACE), \"td\", this.createAction(function (e) {\n        _this._processHeaderAction(e.event, $row);\n      }));\n    }\n    return $row;\n  },\n  _processHeaderAction: function _processHeaderAction(event, $row) {\n    if ((0, _renderer2.default)(event.currentTarget).parent().get(0) !== $row.get(0)) {\n      return;\n    }\n    var that = this,\n      keyName = null;\n    var $cellElementFromEvent = (0, _renderer2.default)(event.currentTarget);\n    var rowIndex = $cellElementFromEvent.parent().index();\n    var columnIndex = -1;\n    [].slice.call(that.getCellElements(rowIndex)).some(function ($cellElement, index) {\n      if ($cellElement === $cellElementFromEvent.get(0)) {\n        columnIndex = index;\n        return true;\n      }\n    });\n    var visibleColumns = that._columnsController.getVisibleColumns(rowIndex);\n    var column = visibleColumns[columnIndex];\n    var editingController = that.getController(\"editing\");\n    var editingMode = that.option(\"editing.mode\");\n    var isCellEditing = editingController && editingController.isEditing() && (\"batch\" === editingMode || \"cell\" === editingMode);\n    if (isCellEditing || !that._isSortableElement((0, _renderer2.default)(event.target))) {\n      return;\n    }\n    if (column && !(0, _type.isDefined)(column.groupIndex) && !column.command) {\n      if (event.shiftKey) {\n        keyName = \"shift\";\n      } else {\n        if (event.ctrlKey) {\n          keyName = \"ctrl\";\n        }\n      }\n      setTimeout(function () {\n        that._columnsController.changeSortOrder(column.index, keyName);\n      });\n    }\n  },\n  _renderCellContent: function _renderCellContent($cell, options) {\n    var that = this;\n    var column = options.column;\n    if (!column.command && \"header\" === options.rowType) {\n      that._applyColumnState({\n        name: \"sort\",\n        rootElement: $cell,\n        column: column,\n        showColumnLines: that.option(\"showColumnLines\")\n      });\n    }\n    that.callBase($cell, options);\n  },\n  _columnOptionChanged: function _columnOptionChanged(e) {\n    var changeTypes = e.changeTypes;\n    if (1 === changeTypes.length && changeTypes.sorting) {\n      this._updateIndicators(\"sort\");\n      return;\n    }\n    this.callBase(e);\n  },\n  optionChanged: function optionChanged(args) {\n    var that = this;\n    switch (args.name) {\n      case \"sorting\":\n        that._invalidate();\n        args.handled = true;\n        break;\n      default:\n        that.callBase(args);\n    }\n  }\n});\nvar HeaderPanelSortingExtender = (0, _extend.extend)({}, _uiGrid_core2.default, {\n  _createGroupPanelItem: function _createGroupPanelItem($rootElement, groupColumn) {\n    var that = this;\n    var $item = that.callBase.apply(that, arguments);\n    _events_engine2.default.on($item, (0, _utils.addNamespace)(_click2.default.name, \"dxDataGridHeaderPanel\"), that.createAction(function () {\n      that._processGroupItemAction(groupColumn.index);\n    }));\n    that._applyColumnState({\n      name: \"sort\",\n      rootElement: $item,\n      column: {\n        alignment: that.option(\"rtlEnabled\") ? \"right\" : \"left\",\n        allowSorting: groupColumn.allowSorting,\n        sortOrder: \"desc\" === groupColumn.sortOrder ? \"desc\" : \"asc\"\n      },\n      showColumnLines: true\n    });\n    return $item;\n  },\n  _processGroupItemAction: function _processGroupItemAction(groupColumnIndex) {\n    var _this2 = this;\n    setTimeout(function () {\n      return _this2.getController(\"columns\").changeSortOrder(groupColumnIndex);\n    });\n  },\n  optionChanged: function optionChanged(args) {\n    var that = this;\n    switch (args.name) {\n      case \"sorting\":\n        that._invalidate();\n        args.handled = true;\n        break;\n      default:\n        that.callBase(args);\n    }\n  }\n});\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      sorting: {\n        mode: \"single\",\n        ascendingText: _message2.default.format(\"dxDataGrid-sortingAscendingText\"),\n        descendingText: _message2.default.format(\"dxDataGrid-sortingDescendingText\"),\n        clearText: _message2.default.format(\"dxDataGrid-sortingClearText\"),\n        showSortIndexes: true\n      }\n    };\n  },\n  extenders: {\n    views: {\n      columnHeadersView: ColumnHeadersViewSortingExtender,\n      headerPanel: HeaderPanelSortingExtender\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}