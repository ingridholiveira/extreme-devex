{"ast":null,"code":"/**\r\n * DevExtreme (ui/toolbar.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../core/renderer\"),\n  themes = require(\"./themes\"),\n  registerComponent = require(\"../core/component_registrator\"),\n  grep = require(\"../core/utils/common\").grep,\n  extend = require(\"../core/utils/extend\").extend,\n  arrayUtils = require(\"../core/utils/array\"),\n  iteratorUtils = require(\"../core/utils/iterator\"),\n  ActionSheetStrategy = require(\"./toolbar/ui.toolbar.strategy.action_sheet\"),\n  DropDownMenuStrategy = require(\"./toolbar/ui.toolbar.strategy.drop_down_menu\"),\n  ToolbarBase = require(\"./toolbar/ui.toolbar.base\"),\n  ChildDefaultTemplate = require(\"../core/templates/child_default_template\").ChildDefaultTemplate;\nvar STRATEGIES = {\n  actionSheet: ActionSheetStrategy,\n  dropDownMenu: DropDownMenuStrategy\n};\nvar TOOLBAR_AUTO_HIDE_ITEM_CLASS = \"dx-toolbar-item-auto-hide\",\n  TOOLBAR_AUTO_HIDE_TEXT_CLASS = \"dx-toolbar-text-auto-hide\",\n  TOOLBAR_HIDDEN_ITEM = \"dx-toolbar-item-invisible\";\nvar Toolbar = ToolbarBase.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      menuItemTemplate: \"menuItem\",\n      submenuType: \"dropDownMenu\",\n      menuContainer: void 0\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    var themeName = themes.current();\n    return this.callBase().concat([{\n      device: function device() {\n        return themes.isIos7(themeName);\n      },\n      options: {\n        submenuType: \"actionSheet\"\n      }\n    }]);\n  },\n  _dimensionChanged: function _dimensionChanged(dimension) {\n    if (\"height\" === dimension) {\n      return;\n    }\n    this._menuStrategy.toggleMenuVisibility(false, true);\n    this.callBase();\n    this._menuStrategy.renderMenuItems();\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n    this._defaultTemplates.actionSheetItem = new ChildDefaultTemplate(\"item\");\n  },\n  _initMarkup: function _initMarkup() {\n    this.callBase();\n    this._renderMenu();\n  },\n  _postProcessRenderItems: function _postProcessRenderItems() {\n    this._hideOverflowItems();\n    this._menuStrategy._updateMenuVisibility();\n    this.callBase();\n    this._menuStrategy.renderMenuItems();\n  },\n  _renderItem: function _renderItem(index, item, itemContainer, $after) {\n    var itemElement = this.callBase(index, item, itemContainer, $after);\n    if (\"auto\" === item.locateInMenu) {\n      itemElement.addClass(TOOLBAR_AUTO_HIDE_ITEM_CLASS);\n    }\n    if (\"dxButton\" === item.widget && \"inMenu\" === item.showText) {\n      itemElement.toggleClass(TOOLBAR_AUTO_HIDE_TEXT_CLASS);\n    }\n    return itemElement;\n  },\n  _getItemsWidth: function _getItemsWidth() {\n    return this._getSummaryItemsWidth([this._$beforeSection, this._$centerSection, this._$afterSection]);\n  },\n  _hideOverflowItems: function _hideOverflowItems(elementWidth) {\n    var overflowItems = this.$element().find(\".\" + TOOLBAR_AUTO_HIDE_ITEM_CLASS);\n    if (!overflowItems.length) {\n      return;\n    }\n    elementWidth = elementWidth || this.$element().width();\n    $(overflowItems).removeClass(TOOLBAR_HIDDEN_ITEM);\n    var itemsWidth = this._getItemsWidth();\n    while (overflowItems.length && elementWidth < itemsWidth) {\n      var $item = overflowItems.eq(-1);\n      itemsWidth -= $item.outerWidth();\n      $item.addClass(TOOLBAR_HIDDEN_ITEM);\n      overflowItems.splice(-1, 1);\n    }\n  },\n  _getMenuItems: function _getMenuItems() {\n    var that = this;\n    var menuItems = grep(this.option(\"items\") || [], function (item) {\n      return that._isMenuItem(item);\n    });\n    var $hiddenItems = this._itemContainer().children(\".\" + TOOLBAR_AUTO_HIDE_ITEM_CLASS + \".\" + TOOLBAR_HIDDEN_ITEM).not(\".dx-state-invisible\");\n    this._restoreItems = this._restoreItems || [];\n    var overflowItems = [].slice.call($hiddenItems).map(function (item) {\n      var itemData = that._getItemData(item),\n        $itemContainer = $(item).children(),\n        $itemMarkup = $itemContainer.children();\n      return extend({\n        menuItemTemplate: function menuItemTemplate() {\n          that._restoreItems.push({\n            container: $itemContainer,\n            item: $itemMarkup\n          });\n          var $container = $(\"<div>\").addClass(TOOLBAR_AUTO_HIDE_ITEM_CLASS);\n          return $container.append($itemMarkup);\n        }\n      }, itemData);\n    });\n    return arrayUtils.merge(overflowItems, menuItems);\n  },\n  _getToolbarItems: function _getToolbarItems() {\n    var that = this;\n    return grep(this.option(\"items\") || [], function (item) {\n      return !that._isMenuItem(item);\n    });\n  },\n  _renderMenu: function _renderMenu() {\n    this._renderMenuStrategy();\n    this._menuStrategy.render();\n  },\n  _renderMenuStrategy: function _renderMenuStrategy() {\n    var strategyName = this.option(\"submenuType\");\n    if (this._requireDropDownStrategy()) {\n      strategyName = \"dropDownMenu\";\n    }\n    var strategy = STRATEGIES[strategyName];\n    if (!(this._menuStrategy && this._menuStrategy.NAME === strategyName)) {\n      this._menuStrategy = new strategy(this);\n    }\n  },\n  _requireDropDownStrategy: function _requireDropDownStrategy() {\n    var items = this.option(\"items\") || [],\n      result = false;\n    iteratorUtils.each(items, function (index, item) {\n      if (\"auto\" === item.locateInMenu) {\n        result = true;\n      } else {\n        if (\"always\" === item.locateInMenu && item.widget) {\n          result = true;\n        }\n      }\n    });\n    return result;\n  },\n  _arrangeItems: function _arrangeItems() {\n    if (this.$element().is(\":hidden\")) {\n      return;\n    }\n    this._$centerSection.css({\n      margin: \"0 auto\",\n      \"float\": \"none\"\n    });\n    iteratorUtils.each(this._restoreItems || [], function (_, obj) {\n      $(obj.container).append(obj.item);\n    });\n    this._restoreItems = [];\n    var elementWidth = this.$element().width();\n    this._hideOverflowItems(elementWidth);\n    this.callBase(elementWidth);\n  },\n  _itemOptionChanged: function _itemOptionChanged(item, property, value) {\n    if (this._isMenuItem(item)) {\n      this._menuStrategy.renderMenuItems();\n    } else {\n      if (this._isToolbarItem(item)) {\n        this.callBase(item, property, value);\n      } else {\n        this.callBase(item, property, value);\n        this._menuStrategy.renderMenuItems();\n      }\n    }\n  },\n  _isMenuItem: function _isMenuItem(itemData) {\n    return \"menu\" === itemData.location || \"always\" === itemData.locateInMenu;\n  },\n  _isToolbarItem: function _isToolbarItem(itemData) {\n    return void 0 === itemData.location || \"never\" === itemData.locateInMenu;\n  },\n  _optionChanged: function _optionChanged(args) {\n    var name = args.name;\n    var value = args.value;\n    switch (name) {\n      case \"submenuType\":\n        this._invalidate();\n        break;\n      case \"visible\":\n        this.callBase.apply(this, arguments);\n        this._menuStrategy.handleToolbarVisibilityChange(value);\n        break;\n      case \"menuItemTemplate\":\n        this._changeMenuOption(\"itemTemplate\", this._getTemplate(value));\n        break;\n      case \"onItemClick\":\n        this._changeMenuOption(name, value);\n        this.callBase.apply(this, arguments);\n        break;\n      case \"menuContainer\":\n        this._changeMenuOption(\"container\", value);\n        break;\n      default:\n        this.callBase.apply(this, arguments);\n    }\n  },\n  _changeMenuOption: function _changeMenuOption(name, value) {\n    this._menuStrategy.widgetOption(name, value);\n  }\n});\nregisterComponent(\"dxToolbar\", Toolbar);\nmodule.exports = Toolbar;\nmodule.exports.default = module.exports;","map":null,"metadata":{},"sourceType":"script"}