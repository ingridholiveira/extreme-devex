{"ast":null,"code":"/**\r\n * DevExtreme (ui/hierarchical_collection/ui.hierarchical_collection_widget.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _data = require(\"../../core/utils/data\");\nvar _extend = require(\"../../core/utils/extend\");\nvar _iterator = require(\"../../core/utils/iterator\");\nvar _devices = require(\"../../core/devices\");\nvar _devices2 = _interopRequireDefault(_devices);\nvar _icon = require(\"../../core/utils/icon\");\nvar _icon2 = _interopRequireDefault(_icon);\nvar _ui = require(\"./ui.data_adapter\");\nvar _ui2 = _interopRequireDefault(_ui);\nvar _uiCollection_widget = require(\"../collection/ui.collection_widget.edit\");\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\nvar _bindable_template = require(\"../../core/templates/bindable_template\");\nvar _type = require(\"../../core/utils/type\");\nvar _common = require(\"../../core/utils/common\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\nvar HierarchicalCollectionWidget = _uiCollection_widget2.default.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      keyExpr: \"id\",\n      displayExpr: \"text\",\n      selectedExpr: \"selected\",\n      disabledExpr: \"disabled\",\n      itemsExpr: \"items\",\n      hoverStateEnabled: true,\n      parentIdExpr: \"parentId\",\n      expandedExpr: \"expanded\"\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: function device() {\n        return \"desktop\" === _devices2.default.real().deviceType && !_devices2.default.isSimulator();\n      },\n      options: {\n        focusStateEnabled: true\n      }\n    }]);\n  },\n  _init: function _init() {\n    this.callBase();\n    this._initAccessors();\n    this._initDataAdapter();\n    this._initDynamicTemplates();\n  },\n  _initDataSource: function _initDataSource() {\n    this.callBase();\n    this._dataSource && this._dataSource.paginate(false);\n  },\n  _initDataAdapter: function _initDataAdapter() {\n    var accessors = this._createDataAdapterAccessors();\n    this._dataAdapter = new _ui2.default((0, _extend.extend)({\n      dataAccessors: {\n        getters: accessors.getters,\n        setters: accessors.setters\n      },\n      items: this.option(\"items\")\n    }, this._getDataAdapterOptions()));\n  },\n  _getDataAdapterOptions: _common.noop,\n  _initDynamicTemplates: function _initDynamicTemplates() {\n    var that = this;\n    this._defaultTemplates.item = new _bindable_template.BindableTemplate(function ($container, itemData) {\n      $container.html(itemData.html).append(this._getIconContainer(itemData)).append(this._getTextContainer(itemData)).append(this._getPopoutContainer(itemData));\n      that._addContentClasses(itemData, $container.parent());\n    }.bind(this), [\"text\", \"html\", \"items\", \"icon\"], this.option(\"integrationOptions.watchMethod\"), {\n      text: this._displayGetter,\n      items: this._itemsGetter\n    });\n  },\n  _getIconContainer: function _getIconContainer(itemData) {\n    return itemData.icon ? _icon2.default.getImageContainer(itemData.icon) : void 0;\n  },\n  _getTextContainer: function _getTextContainer(itemData) {\n    return (0, _renderer2.default)(\"<span>\").text(itemData.text);\n  },\n  _getPopoutContainer: _common.noop,\n  _addContentClasses: _common.noop,\n  _initAccessors: function _initAccessors() {\n    var that = this;\n    (0, _iterator.each)(this._getAccessors(), function (_, accessor) {\n      that._compileAccessor(accessor);\n    });\n    this._compileDisplayGetter();\n  },\n  _getAccessors: function _getAccessors() {\n    return [\"key\", \"selected\", \"items\", \"disabled\", \"parentId\", \"expanded\"];\n  },\n  _getChildNodes: function _getChildNodes(node) {\n    var that = this,\n      arr = [];\n    (0, _iterator.each)(node.internalFields.childrenKeys, function (_, key) {\n      var childNode = that._dataAdapter.getNodeByKey(key);\n      arr.push(childNode);\n    });\n    return arr;\n  },\n  _hasChildren: function _hasChildren(node) {\n    return node && node.internalFields.childrenKeys.length;\n  },\n  _compileAccessor: function _compileAccessor(optionName) {\n    var getter = \"_\" + optionName + \"Getter\",\n      setter = \"_\" + optionName + \"Setter\",\n      optionExpr = this.option(optionName + \"Expr\");\n    if (!optionExpr) {\n      this[getter] = _common.noop;\n      this[setter] = _common.noop;\n      return;\n    } else {\n      if ((0, _type.isFunction)(optionExpr)) {\n        this[setter] = function (obj, value) {\n          obj[optionExpr()] = value;\n        };\n        this[getter] = function (obj) {\n          return obj[optionExpr()];\n        };\n        return;\n      }\n    }\n    this[getter] = (0, _data.compileGetter)(optionExpr);\n    this[setter] = (0, _data.compileSetter)(optionExpr);\n  },\n  _createDataAdapterAccessors: function _createDataAdapterAccessors() {\n    var that = this,\n      accessors = {\n        getters: {},\n        setters: {}\n      };\n    (0, _iterator.each)(this._getAccessors(), function (_, accessor) {\n      var getterName = \"_\" + accessor + \"Getter\",\n        setterName = \"_\" + accessor + \"Setter\",\n        newAccessor = \"parentId\" === accessor ? \"parentKey\" : accessor;\n      accessors.getters[newAccessor] = that[getterName];\n      accessors.setters[newAccessor] = that[setterName];\n    });\n    accessors.getters.display = !this._displayGetter ? function (itemData) {\n      return itemData.text;\n    } : this._displayGetter;\n    return accessors;\n  },\n  _initMarkup: function _initMarkup() {\n    this.callBase();\n    this._addWidgetClass();\n  },\n  _addWidgetClass: function _addWidgetClass() {\n    this._focusTarget().addClass(this._widgetClass());\n  },\n  _widgetClass: _common.noop,\n  _renderItemFrame: function _renderItemFrame(index, itemData) {\n    var $itemFrame = this.callBase.apply(this, arguments);\n    $itemFrame.toggleClass(DISABLED_STATE_CLASS, !!this._disabledGetter(itemData));\n    return $itemFrame;\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"displayExpr\":\n      case \"keyExpr\":\n        this._initAccessors();\n        this._initDynamicTemplates();\n        this.repaint();\n        break;\n      case \"itemsExpr\":\n      case \"selectedExpr\":\n      case \"disabledExpr\":\n      case \"expandedExpr\":\n      case \"parentIdExpr\":\n        this._initAccessors();\n        this._initDataAdapter();\n        this.repaint();\n        break;\n      case \"items\":\n        this._initDataAdapter();\n        this.callBase(args);\n        break;\n      default:\n        this.callBase(args);\n    }\n  }\n});\nmodule.exports = HierarchicalCollectionWidget;","map":null,"metadata":{},"sourceType":"script"}