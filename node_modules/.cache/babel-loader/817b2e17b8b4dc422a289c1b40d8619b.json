{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.keyboard_navigation.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _dom_adapter = require(\"../../core/dom_adapter\");\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\nvar _events_engine = require(\"../../events/core/events_engine\");\nvar _events_engine2 = _interopRequireDefault(_events_engine);\nvar _uiGrid_core = require(\"./ui.grid_core.modules\");\nvar _uiGrid_core2 = _interopRequireDefault(_uiGrid_core);\nvar _uiGrid_core3 = require(\"./ui.grid_core.utils\");\nvar _type = require(\"../../core/utils/type\");\nvar _array = require(\"../../core/utils/array\");\nvar _selectors = require(\"../widget/selectors\");\nvar _ui = require(\"../widget/ui.keyboard_processor\");\nvar _ui2 = _interopRequireDefault(_ui);\nvar _utils = require(\"../../events/utils\");\nvar _utils2 = _interopRequireDefault(_utils);\nvar _pointer = require(\"../../events/pointer\");\nvar _pointer2 = _interopRequireDefault(_pointer);\nvar _common = require(\"../../core/utils/common\");\nvar _accessibility = require(\"../shared/accessibility\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar ROWS_VIEW_CLASS = \"rowsview\",\n  EDIT_FORM_CLASS = \"edit-form\",\n  GROUP_FOOTER_CLASS = \"group-footer\",\n  ROW_CLASS = \"dx-row\",\n  DATA_ROW_CLASS = \"dx-data-row\",\n  GROUP_ROW_CLASS = \"dx-group-row\",\n  EDIT_FORM_ITEM_CLASS = \"edit-form-item\",\n  MASTER_DETAIL_ROW_CLASS = \"dx-master-detail-row\",\n  FREESPACE_ROW_CLASS = \"dx-freespace-row\",\n  VIRTUAL_ROW_CLASS = \"dx-virtual-row\",\n  MASTER_DETAIL_CELL_CLASS = \"dx-master-detail-cell\",\n  EDITOR_CELL_CLASS = \"dx-editor-cell\",\n  EDIT_ROW_CLASS = \"dx-edit-row\",\n  DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\",\n  COMMAND_EXPAND_CLASS = \"dx-command-expand\",\n  COMMAND_SELECT_CLASS = \"dx-command-select\",\n  COMMAND_CELL_SELECTOR = \"[class^=dx-command]\",\n  CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\",\n  DATEBOX_WIDGET_NAME = \"dxDateBox\",\n  FOCUS_STATE_CLASS = \"dx-state-focused\",\n  WIDGET_CLASS = \"dx-widget\",\n  FAST_EDITING_DELETE_KEY = \"delete\",\n  INTERACTIVE_ELEMENTS_SELECTOR = \"input:not([type='hidden']), textarea, a, select, [tabindex]\",\n  EDIT_MODE_ROW = \"row\",\n  EDIT_MODE_FORM = \"form\",\n  EDIT_MODE_BATCH = \"batch\",\n  EDIT_MODE_CELL = \"cell\",\n  FOCUS_TYPE_ROW = \"row\",\n  FOCUS_TYPE_CELL = \"cell\";\nfunction isGroupRow($row) {\n  return $row && $row.hasClass(GROUP_ROW_CLASS);\n}\nfunction isDetailRow($row) {\n  return $row && $row.hasClass(MASTER_DETAIL_ROW_CLASS);\n}\nfunction isDataRow($row) {\n  return $row && !isGroupRow($row) && !isDetailRow($row);\n}\nfunction isNotFocusedRow($row) {\n  return !$row || $row.hasClass(FREESPACE_ROW_CLASS) || $row.hasClass(VIRTUAL_ROW_CLASS);\n}\nfunction isCellElement($element) {\n  return $element.length && \"TD\" === $element[0].tagName;\n}\nfunction isEditorCell(that, $cell) {\n  return !that._isRowEditMode() && $cell && $cell.hasClass(EDITOR_CELL_CLASS);\n}\nfunction isElementDefined($element) {\n  return (0, _type.isDefined)($element) && $element.length > 0;\n}\nvar KeyboardNavigationController = _uiGrid_core2.default.ViewController.inherit({\n  init: function init() {\n    var that = this;\n    if (that.isKeyboardEnabled()) {\n      that._dataController = that.getController(\"data\");\n      that._selectionController = that.getController(\"selection\");\n      that._editingController = that.getController(\"editing\");\n      that._headerPanel = that.getView(\"headerPanel\");\n      that._columnsController = that.getController(\"columns\");\n      that.getController(\"editorFactory\").focused.add(function ($element) {\n        that.setupFocusedView();\n        if (that._isNeedScroll) {\n          if ($element.is(\":visible\") && that._focusedView && that._focusedView.getScrollable) {\n            that._scrollToElement($element);\n            that._isNeedScroll = false;\n          }\n        }\n      });\n      that._fastEditingStarted = false;\n      that._focusedCellPosition = {};\n      that._canceledCellPosition = null;\n      that._initViewHandlers();\n      that._documentClickHandler = that.createAction(function (e) {\n        var $target = (0, _renderer2.default)(e.event.target),\n          isCurrentRowsViewClick = that._isEventInCurrentGrid(e.event) && $target.closest(\".\" + that.addWidgetPrefix(ROWS_VIEW_CLASS)).length,\n          isEditorOverlay = $target.closest(\".\" + DROPDOWN_EDITOR_OVERLAY_CLASS).length;\n        if (!isCurrentRowsViewClick && !isEditorOverlay) {\n          that._resetFocusedCell();\n        }\n      });\n      that.createAction(\"onKeyDown\");\n      _events_engine2.default.on(_dom_adapter2.default.getDocument(), _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), that._documentClickHandler);\n    }\n  },\n  _initViewHandlers: function _initViewHandlers() {\n    var that = this,\n      clickAction = that.createAction(that._clickHandler),\n      rowsView = that.getView(\"rowsView\");\n    rowsView.renderCompleted.add(function (e) {\n      var $focusedElement,\n        $element = rowsView.element(),\n        isFullUpdate = !e || \"refresh\" === e.changeType,\n        isFocusedViewCorrect = that._focusedView && that._focusedView.name === rowsView.name,\n        needUpdateFocus = false,\n        isAppend = e && (\"append\" === e.changeType || \"prepend\" === e.changeType),\n        clickSelector = \".\" + ROW_CLASS + \" > td, .\" + ROW_CLASS;\n      _events_engine2.default.off($element, _utils2.default.addNamespace(_pointer2.default.up, \"dxDataGridKeyboardNavigation\"), clickAction);\n      _events_engine2.default.on($element, _utils2.default.addNamespace(_pointer2.default.up, \"dxDataGridKeyboardNavigation\"), clickSelector, clickAction);\n      that._initKeyDownProcessor(that, $element, that._keyDownHandler);\n      $focusedElement = (0, _renderer2.default)(\":focus\");\n      if (isFocusedViewCorrect && (!$focusedElement.length || $focusedElement.closest($element).length)) {\n        needUpdateFocus = that._isNeedFocus ? !isAppend : that._isHiddenFocus && isFullUpdate;\n        needUpdateFocus && that._updateFocus(true);\n      }\n    });\n  },\n  _initKeyDownProcessor: function _initKeyDownProcessor(context, element, handler) {\n    if (this._keyDownProcessor) {\n      this._keyDownProcessor.dispose();\n      this._keyDownProcessor = null;\n    }\n    this._keyDownProcessor = new _ui2.default({\n      element: element,\n      context: context,\n      handler: handler\n    });\n  },\n  dispose: function dispose() {\n    this.callBase();\n    this._focusedView = null;\n    this._keyDownProcessor && this._keyDownProcessor.dispose();\n    _events_engine2.default.off(_dom_adapter2.default.getDocument(), _utils2.default.addNamespace(_pointer2.default.down, \"dxDataGridKeyboardNavigation\"), this._documentClickHandler);\n  },\n  optionChanged: function optionChanged(args) {\n    var that = this;\n    switch (args.name) {\n      case \"keyboardNavigation\":\n      case \"useLegacyKeyboardNavigation\":\n        args.handled = true;\n        break;\n      default:\n        that.callBase(args);\n    }\n  },\n  isRowFocusType: function isRowFocusType() {\n    return this.focusType === FOCUS_TYPE_ROW;\n  },\n  isCellFocusType: function isCellFocusType() {\n    return this.focusType === FOCUS_TYPE_CELL;\n  },\n  setRowFocusType: function setRowFocusType() {\n    if (this.option(\"focusedRowEnabled\")) {\n      this.focusType = FOCUS_TYPE_ROW;\n    }\n  },\n  setCellFocusType: function setCellFocusType() {\n    this.focusType = FOCUS_TYPE_CELL;\n  },\n  _keyDownHandler: function _keyDownHandler(e) {\n    var isEditing = this._editingController.isEditing(),\n      needStopPropagation = true,\n      originalEvent = e.originalEvent,\n      args = {\n        handled: false,\n        event: originalEvent\n      };\n    this.executeAction(\"onKeyDown\", args);\n    if (originalEvent.isDefaultPrevented()) {\n      return;\n    }\n    this._isNeedFocus = true;\n    this._isNeedScroll = true;\n    this._updateFocusedCellPosition(this._getCellElementFromTarget(args.event.target));\n    if (!args.handled) {\n      switch (e.keyName) {\n        case \"leftArrow\":\n        case \"rightArrow\":\n          this._leftRightKeysHandler(e, isEditing);\n          break;\n        case \"upArrow\":\n        case \"downArrow\":\n          if (e.ctrl) {\n            (0, _accessibility.selectView)(\"rowsView\", this, originalEvent);\n          } else {\n            this._upDownKeysHandler(e, isEditing);\n          }\n          break;\n        case \"pageUp\":\n        case \"pageDown\":\n          this._pageUpDownKeyHandler(e);\n          break;\n        case \"space\":\n          this._spaceKeyHandler(e, isEditing);\n          break;\n        case \"A\":\n          if (e.ctrl) {\n            this._ctrlAKeyHandler(e, isEditing);\n          } else {\n            this._beginFastEditing(e.originalEvent);\n          }\n          break;\n        case \"tab\":\n          this._tabKeyHandler(e, isEditing);\n          break;\n        case \"enter\":\n          this._enterKeyHandler(e, isEditing);\n          break;\n        case \"escape\":\n          this._escapeKeyHandler(e, isEditing);\n          break;\n        case \"F\":\n          if (e.ctrl) {\n            this._ctrlFKeyHandler(e);\n          } else {\n            this._beginFastEditing(e.originalEvent);\n          }\n          break;\n        case \"F2\":\n          this._f2KeyHandler();\n          break;\n        case \"del\":\n        case \"backspace\":\n          if (this._isFastEditingAllowed() && !this._isFastEditingStarted()) {\n            this._beginFastEditing(e.originalEvent, true);\n          }\n          break;\n        default:\n          if (!this._beginFastEditing(e.originalEvent)) {\n            this._isNeedFocus = false;\n            this._isNeedScroll = false;\n            needStopPropagation = false;\n          }\n      }\n      if (needStopPropagation) {\n        originalEvent.stopPropagation();\n      }\n    }\n  },\n  _leftRightKeysHandler: function _leftRightKeysHandler(eventArgs, isEditing) {\n    var rowIndex = this.getVisibleRowIndex(),\n      $event = eventArgs.originalEvent,\n      $row = this._focusedView && this._focusedView.getRow(rowIndex),\n      directionCode = this._getDirectionCodeByKey(eventArgs.keyName),\n      isEditingNavigationMode = this._isFastEditingStarted(),\n      allowNavigate = (!isEditing || isEditingNavigationMode) && isDataRow($row);\n    if (allowNavigate) {\n      this.setCellFocusType();\n      isEditingNavigationMode && this._editingController.closeEditCell();\n      var $cell = this._getNextCell(directionCode);\n      if (isElementDefined($cell)) {\n        this._arrowKeysHandlerFocusCell($event, $cell);\n      }\n      $event && $event.preventDefault();\n    }\n  },\n  _upDownKeysHandler: function _upDownKeysHandler(eventArgs, isEditing) {\n    var rowHeight,\n      rowIndex = this.getVisibleRowIndex(),\n      $row = this._focusedView && this._focusedView.getRow(rowIndex),\n      $event = eventArgs.originalEvent,\n      isUpArrow = \"upArrow\" === eventArgs.keyName,\n      dataSource = this._dataController.dataSource(),\n      isEditingNavigationMode = this._isFastEditingStarted(),\n      allowNavigate = (!isEditing || isEditingNavigationMode) && $row && !isDetailRow($row);\n    if (allowNavigate) {\n      isEditingNavigationMode && this._editingController.closeEditCell();\n      if (!this._navigateNextCell($event, eventArgs.keyName)) {\n        if (this._isVirtualScrolling() && isUpArrow && dataSource && !dataSource.isLoading()) {\n          rowHeight = $row.outerHeight();\n          rowIndex = this._focusedCellPosition.rowIndex - 1;\n          this._scrollBy(-rowHeight, rowIndex, $event);\n        }\n      }\n      $event && $event.preventDefault();\n    }\n  },\n  _pageUpDownKeyHandler: function _pageUpDownKeyHandler(eventArgs) {\n    var pageIndex = this._dataController.pageIndex(),\n      pageCount = this._dataController.pageCount(),\n      pagingEnabled = this.option(\"paging.enabled\"),\n      isPageUp = \"pageUp\" === eventArgs.keyName,\n      pageStep = isPageUp ? -1 : 1,\n      scrollable = this.getView(\"rowsView\").getScrollable();\n    if (pagingEnabled && !this._isVirtualScrolling()) {\n      if ((isPageUp ? pageIndex > 0 : pageIndex < pageCount - 1) && !this._isVirtualScrolling()) {\n        this._dataController.pageIndex(pageIndex + pageStep);\n        eventArgs.originalEvent.preventDefault();\n      }\n    } else {\n      if (scrollable && scrollable._container().height() < scrollable.$content().height()) {\n        this._scrollBy(scrollable._container().height() * pageStep);\n        eventArgs.originalEvent.preventDefault();\n      }\n    }\n  },\n  _spaceKeyHandler: function _spaceKeyHandler(eventArgs, isEditing) {\n    var isFocusedRowElement,\n      isFocusedSelectionCell,\n      rowIndex = this.getVisibleRowIndex(),\n      $target = (0, _renderer2.default)(eventArgs.originalEvent && eventArgs.originalEvent.target);\n    if (this.option(\"selection\") && \"none\" !== this.option(\"selection\").mode && !isEditing) {\n      isFocusedRowElement = \"row\" === this._getElementType($target) && this.isRowFocusType() && isDataRow($target);\n      isFocusedSelectionCell = $target.hasClass(COMMAND_SELECT_CLASS);\n      if (isFocusedSelectionCell && \"onClick\" === this.option(\"selection.showCheckBoxesMode\")) {\n        this._selectionController.startSelectionWithCheckboxes();\n      }\n      if (isFocusedRowElement || $target.parent().hasClass(DATA_ROW_CLASS) || $target.hasClass(this.addWidgetPrefix(ROWS_VIEW_CLASS))) {\n        this._selectionController.changeItemSelection(rowIndex, {\n          shift: eventArgs.shift,\n          control: eventArgs.ctrl\n        });\n        eventArgs.originalEvent.preventDefault();\n      }\n    } else {\n      this._beginFastEditing(eventArgs.originalEvent);\n    }\n  },\n  _ctrlAKeyHandler: function _ctrlAKeyHandler(eventArgs, isEditing) {\n    if (!isEditing && eventArgs.ctrl && !eventArgs.alt && \"multiple\" === this.option(\"selection.mode\") && this.option(\"selection.allowSelectAll\")) {\n      this._selectionController.selectAll();\n      eventArgs.originalEvent.preventDefault();\n    }\n  },\n  _tabKeyHandler: function _tabKeyHandler(eventArgs, isEditing) {\n    var editingOptions = this.option(\"editing\"),\n      direction = eventArgs.shift ? \"previous\" : \"next\",\n      isOriginalHandlerRequired = !eventArgs.shift && this._isLastValidCell(this._focusedCellPosition) || eventArgs.shift && this._isFirstValidCell(this._focusedCellPosition),\n      eventTarget = eventArgs.originalEvent.target,\n      focusedViewElement = this._focusedView && this._focusedView.element();\n    if (this._handleTabKeyOnMasterDetailCell(eventTarget, direction)) {\n      return;\n    }\n    (0, _renderer2.default)(focusedViewElement).addClass(FOCUS_STATE_CLASS);\n    if (editingOptions && eventTarget && !isOriginalHandlerRequired) {\n      if ((0, _renderer2.default)(eventTarget).hasClass(this.addWidgetPrefix(ROWS_VIEW_CLASS))) {\n        this._resetFocusedCell();\n      }\n      if (isEditing) {\n        if (!this._editingCellTabHandler(eventArgs, direction)) {\n          return;\n        }\n      } else {\n        if (this._targetCellTabHandler(eventArgs, direction)) {\n          isOriginalHandlerRequired = true;\n        }\n      }\n    }\n    if (isOriginalHandlerRequired) {\n      this.getController(\"editorFactory\").loseFocus();\n      if (this._editingController.isEditing() && !this._isRowEditMode()) {\n        this._resetFocusedCell();\n        this._editingController.closeEditCell();\n      }\n    } else {\n      eventArgs.originalEvent.preventDefault();\n    }\n  },\n  _editingCellTabHandler: function _editingCellTabHandler(eventArgs, direction) {\n    var column,\n      row,\n      isEditingAllowed,\n      editingOptions = this.option(\"editing\"),\n      eventTarget = eventArgs.originalEvent.target,\n      $cell = this._getCellElementFromTarget(eventTarget),\n      $event = eventArgs.originalEvent,\n      elementType = this._getElementType(eventTarget);\n    if ($cell.is(COMMAND_CELL_SELECTOR)) {\n      return !this._targetCellTabHandler(eventArgs, direction);\n    }\n    this._updateFocusedCellPosition($cell);\n    $cell = this._getNextCellByTabKey($event, direction, elementType);\n    if (!$cell || this._handleTabKeyOnMasterDetailCell($cell, direction)) {\n      return false;\n    }\n    column = this._columnsController.getVisibleColumns()[this.getView(\"rowsView\").getCellIndex($cell)];\n    row = this._dataController.items()[this._getRowIndex($cell && $cell.parent())];\n    if (column.allowEditing) {\n      var _isDataRow = !row || \"data\" === row.rowType;\n      isEditingAllowed = editingOptions.allowUpdating ? _isDataRow : row && row.isNewRow;\n    }\n    if (!isEditingAllowed) {\n      this._editingController.closeEditCell();\n    }\n    if (this._focusCell($cell)) {\n      if (!this._isRowEditMode() && isEditingAllowed) {\n        this._editingController.editCell(this.getVisibleRowIndex(), this._focusedCellPosition.columnIndex);\n      } else {\n        this._focusInteractiveElement($cell, eventArgs.shift);\n      }\n    }\n    return true;\n  },\n  _targetCellTabHandler: function _targetCellTabHandler(eventArgs, direction) {\n    var elementType,\n      $event = eventArgs.originalEvent,\n      eventTarget = $event.target,\n      $cell = this._getCellElementFromTarget(eventTarget),\n      $lastInteractiveElement = this._getInteractiveElement($cell, !eventArgs.shift),\n      isOriginalHandlerRequired = false;\n    if (!isEditorCell(this, $cell) && $lastInteractiveElement.length && eventTarget !== $lastInteractiveElement.get(0)) {\n      isOriginalHandlerRequired = true;\n    } else {\n      if (void 0 === this._focusedCellPosition.rowIndex && (0, _renderer2.default)(eventTarget).hasClass(ROW_CLASS)) {\n        this._updateFocusedCellPosition((0, _renderer2.default)(eventTarget).children().first());\n      }\n      elementType = this._getElementType(eventTarget);\n      if (this.isRowFocusType()) {\n        this.setCellFocusType();\n        if (\"row\" === elementType && isDataRow((0, _renderer2.default)(eventTarget))) {\n          eventTarget = this.getFirstValidCellInRow((0, _renderer2.default)(eventTarget));\n          elementType = this._getElementType(eventTarget);\n        }\n      }\n      $cell = this._getNextCellByTabKey($event, direction, elementType);\n      if (!$cell) {\n        return false;\n      }\n      $cell = this._checkNewLineTransition($event, $cell);\n      if (!$cell) {\n        return false;\n      }\n      this._focusCell($cell);\n      if (!isEditorCell(this, $cell)) {\n        this._focusInteractiveElement($cell, eventArgs.shift);\n      }\n    }\n    return isOriginalHandlerRequired;\n  },\n  _getNextCellByTabKey: function _getNextCellByTabKey($event, direction, elementType) {\n    var $cell = this._getNextCell(direction, elementType),\n      args = $cell && this._fireFocusedCellChanging($event, $cell, true);\n    if (!args || args.cancel) {\n      return;\n    }\n    if (args.$newCellElement) {\n      $cell = args.$newCellElement;\n    }\n    return $cell;\n  },\n  _checkNewLineTransition: function _checkNewLineTransition($event, $cell) {\n    var rowIndex = this.getVisibleRowIndex(),\n      $row = $cell.parent();\n    if (rowIndex !== this._getRowIndex($row)) {\n      var cellPosition = this._getCellPosition($cell),\n        args = this._fireFocusedRowChanging($event, $row);\n      if (args.cancel) {\n        return;\n      }\n      if (args.rowIndexChanged) {\n        this.setFocusedColumnIndex(cellPosition.columnIndex);\n        $cell = this._getFocusedCell();\n      }\n    }\n    return $cell;\n  },\n  _enterKeyHandler: function _enterKeyHandler(eventArgs, isEditing) {\n    var $cell = this._getFocusedCell(),\n      rowIndex = this.getVisibleRowIndex(),\n      $row = this._focusedView && this._focusedView.getRow(rowIndex);\n    if (this.option(\"grouping.allowCollapsing\") && isGroupRow($row) || this.option(\"masterDetail.enabled\") && $cell && $cell.hasClass(COMMAND_EXPAND_CLASS)) {\n      var key = this._dataController.getKeyByRowIndex(rowIndex),\n        item = this._dataController.items()[rowIndex];\n      if (void 0 !== key && item && item.data && !item.data.isContinuation) {\n        this._dataController.changeRowExpand(key);\n      }\n    } else {\n      this._processEnterKeyForDataCell(eventArgs, isEditing);\n    }\n  },\n  _processEnterKeyForDataCell: function _processEnterKeyForDataCell(eventArgs, isEditing) {\n    var direction = this._getEnterKeyDirection(eventArgs),\n      allowEditingOnEnterKey = this._allowEditingOnEnterKey();\n    if (isEditing || !allowEditingOnEnterKey && direction) {\n      this._handleEnterKeyEditingCell(eventArgs.originalEvent);\n      if (\"next\" === direction || \"previous\" === direction) {\n        this._targetCellTabHandler(eventArgs, direction);\n      } else {\n        if (\"upArrow\" === direction || \"downArrow\" === direction) {\n          this._navigateNextCell(eventArgs.originalEvent, direction);\n        }\n      }\n    } else {\n      if (allowEditingOnEnterKey) {\n        this._startEditing(eventArgs);\n      }\n    }\n  },\n  _getEnterKeyDirection: function _getEnterKeyDirection(eventArgs) {\n    var enterKeyDirection = this.option(\"keyboardNavigation.enterKeyDirection\"),\n      isShift = eventArgs.shift;\n    if (\"column\" === enterKeyDirection) {\n      return isShift ? \"upArrow\" : \"downArrow\";\n    }\n    if (\"row\" === enterKeyDirection) {\n      return isShift ? \"previous\" : \"next\";\n    }\n  },\n  _handleEnterKeyEditingCell: function _handleEnterKeyEditingCell(event) {\n    var target = event.target,\n      $cell = this._getCellElementFromTarget(target),\n      isRowEditMode = this._isRowEditMode();\n    this._updateFocusedCellPosition($cell);\n    if (isRowEditMode) {\n      this._focusEditFormCell($cell);\n      setTimeout(this._editingController.saveEditData.bind(this._editingController));\n    } else {\n      _events_engine2.default.trigger((0, _renderer2.default)(target), \"change\");\n      this._editingController.closeEditCell();\n      event.preventDefault();\n    }\n  },\n  _escapeKeyHandler: function _escapeKeyHandler(eventArgs, isEditing) {\n    var $cell = this._getCellElementFromTarget(eventArgs.originalEvent.target);\n    if (isEditing) {\n      this._updateFocusedCellPosition($cell);\n      if (!this._isRowEditMode()) {\n        if (\"cell\" === this._editingController.getEditMode()) {\n          this._editingController.cancelEditData();\n        } else {\n          this._editingController.closeEditCell();\n        }\n      } else {\n        this._focusEditFormCell($cell);\n        this._editingController.cancelEditData();\n      }\n      eventArgs.originalEvent.preventDefault();\n    }\n  },\n  _ctrlFKeyHandler: function _ctrlFKeyHandler(eventArgs) {\n    if (this.option(\"searchPanel.visible\")) {\n      var searchTextEditor = this._headerPanel.getSearchTextEditor();\n      if (searchTextEditor) {\n        searchTextEditor.focus();\n        eventArgs.originalEvent.preventDefault();\n      }\n    }\n  },\n  _f2KeyHandler: function _f2KeyHandler() {\n    var isEditing = this._editingController.isEditing(),\n      rowIndex = this.getVisibleRowIndex(),\n      $row = this._focusedView && this._focusedView.getRow(rowIndex);\n    if (!isEditing && isDataRow($row)) {\n      this._startEditing();\n    }\n  },\n  _navigateNextCell: function _navigateNextCell($event, keyCode) {\n    var $cell = this._getNextCell(keyCode);\n    if ($cell && this._isCellValid($cell)) {\n      return this._arrowKeysHandlerFocusCell($event, $cell, true);\n    }\n    return false;\n  },\n  _arrowKeysHandlerFocusCell: function _arrowKeysHandlerFocusCell($event, $cell, upDown) {\n    var args = this._fireFocusChangingEvents($event, $cell, upDown, true);\n    $cell = args.$newCellElement;\n    if (!args.cancel && this._isCellValid($cell)) {\n      this._focus($cell, !args.isHighlighted);\n      return true;\n    }\n    return false;\n  },\n  _beginFastEditing: function _beginFastEditing(originalEvent, isDeleting) {\n    if (!this._isFastEditingAllowed() || originalEvent.altKey || originalEvent.ctrlKey || this._editingController.isEditing()) {\n      return false;\n    }\n    if (isDeleting) {\n      this._startEditing(originalEvent, FAST_EDITING_DELETE_KEY);\n    } else {\n      var key = originalEvent.key,\n        keyCode = originalEvent.keyCode || originalEvent.which,\n        fastEditingKey = key || keyCode && String.fromCharCode(keyCode);\n      if (fastEditingKey && (1 === fastEditingKey.length || fastEditingKey === FAST_EDITING_DELETE_KEY)) {\n        this._startEditing(originalEvent, fastEditingKey);\n      }\n    }\n    return true;\n  },\n  _clickHandler: function _clickHandler(e) {\n    var event = e.event,\n      $target = (0, _renderer2.default)(event.currentTarget),\n      rowsView = this.getView(\"rowsView\"),\n      focusedViewElement = rowsView && rowsView.element(),\n      $parent = $target.parent(),\n      isEditingRow = $parent.hasClass(EDIT_ROW_CLASS),\n      isInteractiveElement = (0, _renderer2.default)(event.target).is(INTERACTIVE_ELEMENTS_SELECTOR);\n    if (this._isEventInCurrentGrid(event) && this._isCellValid($target, !isInteractiveElement)) {\n      $target = this._isInsideEditForm($target) ? (0, _renderer2.default)(event.target) : $target;\n      this._focusView();\n      (0, _renderer2.default)(focusedViewElement).removeClass(FOCUS_STATE_CLASS);\n      if ($parent.hasClass(FREESPACE_ROW_CLASS)) {\n        this._updateFocusedCellPosition($target);\n        this._focusedView.element().attr(\"tabindex\", 0);\n        this._focusedView.focus();\n      } else {\n        if (!this._isMasterDetailCell($target) && !isEditingRow) {\n          this._clickTargetCellHandler(event, $target);\n        } else {\n          this._updateFocusedCellPosition($target);\n        }\n      }\n    } else {\n      if ($target.is(\"td\")) {\n        this._resetFocusedCell();\n      }\n    }\n  },\n  _isEventInCurrentGrid: function _isEventInCurrentGrid(event) {\n    var $grid = (0, _renderer2.default)(event.target).closest(\".\" + this.getWidgetContainerClass()).parent();\n    return $grid.is(this.component.$element());\n  },\n  _clickTargetCellHandler: function _clickTargetCellHandler(event, $cell) {\n    var args,\n      columnIndex = this.getView(\"rowsView\").getCellIndex($cell),\n      column = this._columnsController.getVisibleColumns()[columnIndex],\n      isCellEditMode = this._isCellEditMode();\n    this.setCellFocusType();\n    args = this._fireFocusChangingEvents(event, $cell, true);\n    $cell = args.$newCellElement;\n    if (!args.cancel) {\n      if (args.resetFocusedRow) {\n        this.getController(\"focus\")._resetFocusedRow();\n        return;\n      }\n      if (args.rowIndexChanged) {\n        $cell = this._getFocusedCell();\n      }\n      if (!args.isHighlighted && !isCellEditMode) {\n        this.setRowFocusType();\n      }\n      this._updateFocusedCellPosition($cell);\n      if (this._allowRowUpdating() && isCellEditMode && column && column.allowEditing) {\n        this._isNeedFocus = false;\n        this._isHiddenFocus = false;\n      } else {\n        var $target = event && (0, _renderer2.default)(event.target),\n          isInteractiveTarget = $target && $target.not($cell).is(INTERACTIVE_ELEMENTS_SELECTOR),\n          isDisabled = !args.isHighlighted || isInteractiveTarget;\n        this._focus($cell, isDisabled, isInteractiveTarget);\n      }\n    } else {\n      this.setRowFocusType();\n      this.setFocusedRowIndex(args.prevRowIndex);\n      $cell = this._getFocusedCell();\n      if (this._editingController.isEditing() && isCellEditMode) {\n        this._editingController.closeEditCell();\n      }\n    }\n  },\n  _allowRowUpdating: function _allowRowUpdating() {\n    var rowIndex = this.getVisibleRowIndex(),\n      row = this._dataController.items()[rowIndex];\n    return this._editingController.allowUpdating({\n      row: row\n    }, \"click\");\n  },\n  focus: function focus(element) {\n    var activeElementSelector,\n      focusedRowEnabled = this.option(\"focusedRowEnabled\"),\n      isHighlighted = isCellElement((0, _renderer2.default)(element));\n    if (!element) {\n      activeElementSelector = \".dx-datagrid-rowsview .dx-row[tabindex]\";\n      if (!focusedRowEnabled) {\n        activeElementSelector += \", .dx-datagrid-rowsview .dx-row > td[tabindex]\";\n      }\n      element = this.component.$element().find(activeElementSelector).first();\n    }\n    element && this._focusElement((0, _renderer2.default)(element), isHighlighted);\n  },\n  getFocusedView: function getFocusedView() {\n    return this._focusedView;\n  },\n  setupFocusedView: function setupFocusedView() {\n    if (this.isKeyboardEnabled() && !(0, _type.isDefined)(this._focusedView)) {\n      this._focusView();\n    }\n  },\n  _focusElement: function _focusElement($element, isHighlighted) {\n    var rowsViewElement = (0, _renderer2.default)(this._getRowsViewElement()),\n      $focusedView = $element.closest(rowsViewElement),\n      isRowFocusType = this.isRowFocusType(),\n      args = {};\n    if (!$focusedView.length || isCellElement($element) && !this._isCellValid($element)) {\n      return;\n    }\n    this._focusView();\n    this._isNeedFocus = true;\n    this._isNeedScroll = true;\n    if (isCellElement($element) || isGroupRow($element)) {\n      this.setCellFocusType();\n      args = this._fireFocusChangingEvents(null, $element, false, isHighlighted);\n      $element = args.$newCellElement;\n      if (isRowFocusType && !args.isHighlighted) {\n        this.setRowFocusType();\n      }\n    }\n    this._focus($element, !args.isHighlighted);\n    this._focusInteractiveElement($element);\n  },\n  _getFocusedViewByElement: function _getFocusedViewByElement($element) {\n    var view = this.getFocusedView(),\n      $view = view && (0, _renderer2.default)(view.element());\n    return 0 !== $element.closest($view).length;\n  },\n  _focusView: function _focusView() {\n    this._focusedView = this.getView(\"rowsView\");\n  },\n  _focusInteractiveElement: function _focusInteractiveElement($cell, isLast) {\n    if (!$cell) {\n      return;\n    }\n    var $focusedElement = this._getInteractiveElement($cell, isLast);\n    (0, _uiGrid_core3.focusAndSelectElement)(this, $focusedElement);\n  },\n  _focus: function _focus($cell, disableFocus, isInteractiveElement) {\n    var $row = $cell && $cell.is(\"td\") ? $cell.parent() : $cell;\n    if ($row && isNotFocusedRow($row)) {\n      return;\n    }\n    var $focusElement,\n      $prevFocusedCell = this._getFocusedCell(),\n      focusedView = this._focusedView,\n      $focusViewElement = focusedView && focusedView.element();\n    this._isHiddenFocus = disableFocus;\n    if (isGroupRow($row) || this.isRowFocusType()) {\n      $focusElement = $row;\n      if (focusedView) {\n        this.setFocusedRowIndex(this._getRowIndex($row));\n      }\n    } else {\n      if (isCellElement($cell)) {\n        $focusElement = $cell;\n        this._updateFocusedCellPosition($cell);\n      }\n    }\n    $prevFocusedCell && $prevFocusedCell.is(\"td\") && $prevFocusedCell.not($focusElement).removeAttr(\"tabIndex\");\n    if ($focusElement) {\n      if (!isInteractiveElement) {\n        this._applyTabIndexToElement($focusElement);\n        _events_engine2.default.trigger($focusElement, \"focus\");\n      }\n      if (disableFocus) {\n        $focusViewElement && $focusViewElement.find(\".\" + CELL_FOCUS_DISABLED_CLASS + \"[tabIndex]\").not($focusElement).removeClass(CELL_FOCUS_DISABLED_CLASS).removeAttr(\"tabIndex\");\n        $focusElement.addClass(CELL_FOCUS_DISABLED_CLASS);\n      } else {\n        $focusViewElement && $focusViewElement.find(\".\" + CELL_FOCUS_DISABLED_CLASS + \":not(.\" + MASTER_DETAIL_CELL_CLASS + \")\").removeClass(CELL_FOCUS_DISABLED_CLASS);\n        this.getController(\"editorFactory\").focus($focusElement);\n      }\n    }\n  },\n  _updateFocus: function _updateFocus(isRenderView) {\n    var that = this;\n    setTimeout(function () {\n      var $cell = that._getFocusedCell(),\n        isEditing = that._editingController.isEditing();\n      if ($cell && !(that._isMasterDetailCell($cell) && !that._isRowEditMode())) {\n        if (that._hasSkipRow($cell.parent())) {\n          var direction = that._focusedCellPosition && that._focusedCellPosition.rowIndex > 0 ? \"upArrow\" : \"downArrow\";\n          $cell = that._getNextCell(direction);\n        }\n        if (isElementDefined($cell)) {\n          if (isRenderView && !isEditing && that._checkCellOverlapped($cell)) {\n            return;\n          }\n          if ($cell.is(\"td\") || $cell.hasClass(that.addWidgetPrefix(EDIT_FORM_ITEM_CLASS))) {\n            if (that.getController(\"editorFactory\").focus()) {\n              that._focus($cell);\n            } else {\n              if (that._isCellEditMode()) {\n                that._focus($cell, that._isHiddenFocus);\n              } else {\n                if (that._isHiddenFocus) {\n                  that._focus($cell, true);\n                }\n              }\n            }\n            if (isEditing) {\n              that._focusInteractiveElement.bind(that)($cell);\n            }\n          } else {\n            _events_engine2.default.trigger($cell, \"focus\");\n          }\n        }\n      }\n    });\n  },\n  _checkCellOverlapped: function _checkCellOverlapped($cell) {\n    var cellOffset = $cell.offset(),\n      hasScrollable = this.component.getScrollable && this.component.getScrollable(),\n      isOverlapped = false;\n    if (hasScrollable) {\n      if (cellOffset.left < 0) {\n        isOverlapped = $cell.width() + cellOffset.left <= 0;\n      } else {\n        if (cellOffset.top < 0) {\n          isOverlapped = $cell.height() + cellOffset.top <= 0;\n        }\n      }\n    }\n    return isOverlapped;\n  },\n  _getFocusedCell: function _getFocusedCell() {\n    return (0, _renderer2.default)(this._getCell(this._focusedCellPosition));\n  },\n  _updateFocusedCellPosition: function _updateFocusedCellPosition($cell, direction) {\n    var position = this._getCellPosition($cell, direction);\n    if (position) {\n      if (!$cell.length || position.rowIndex >= 0 && position.columnIndex >= 0) {\n        this.setFocusedCellPosition(position.rowIndex, position.columnIndex);\n      }\n    }\n    return position;\n  },\n  _getCellPosition: function _getCellPosition($cell, direction) {\n    var rowIndex,\n      columnIndex,\n      that = this,\n      $row = isElementDefined($cell) && $cell.closest(\"tr\");\n    if (isElementDefined($row) && that._focusedView) {\n      rowIndex = that._getRowIndex($row);\n      columnIndex = that._focusedView.getCellIndex($cell, rowIndex);\n      if (direction) {\n        columnIndex = \"previous\" === direction ? columnIndex - 1 : columnIndex + 1;\n        columnIndex = that._applyColumnIndexBoundaries(columnIndex);\n      }\n      return {\n        rowIndex: rowIndex,\n        columnIndex: columnIndex\n      };\n    }\n  },\n  _focusCell: function _focusCell($cell) {\n    if (this._isCellValid($cell)) {\n      this._focus($cell);\n      return true;\n    }\n  },\n  _focusEditFormCell: function _focusEditFormCell($cell) {\n    if ($cell.hasClass(MASTER_DETAIL_CELL_CLASS)) {\n      this.getController(\"editorFactory\").focus($cell, true);\n    }\n  },\n  _resetFocusedCell: function _resetFocusedCell() {\n    var that = this,\n      $cell = that._getFocusedCell();\n    $cell && $cell.removeAttr(\"tabIndex\");\n    that._focusedView && that._focusedView.renderFocusState && that._focusedView.renderFocusState();\n    that._isNeedFocus = false;\n    that._isNeedScroll = false;\n    that._focusedCellPosition = {};\n  },\n  restoreFocusableElement: function restoreFocusableElement(rowIndex, $event) {\n    var args,\n      $rowElement,\n      that = this,\n      isUpArrow = (0, _type.isDefined)(rowIndex),\n      rowsView = that.getView(\"rowsView\"),\n      $rowsViewElement = rowsView.element(),\n      columnIndex = that._focusedCellPosition.columnIndex,\n      rowIndexOffset = that._dataController.getRowIndexOffset();\n    rowIndex = isUpArrow ? rowIndex : rowsView.getTopVisibleItemIndex() + rowIndexOffset;\n    if (!isUpArrow) {\n      that.getController(\"editorFactory\").loseFocus();\n      that._applyTabIndexToElement($rowsViewElement);\n      _events_engine2.default.trigger($rowsViewElement, \"focus\");\n    } else {\n      $rowElement = rowsView.getRow(rowIndex - rowIndexOffset);\n      args = that._fireFocusedRowChanging($event, $rowElement);\n      if (!args.cancel && args.rowIndexChanged) {\n        rowIndex = args.newRowIndex;\n      }\n    }\n    if (!isUpArrow || !args.cancel) {\n      that.setFocusedCellPosition(rowIndex, columnIndex);\n    }\n    isUpArrow && that._updateFocus();\n  },\n  _getNewPositionByCode: function _getNewPositionByCode(cellPosition, elementType, code) {\n    var visibleColumnsCount,\n      columnIndex = cellPosition.columnIndex,\n      rowIndex = cellPosition.rowIndex;\n    if (void 0 === cellPosition.rowIndex && \"next\" === code) {\n      return {\n        columnIndex: 0,\n        rowIndex: 0\n      };\n    }\n    switch (code) {\n      case \"nextInRow\":\n      case \"next\":\n        visibleColumnsCount = this._getVisibleColumnCount();\n        if (columnIndex < visibleColumnsCount - 1 && !this._isLastValidCell({\n          columnIndex: columnIndex,\n          rowIndex: rowIndex\n        }) && \"row\" !== elementType) {\n          columnIndex++;\n        } else {\n          if (!this._isLastRow(rowIndex) && \"next\" === code) {\n            columnIndex = 0;\n            rowIndex++;\n          }\n        }\n        break;\n      case \"previousInRow\":\n      case \"previous\":\n        if (columnIndex > 0 && !this._isFirstValidCell({\n          columnIndex: columnIndex,\n          rowIndex: rowIndex\n        }) && \"row\" !== elementType) {\n          columnIndex--;\n        } else {\n          if (rowIndex > 0 && \"previous\" === code) {\n            rowIndex--;\n            visibleColumnsCount = this._getVisibleColumnCount();\n            columnIndex = visibleColumnsCount - 1;\n          }\n        }\n        break;\n      case \"upArrow\":\n        rowIndex = rowIndex > 0 ? rowIndex - 1 : rowIndex;\n        break;\n      case \"downArrow\":\n        rowIndex = !this._isLastRow(rowIndex) ? rowIndex + 1 : rowIndex;\n    }\n    return {\n      columnIndex: columnIndex,\n      rowIndex: rowIndex\n    };\n  },\n  setFocusedCellPosition: function setFocusedCellPosition(rowIndex, columnIndex) {\n    this.setFocusedRowIndex(rowIndex);\n    this.setFocusedColumnIndex(columnIndex);\n  },\n  setFocusedRowIndex: function setFocusedRowIndex(rowIndex) {\n    if (!this._focusedCellPosition) {\n      this._focusedCellPosition = {};\n    }\n    this._focusedCellPosition.rowIndex = rowIndex;\n  },\n  setFocusedColumnIndex: function setFocusedColumnIndex(columnIndex) {\n    if (!this._focusedCellPosition) {\n      this._focusedCellPosition = {};\n    }\n    this._focusedCellPosition.columnIndex = columnIndex;\n  },\n  getVisibleRowIndex: function getVisibleRowIndex() {\n    if (this._focusedCellPosition) {\n      if (!this._focusedCellPosition.rowIndex) {\n        return this._focusedCellPosition.rowIndex;\n      }\n      return this._focusedCellPosition.rowIndex - this._dataController.getRowIndexOffset();\n    }\n    return null;\n  },\n  getVisibleColumnIndex: function getVisibleColumnIndex() {\n    if (this._focusedCellPosition) {\n      return (0, _type.isDefined)(this._focusedCellPosition.columnIndex) ? this._focusedCellPosition.columnIndex : -1;\n    }\n    return -1;\n  },\n  getFocusedColumnIndex: function getFocusedColumnIndex() {\n    return this._focusedCellPosition ? this._focusedCellPosition.columnIndex : null;\n  },\n  _applyColumnIndexBoundaries: function _applyColumnIndexBoundaries(columnIndex) {\n    var visibleColumnsCount = this._getVisibleColumnCount();\n    if (columnIndex < 0) {\n      columnIndex = 0;\n    } else {\n      if (columnIndex >= visibleColumnsCount) {\n        columnIndex = visibleColumnsCount - 1;\n      }\n    }\n    return columnIndex;\n  },\n  _isCellByPositionValid: function _isCellByPositionValid(cellPosition) {\n    var $cell = (0, _renderer2.default)(this._getCell(cellPosition));\n    return this._isCellValid($cell);\n  },\n  _isLastRow: function _isLastRow(rowIndex) {\n    if (this._isVirtualScrolling()) {\n      return rowIndex >= this._dataController.totalItemsCount() - 1;\n    }\n    return rowIndex === this.getController(\"data\").items().length - 1;\n  },\n  _isFirstValidCell: function _isFirstValidCell(cellPosition) {\n    var isFirstValidCell = false;\n    if (0 === cellPosition.rowIndex && cellPosition.columnIndex >= 0) {\n      isFirstValidCell = isFirstValidCell || !this._haveValidCellBeforePosition(cellPosition);\n    }\n    return isFirstValidCell;\n  },\n  _haveValidCellBeforePosition: function _haveValidCellBeforePosition(cellPosition) {\n    var columnIndex = cellPosition.columnIndex,\n      hasValidCells = false;\n    while (columnIndex > 0 && !hasValidCells) {\n      var checkingPosition = {\n        columnIndex: --columnIndex,\n        rowIndex: cellPosition.rowIndex\n      };\n      hasValidCells = this._isCellByPositionValid(checkingPosition);\n    }\n    return hasValidCells;\n  },\n  _isLastValidCell: function _isLastValidCell(cellPosition) {\n    var nextColumnIndex = cellPosition.columnIndex >= 0 ? cellPosition.columnIndex + 1 : 0,\n      checkingPosition = {\n        columnIndex: nextColumnIndex,\n        rowIndex: cellPosition.rowIndex\n      },\n      visibleColumnsCount = this._getVisibleColumnCount(),\n      isCheckingCellValid = this._isCellByPositionValid(checkingPosition);\n    if (!this._isLastRow(cellPosition.rowIndex)) {\n      return false;\n    }\n    if (cellPosition.columnIndex === visibleColumnsCount - 1) {\n      return true;\n    }\n    if (isCheckingCellValid) {\n      return false;\n    }\n    return this._isLastValidCell(checkingPosition);\n  },\n  _isCellValid: function _isCellValid($cell, isClick) {\n    if (isElementDefined($cell)) {\n      var rowsView = this.getView(\"rowsView\"),\n        $row = $cell.parent(),\n        visibleColumns = this._columnsController.getVisibleColumns(),\n        columnIndex = rowsView.getCellIndex($cell),\n        column = visibleColumns[columnIndex],\n        visibleColumnCount = this._getVisibleColumnCount(),\n        editingController = this._editingController,\n        isMasterDetailRow = isDetailRow($row),\n        isShowWhenGrouped = column && column.showWhenGrouped,\n        isDataCell = column && !$cell.hasClass(COMMAND_EXPAND_CLASS) && isDataRow($row),\n        isValidGroupSpaceColumn = function isValidGroupSpaceColumn() {\n          return !isMasterDetailRow && column && (!(0, _type.isDefined)(column.groupIndex) || isShowWhenGrouped && isDataCell) || parseInt($cell.attr(\"colspan\")) > 1;\n        };\n      if (this._isMasterDetailCell($cell)) {\n        return true;\n      }\n      if (visibleColumnCount > columnIndex && isValidGroupSpaceColumn()) {\n        var rowItems = this._dataController.items(),\n          visibleRowIndex = rowsView.getRowIndex($row),\n          row = rowItems[visibleRowIndex],\n          isCellEditing = editingController && this._isCellEditMode() && editingController.isEditing(),\n          isRowEditingInCurrentRow = editingController && editingController.isEditRow(visibleRowIndex),\n          isEditing = isRowEditingInCurrentRow || isCellEditing;\n        if (column.command) {\n          if (this._isLegacyNavigation()) {\n            return !isEditing && \"expand\" === column.command;\n          }\n          if (isCellEditing) {\n            return !column.command;\n          }\n          if (isRowEditingInCurrentRow) {\n            return \"select\" !== column.command;\n          }\n          return !isEditing;\n        }\n        if (isCellEditing && row && \"data\" !== row.rowType) {\n          return false;\n        }\n        return !isEditing || column.allowEditing || isClick;\n      }\n    }\n  },\n  getFirstValidCellInRow: function getFirstValidCellInRow($row, columnIndex) {\n    var $cell,\n      $result,\n      that = this,\n      $cells = $row.find(\"> td\");\n    columnIndex = columnIndex || 0;\n    for (var i = columnIndex; i < $cells.length; ++i) {\n      $cell = $cells.eq(i);\n      if (that._isCellValid($cell)) {\n        $result = $cell;\n        break;\n      }\n    }\n    return $result;\n  },\n  _getNextCell: function _getNextCell(keyCode, elementType, cellPosition) {\n    var rowIndex,\n      newFocusedCellPosition,\n      $cell,\n      $row,\n      focusedCellPosition = cellPosition || this._focusedCellPosition,\n      isRowFocusType = this.isRowFocusType(),\n      includeCommandCells = isRowFocusType || (0, _array.inArray)(keyCode, [\"next\", \"previous\"]) > -1,\n      isLastCellOnDirection = \"previous\" === keyCode ? this._isFirstValidCell(focusedCellPosition) : this._isLastValidCell(focusedCellPosition);\n    if (this._focusedView && focusedCellPosition) {\n      newFocusedCellPosition = this._getNewPositionByCode(focusedCellPosition, elementType, keyCode);\n      $cell = (0, _renderer2.default)(this._getCell(newFocusedCellPosition));\n      if (isElementDefined($cell) && !this._isCellValid($cell) && this._isCellInRow(newFocusedCellPosition, includeCommandCells) && !isLastCellOnDirection) {\n        if (isRowFocusType) {\n          $cell = this.getFirstValidCellInRow($cell.parent(), newFocusedCellPosition.columnIndex);\n        } else {\n          $cell = this._getNextCell(keyCode, \"cell\", newFocusedCellPosition);\n        }\n      }\n      $row = isElementDefined($cell) && $cell.parent();\n      if (this._hasSkipRow($row)) {\n        rowIndex = this._getRowIndex($row);\n        if (!this._isLastRow(rowIndex)) {\n          $cell = this._getNextCell(keyCode, \"row\", {\n            columnIndex: focusedCellPosition.columnIndex,\n            rowIndex: rowIndex\n          });\n        } else {\n          return null;\n        }\n      }\n      return isElementDefined($cell) ? $cell : null;\n    }\n    return null;\n  },\n  _startEditing: function _startEditing(eventArgs, fastEditingKey) {\n    var focusedCellPosition = this._focusedCellPosition,\n      rowIndex = this.getVisibleRowIndex(),\n      row = this._dataController.items()[rowIndex],\n      column = this._columnsController.getVisibleColumns()[focusedCellPosition.columnIndex],\n      isAllowEditing = this._editingController.allowUpdating({\n        row: row\n      }) && column && column.allowEditing;\n    if (isAllowEditing) {\n      if (this._isRowEditMode()) {\n        this._editingController.editRow(rowIndex);\n      } else {\n        if (focusedCellPosition) {\n          this._startEditingCell(eventArgs, fastEditingKey);\n        }\n      }\n    }\n  },\n  _startEditingCell: function _startEditingCell(eventArgs, fastEditingKey) {\n    var deferred,\n      that = this,\n      rowIndex = this.getVisibleRowIndex(),\n      colIndex = this._focusedCellPosition.columnIndex;\n    this._fastEditingStarted = (0, _type.isDefined)(fastEditingKey);\n    deferred = this._editingController.editCell(rowIndex, colIndex);\n    if (this._isFastEditingStarted()) {\n      if (true === deferred) {\n        that._editingCellHandler(eventArgs, fastEditingKey);\n      } else {\n        if (deferred && deferred.done) {\n          var editorValue = fastEditingKey !== FAST_EDITING_DELETE_KEY ? fastEditingKey : \"\";\n          deferred.done(function () {\n            return that._editingCellHandler(eventArgs, editorValue);\n          });\n        }\n      }\n    }\n  },\n  _editingCellHandler: function _editingCellHandler(eventArgs, editorValue) {\n    var $input = this._getFocusedCell().find(\".dx-texteditor-input\").eq(0),\n      keyDownEvent = _utils2.default.createEvent(eventArgs, {\n        type: \"keydown\",\n        target: $input.get(0)\n      }),\n      keyPressEvent = _utils2.default.createEvent(eventArgs, {\n        type: \"keypress\",\n        target: $input.get(0)\n      }),\n      inputEvent = _utils2.default.createEvent(eventArgs, {\n        type: \"input\",\n        target: $input.get(0)\n      });\n    _events_engine2.default.trigger($input, keyDownEvent);\n    if (!keyDownEvent.isDefaultPrevented()) {\n      _events_engine2.default.trigger($input, keyPressEvent);\n      if (!keyPressEvent.isDefaultPrevented()) {\n        setTimeout(function () {\n          $input.val(editorValue);\n          var $widgetContainer = $input.closest(\".\" + WIDGET_CLASS);\n          _events_engine2.default.off($widgetContainer, \"focusout\");\n          _events_engine2.default.one($widgetContainer, \"focusout\", function () {\n            _events_engine2.default.trigger($input, \"change\");\n          });\n          _events_engine2.default.trigger($input, inputEvent);\n        });\n      }\n    }\n  },\n  _fireFocusChangingEvents: function _fireFocusChangingEvents($event, $cell, fireRowEvent, isHighlighted) {\n    var args = {},\n      cellPosition = this._getCellPosition($cell) || {};\n    if (this.isCellFocusType()) {\n      args = this._fireFocusedCellChanging($event, $cell, isHighlighted);\n      if (!args.cancel) {\n        cellPosition.columnIndex = args.newColumnIndex;\n        cellPosition.rowIndex = args.newRowIndex;\n        isHighlighted = args.isHighlighted;\n        $cell = (0, _renderer2.default)(this._getCell(cellPosition));\n      }\n    }\n    if (!args.cancel && fireRowEvent && $cell) {\n      args = this._fireFocusedRowChanging($event, $cell.parent());\n      if (!args.cancel) {\n        cellPosition.rowIndex = args.newRowIndex;\n        args.isHighlighted = isHighlighted;\n      }\n    }\n    args.$newCellElement = (0, _renderer2.default)(this._getCell(cellPosition));\n    if (!args.$newCellElement.length) {\n      args.$newCellElement = $cell;\n    }\n    return args;\n  },\n  _fireFocusedCellChanging: function _fireFocusedCellChanging($event, $cellElement, isHighlighted) {\n    var that = this,\n      prevCellIndex = that.option(\"focusedColumnIndex\"),\n      prevRowIndex = that.option(\"focusedRowIndex\"),\n      cellPosition = that._getCellPosition($cellElement),\n      columnIndex = cellPosition ? cellPosition.columnIndex : -1,\n      rowIndex = cellPosition ? cellPosition.rowIndex : -1,\n      args = {\n        cellElement: $cellElement,\n        prevColumnIndex: prevCellIndex,\n        prevRowIndex: prevRowIndex,\n        newColumnIndex: columnIndex,\n        newRowIndex: rowIndex,\n        rows: that.getController(\"data\").getVisibleRows(),\n        columns: that.getController(\"columns\").getVisibleColumns(),\n        event: $event,\n        isHighlighted: isHighlighted || false,\n        cancel: false\n      };\n    this._canceledCellPosition = null;\n    that.executeAction(\"onFocusedCellChanging\", args);\n    if (args.newColumnIndex !== columnIndex || args.newRowIndex !== rowIndex) {\n      args.$newCellElement = (0, _renderer2.default)(this._getCell({\n        columnIndex: args.newColumnIndex,\n        rowIndex: args.newRowIndex\n      }));\n    }\n    if (args.cancel) {\n      this._canceledCellPosition = {\n        rowIndex: rowIndex,\n        columnIndex: columnIndex\n      };\n    }\n    return args;\n  },\n  _fireFocusedCellChanged: function _fireFocusedCellChanged($cellElement, prevCellIndex, prevRowIndex) {\n    var that = this,\n      dataController = that.getController(\"data\"),\n      columnIndex = that.getView(\"rowsView\").getCellIndex($cellElement),\n      rowIndex = this._getRowIndex($cellElement && $cellElement.parent()),\n      localRowIndex = Math.min(rowIndex - dataController.getRowIndexOffset(), dataController.items().length - 1),\n      isEditingCell = that.getController(\"editing\").isEditCell(localRowIndex, columnIndex),\n      row = dataController.items()[localRowIndex];\n    if (!isEditingCell && (prevCellIndex !== columnIndex || prevRowIndex !== rowIndex)) {\n      dataController = that.getController(\"data\");\n      that.executeAction(\"onFocusedCellChanged\", {\n        cellElement: $cellElement,\n        columnIndex: columnIndex,\n        rowIndex: rowIndex,\n        row: row,\n        column: that.getController(\"columns\").getVisibleColumns()[columnIndex]\n      });\n    }\n  },\n  _fireFocusedRowChanging: function _fireFocusedRowChanging(eventArgs, $newFocusedRow) {\n    var newRowIndex = this._getRowIndex($newFocusedRow),\n      dataController = this.getController(\"data\"),\n      prevFocusedRowIndex = this.option(\"focusedRowIndex\"),\n      loadingOperationTypes = dataController.loadingOperationTypes(),\n      args = {\n        rowElement: $newFocusedRow,\n        prevRowIndex: prevFocusedRowIndex,\n        newRowIndex: newRowIndex,\n        event: eventArgs,\n        rows: this.getController(\"data\").getVisibleRows(),\n        cancel: false\n      };\n    if (!dataController || dataController.isLoading() && (loadingOperationTypes.reload || loadingOperationTypes.paging)) {\n      args.cancel = true;\n      return args;\n    }\n    if (this.option(\"focusedRowEnabled\")) {\n      this.executeAction(\"onFocusedRowChanging\", args);\n      if (!args.cancel && args.newRowIndex !== newRowIndex) {\n        args.resetFocusedRow = args.newRowIndex < 0;\n        if (!args.resetFocusedRow) {\n          this.setFocusedRowIndex(args.newRowIndex);\n        }\n        args.rowIndexChanged = true;\n      }\n    }\n    return args;\n  },\n  _fireFocusedRowChanged: function _fireFocusedRowChanged($rowElement) {\n    var row,\n      dataController,\n      focusedRowIndex = this.option(\"focusedRowIndex\");\n    if (this.option(\"focusedRowEnabled\")) {\n      if (focusedRowIndex >= 0) {\n        dataController = this.getController(\"data\");\n        row = focusedRowIndex >= 0 && dataController.getVisibleRows()[focusedRowIndex - dataController.getRowIndexOffset()];\n      }\n      this.executeAction(\"onFocusedRowChanged\", {\n        rowElement: $rowElement,\n        rowIndex: focusedRowIndex,\n        row: row\n      });\n    }\n  },\n  _isRowEditMode: function _isRowEditMode() {\n    var editMode = this.getController(\"editing\").getEditMode();\n    return editMode === EDIT_MODE_ROW || editMode === EDIT_MODE_FORM;\n  },\n  _isCellEditMode: function _isCellEditMode() {\n    var editMode = this.getController(\"editing\").getEditMode();\n    return editMode === EDIT_MODE_CELL || editMode === EDIT_MODE_BATCH;\n  },\n  _isFastEditingAllowed: function _isFastEditingAllowed() {\n    return this._isCellEditMode() && this.option(\"keyboardNavigation.editOnKeyPress\");\n  },\n  _getInteractiveElement: function _getInteractiveElement($cell, isLast) {\n    var $focusedElement = $cell.find(INTERACTIVE_ELEMENTS_SELECTOR).filter(\":visible\");\n    return isLast ? $focusedElement.last() : $focusedElement.first();\n  },\n  _applyTabIndexToElement: function _applyTabIndexToElement($element) {\n    var tabIndex = this.option(\"tabIndex\");\n    $element.attr(\"tabIndex\", (0, _type.isDefined)(tabIndex) ? tabIndex : 0);\n  },\n  _getCell: function _getCell(cellPosition) {\n    if (this._focusedView && cellPosition) {\n      return this._focusedView.getCell({\n        rowIndex: cellPosition.rowIndex - this._dataController.getRowIndexOffset(),\n        columnIndex: cellPosition.columnIndex\n      });\n    }\n  },\n  _getRowIndex: function _getRowIndex($row) {\n    var that = this,\n      focusedView = that._focusedView,\n      rowIndex = -1;\n    if (focusedView) {\n      rowIndex = focusedView.getRowIndex($row);\n    }\n    if (rowIndex >= 0) {\n      rowIndex += that._dataController.getRowIndexOffset();\n    }\n    return rowIndex;\n  },\n  _hasSkipRow: function _hasSkipRow($row) {\n    var row = $row && $row.get(0);\n    return row && (\"none\" === row.style.display || $row.hasClass(this.addWidgetPrefix(GROUP_FOOTER_CLASS)) || isDetailRow($row) && !$row.hasClass(this.addWidgetPrefix(EDIT_FORM_CLASS)));\n  },\n  _allowEditingOnEnterKey: function _allowEditingOnEnterKey() {\n    return \"startEdit\" === this.option(\"keyboardNavigation.enterKeyAction\");\n  },\n  _isLegacyNavigation: function _isLegacyNavigation() {\n    return this.option(\"useLegacyKeyboardNavigation\");\n  },\n  _getDirectionCodeByKey: function _getDirectionCodeByKey(key) {\n    var directionCode;\n    if (this.option(\"rtlEnabled\")) {\n      directionCode = \"leftArrow\" === key ? \"nextInRow\" : \"previousInRow\";\n    } else {\n      directionCode = \"leftArrow\" === key ? \"previousInRow\" : \"nextInRow\";\n    }\n    return directionCode;\n  },\n  _isVirtualScrolling: function _isVirtualScrolling() {\n    var scrollingMode = this.option(\"scrolling.mode\");\n    return \"virtual\" === scrollingMode || \"infinite\" === scrollingMode;\n  },\n  _scrollBy: function _scrollBy(top, rowIndex, $event) {\n    var that = this,\n      scrollable = this.getView(\"rowsView\").getScrollable();\n    if (that._focusedCellPosition) {\n      var scrollHandler = function scrollHandler() {\n        scrollable.off(\"scroll\", scrollHandler);\n        setTimeout(that.restoreFocusableElement.bind(that, rowIndex, $event));\n      };\n      scrollable.on(\"scroll\", scrollHandler);\n    }\n    scrollable.scrollBy({\n      left: 0,\n      top: top\n    });\n  },\n  _isInsideEditForm: function _isInsideEditForm(element) {\n    return (0, _renderer2.default)(element).closest(\".\" + this.addWidgetPrefix(EDIT_FORM_CLASS)).length > 0;\n  },\n  _isMasterDetailCell: function _isMasterDetailCell(element) {\n    var $masterDetailCell = (0, _renderer2.default)(element).closest(\".\" + MASTER_DETAIL_CELL_CLASS),\n      $masterDetailGrid = $masterDetailCell.closest(\".\" + this.getWidgetContainerClass()).parent();\n    return $masterDetailCell.length && $masterDetailGrid.is(this.component.$element());\n  },\n  _processNextCellInMasterDetail: function _processNextCellInMasterDetail($nextCell) {\n    if (!this._isInsideEditForm($nextCell) && $nextCell) {\n      this._applyTabIndexToElement($nextCell);\n    }\n  },\n  _handleTabKeyOnMasterDetailCell: function _handleTabKeyOnMasterDetailCell(target, direction) {\n    if (this._isMasterDetailCell(target)) {\n      this._updateFocusedCellPosition((0, _renderer2.default)(target), direction);\n      var $nextCell = this._getNextCell(direction, \"row\");\n      this._processNextCellInMasterDetail($nextCell);\n      return true;\n    }\n    return false;\n  },\n  _getElementType: function _getElementType(target) {\n    return (0, _renderer2.default)(target).is(\"tr\") ? \"row\" : \"cell\";\n  },\n  _isFastEditingStarted: function _isFastEditingStarted() {\n    return this._isFastEditingAllowed() && this._fastEditingStarted;\n  },\n  _getVisibleColumnCount: function _getVisibleColumnCount() {\n    return this.getController(\"columns\").getVisibleColumns().length;\n  },\n  _isCellInRow: function _isCellInRow(cellPosition, includeCommandCells) {\n    var columnIndex = cellPosition.columnIndex,\n      visibleColumnsCount = this._getVisibleColumnCount();\n    return includeCommandCells ? columnIndex >= 0 && columnIndex <= visibleColumnsCount - 1 : columnIndex > 0 && columnIndex < visibleColumnsCount - 1;\n  },\n  _getCellElementFromTarget: function _getCellElementFromTarget(target) {\n    return (0, _renderer2.default)(target).closest(\".\" + ROW_CLASS + \"> td\");\n  },\n  _scrollToElement: function _scrollToElement($element, offset) {\n    var scrollable = this._focusedView.getScrollable();\n    scrollable && scrollable.update();\n    scrollable && scrollable.scrollToElement($element, offset);\n  },\n  _getRowsViewElement: function _getRowsViewElement() {\n    var rowsView = this.getView(\"rowsView\");\n    return rowsView && rowsView.element();\n  },\n  isKeyboardEnabled: function isKeyboardEnabled() {\n    return this.option(\"keyboardNavigation.enabled\");\n  },\n  _processCanceledEditCellPosition: function _processCanceledEditCellPosition(rowIndex, columnIndex) {\n    if (this._canceledCellPosition) {\n      var isCanceled = this._canceledCellPosition.rowIndex === rowIndex && this._canceledCellPosition.columnIndex === columnIndex;\n      this._canceledCellPosition = null;\n      return isCanceled;\n    }\n  }\n});\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      useLegacyKeyboardNavigation: false,\n      keyboardNavigation: {\n        enabled: true,\n        enterKeyAction: \"startEdit\",\n        enterKeyDirection: \"none\",\n        editOnKeyPress: false\n      }\n    };\n  },\n  controllers: {\n    keyboardNavigation: KeyboardNavigationController\n  },\n  extenders: {\n    views: {\n      rowsView: {\n        _rowClick: function _rowClick(e) {\n          var editRowIndex = this.getController(\"editing\").getEditRowIndex();\n          if (editRowIndex === e.rowIndex) {\n            this.getController(\"keyboardNavigation\").setCellFocusType();\n          }\n          this.callBase.apply(this, arguments);\n        },\n        renderFocusState: function renderFocusState() {\n          var cellElements,\n            dataController = this._dataController,\n            rowIndex = this.option(\"focusedRowIndex\") || 0,\n            $element = this.element();\n          if ($element && !(0, _selectors.focused)($element)) {\n            $element.attr(\"tabIndex\", null);\n          }\n          if (rowIndex < 0 || rowIndex >= dataController.getVisibleRows().length) {\n            rowIndex = 0;\n          }\n          cellElements = this.getCellElements(rowIndex);\n          if (this.getController(\"keyboardNavigation\").isKeyboardEnabled() && cellElements) {\n            this.updateFocusElementTabIndex(cellElements);\n          }\n        },\n        updateFocusElementTabIndex: function updateFocusElementTabIndex(cellElements) {\n          var that = this,\n            $row = cellElements.eq(0).parent(),\n            columnIndex = that.option(\"focusedColumnIndex\"),\n            tabIndex = that.option(\"tabIndex\") || 0;\n          if (!columnIndex || columnIndex < 0) {\n            columnIndex = 0;\n          }\n          if (isGroupRow($row)) {\n            $row.attr(\"tabIndex\", tabIndex);\n          } else {\n            that._updateFocusedCellTabIndex(cellElements, columnIndex);\n          }\n        },\n        _updateFocusedCellTabIndex: function _updateFocusedCellTabIndex(cellElements, columnIndex) {\n          var $cell,\n            that = this,\n            tabIndex = that.option(\"tabIndex\") || 0,\n            keyboardNavigation = that.getController(\"keyboardNavigation\"),\n            oldFocusedView = keyboardNavigation._focusedView,\n            cellElementsLength = cellElements ? cellElements.length : -1;\n          keyboardNavigation._focusedView = that;\n          if (cellElementsLength > 0) {\n            if (cellElementsLength <= columnIndex) {\n              columnIndex = cellElementsLength - 1;\n            }\n            for (var i = columnIndex; i < cellElementsLength; ++i) {\n              $cell = (0, _renderer2.default)(cellElements[i]);\n              if (!keyboardNavigation._isMasterDetailCell($cell)) {\n                if (keyboardNavigation._isCellValid($cell) && isCellElement($cell)) {\n                  $cell.attr(\"tabIndex\", tabIndex);\n                  keyboardNavigation.setCellFocusType();\n                  break;\n                }\n              }\n            }\n          }\n          keyboardNavigation._focusedView = oldFocusedView;\n        },\n        renderDelayedTemplates: function renderDelayedTemplates(change) {\n          this.callBase.apply(this, arguments);\n          if (!change || !change.repaintChangesOnly) {\n            this.renderFocusState();\n          }\n        },\n        _renderCore: function _renderCore(change) {\n          this.callBase(change);\n          if (!change || !change.repaintChangesOnly) {\n            this.renderFocusState();\n          }\n        },\n        _editCellPrepared: function _editCellPrepared($cell) {\n          var editorInstance = this._getEditorInstance($cell),\n            keyboardController = this.getController(\"keyboardNavigation\"),\n            isEditingNavigationMode = keyboardController && keyboardController._isFastEditingStarted();\n          if (editorInstance && isEditingNavigationMode) {\n            this._handleEditingNavigationMode(editorInstance);\n          }\n          this.callBase.apply(this, arguments);\n        },\n        _handleEditingNavigationMode: function _handleEditingNavigationMode(editorInstance) {\n          [\"downArrow\", \"upArrow\"].forEach(function (keyName) {\n            var originalKeyHandler = editorInstance._supportedKeys()[keyName];\n            editorInstance.registerKeyHandler(keyName, function (e) {\n              var isDropDownOpened = \"true\" === editorInstance._input().attr(\"aria-expanded\");\n              if (isDropDownOpened) {\n                return originalKeyHandler && originalKeyHandler.call(editorInstance, e);\n              }\n            });\n          });\n          editorInstance.registerKeyHandler(\"leftArrow\", _common.noop);\n          editorInstance.registerKeyHandler(\"rightArrow\", _common.noop);\n          var isDateBoxWithMask = editorInstance.NAME === DATEBOX_WIDGET_NAME && editorInstance.option(\"useMaskBehavior\");\n          if (isDateBoxWithMask) {\n            editorInstance.registerKeyHandler(\"enter\", _common.noop);\n          }\n        },\n        _getEditorInstance: function _getEditorInstance($cell) {\n          var $editor = $cell.find(\".dx-texteditor\").eq(0);\n          return (0, _uiGrid_core3.getWidgetInstance)($editor);\n        }\n      }\n    },\n    controllers: {\n      editing: {\n        editCell: function editCell(rowIndex, columnIndex) {\n          var keyboardController = this.getController(\"keyboardNavigation\");\n          if (keyboardController._processCanceledEditCellPosition(rowIndex, columnIndex)) {\n            return false;\n          }\n          var isCellEditing = this.callBase(rowIndex, columnIndex);\n          if (isCellEditing) {\n            keyboardController.setupFocusedView();\n          }\n          return isCellEditing;\n        },\n        editRow: function editRow(rowIndex) {\n          var keyboardController = this.getController(\"keyboardNavigation\"),\n            columnIndex = this.option(\"focusedColumnIndex\"),\n            column = this._columnsController.getVisibleColumns()[columnIndex];\n          if (column && column.type || this.option(\"editing.mode\") === EDIT_MODE_FORM) {\n            keyboardController._resetFocusedCell();\n          }\n          this.callBase(rowIndex);\n        },\n        addRow: function addRow(parentKey) {\n          this.getController(\"keyboardNavigation\").setupFocusedView();\n          this.callBase.apply(this, arguments);\n        },\n        getFocusedCellInRow: function getFocusedCellInRow(rowIndex) {\n          var keyboardNavigationController = this.getController(\"keyboardNavigation\"),\n            $cell = this.callBase(rowIndex);\n          if (keyboardNavigationController.isKeyboardEnabled() && keyboardNavigationController._focusedCellPosition.rowIndex === rowIndex) {\n            var $focusedCell = keyboardNavigationController._getFocusedCell();\n            if (isElementDefined($focusedCell) && !$focusedCell.hasClass(\"dx-command-edit\")) {\n              $cell = $focusedCell;\n            }\n          }\n          return $cell;\n        },\n        _processCanceledEditingCell: function _processCanceledEditingCell() {\n          var _this = this;\n          this.closeEditCell().done(function () {\n            var keyboardNavigation = _this.getController(\"keyboardNavigation\");\n            keyboardNavigation._updateFocus();\n          });\n        },\n        init: function init() {\n          this.callBase();\n          this._keyboardNavigationController = this.getController(\"keyboardNavigation\");\n        },\n        closeEditCell: function closeEditCell() {\n          this.getController(\"keyboardNavigation\")._fastEditingStarted = false;\n          return this.callBase.apply(this, arguments);\n        },\n        _delayedInputFocus: function _delayedInputFocus() {\n          this._keyboardNavigationController._isNeedScroll = true;\n          this.callBase.apply(this, arguments);\n        },\n        _isEditingStart: function _isEditingStart() {\n          var keyboardNavigation = this.getController(\"keyboardNavigation\"),\n            cancel = this.callBase.apply(this, arguments);\n          if (cancel && !keyboardNavigation._isNeedFocus) {\n            var $cell = keyboardNavigation._getFocusedCell();\n            keyboardNavigation._focus($cell, true);\n          }\n          return cancel;\n        }\n      },\n      data: {\n        _correctRowIndices: function _correctRowIndices(getRowIndexCorrection) {\n          var that = this,\n            keyboardNavigationController = that.getController(\"keyboardNavigation\"),\n            editorFactory = that.getController(\"editorFactory\"),\n            focusedCellPosition = keyboardNavigationController._focusedCellPosition;\n          that.callBase.apply(that, arguments);\n          if (focusedCellPosition && focusedCellPosition.rowIndex >= 0) {\n            var focusedRowIndexCorrection = getRowIndexCorrection(focusedCellPosition.rowIndex);\n            if (focusedRowIndexCorrection) {\n              focusedCellPosition.rowIndex += focusedRowIndexCorrection;\n              editorFactory.focus(editorFactory.focus());\n            }\n          }\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}