{"ast":null,"code":"/**\r\n * DevExtreme (ui/date_box/ui.date_box.strategy.calendar_with_time.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\"),\n  window = require(\"../../core/utils/window\").getWindow(),\n  CalendarStrategy = require(\"./ui.date_box.strategy.calendar\"),\n  TimeView = require(\"./ui.time_view\"),\n  dateLocalization = require(\"../../localization/date\"),\n  extend = require(\"../../core/utils/extend\").extend,\n  Box = require(\"../box\"),\n  uiDateUtils = require(\"./ui.date_utils\");\nvar SHRINK_VIEW_SCREEN_WIDTH = 573,\n  DATEBOX_ADAPTIVITY_MODE_CLASS = \"dx-datebox-adaptivity-mode\";\nvar CalendarWithTimeStrategy = CalendarStrategy.inherit({\n  NAME: \"CalendarWithTime\",\n  getDefaultOptions: function getDefaultOptions() {\n    return extend(this.callBase(), {\n      applyValueMode: \"useButtons\",\n      buttonsLocation: \"bottom after\",\n      showPopupTitle: false\n    });\n  },\n  getDisplayFormat: function getDisplayFormat(displayFormat) {\n    return displayFormat || \"shortdateshorttime\";\n  },\n  _is24HourFormat: function _is24HourFormat() {\n    return dateLocalization.is24HourFormat(this.getDisplayFormat(this.dateBox.option(\"displayFormat\")));\n  },\n  _renderWidget: function _renderWidget() {\n    this.callBase();\n    this._timeView = this.dateBox._createComponent($(\"<div>\"), TimeView, {\n      value: this.dateBoxValue(),\n      _showClock: !this._isShrinkView(),\n      use24HourFormat: this._is24HourFormat(),\n      onValueChanged: this._valueChangedHandler.bind(this),\n      stylingMode: this.dateBox.option(\"stylingMode\")\n    });\n  },\n  renderOpenedState: function renderOpenedState() {\n    this.callBase();\n    var popup = this._getPopup();\n    if (popup) {\n      popup._wrapper().toggleClass(DATEBOX_ADAPTIVITY_MODE_CLASS, this._isSmallScreen());\n    }\n    clearTimeout(this._repaintTimer);\n    this._repaintTimer = setTimeout(function () {\n      this._getPopup() && this._getPopup().repaint();\n    }.bind(this), 0);\n  },\n  isAdaptivityChanged: function isAdaptivityChanged() {\n    var isAdaptiveMode = this._isShrinkView(),\n      currentAdaptiveMode = this._currentAdaptiveMode;\n    if (isAdaptiveMode !== currentAdaptiveMode) {\n      this._currentAdaptiveMode = isAdaptiveMode;\n      return void 0 !== currentAdaptiveMode;\n    }\n    return this.callBase();\n  },\n  _updateValue: function _updateValue(preventDefaultValue) {\n    var date = this.dateBoxValue();\n    if (!date && !preventDefaultValue) {\n      date = new Date();\n      uiDateUtils.normalizeTime(date);\n    }\n    this.callBase();\n    if (this._timeView) {\n      date && this._timeView.option(\"value\", date);\n      this._timeView.option(\"use24HourFormat\", this._is24HourFormat());\n    }\n  },\n  _isSmallScreen: function _isSmallScreen() {\n    return $(window).width() <= SHRINK_VIEW_SCREEN_WIDTH;\n  },\n  _isShrinkView: function _isShrinkView() {\n    return !this.dateBox.option(\"showAnalogClock\") || this.dateBox.option(\"adaptivityEnabled\") && this._isSmallScreen();\n  },\n  _getBoxItems: function _getBoxItems() {\n    var items = [{\n      ratio: 0,\n      shrink: 0,\n      baseSize: \"auto\",\n      name: \"calendar\"\n    }];\n    if (!this._isShrinkView()) {\n      items.push({\n        ratio: 0,\n        shrink: 0,\n        baseSize: \"auto\",\n        name: \"time\"\n      });\n    }\n    return items;\n  },\n  renderPopupContent: function renderPopupContent() {\n    this.callBase();\n    this._currentAdaptiveMode = this._isShrinkView();\n    var $popupContent = this._getPopup().$content();\n    this._box = this.dateBox._createComponent($(\"<div>\").appendTo($popupContent), Box, {\n      direction: \"row\",\n      crossAlign: \"start\",\n      items: this._getBoxItems(),\n      itemTemplate: function (data) {\n        var $container = $(\"<div>\");\n        switch (data.name) {\n          case \"calendar\":\n            $container.append(this._widget.$element());\n            if (this._isShrinkView()) {\n              $container.append(this._timeView.$element());\n            }\n            break;\n          case \"time\":\n            $container.append(this._timeView.$element());\n        }\n        return $container;\n      }.bind(this)\n    });\n    this._attachTabHandler();\n  },\n  popupConfig: function popupConfig(_popupConfig) {\n    var calendarPopupConfig = this.callBase(_popupConfig),\n      result = extend(calendarPopupConfig, {\n        onShowing: function () {\n          if (\"fallback\" === this._box.option(\"_layoutStrategy\")) {\n            var clockMinWidth = this._getPopup().$content().find(\".dx-timeview-clock\").css(\"minWidth\");\n            this._timeView.$element().css(\"maxWidth\", clockMinWidth);\n          }\n        }.bind(this)\n      });\n    return result;\n  },\n  getFirstPopupElement: function getFirstPopupElement() {\n    return this._timeView._hourBox.$element().find(\"input\");\n  },\n  _attachTabHandler: function _attachTabHandler() {\n    var dateBox = this.dateBox,\n      handler = function handler(e) {\n        if (e.shiftKey) {\n          e.preventDefault();\n          dateBox.focus();\n        }\n      };\n    this._timeView._hourBox.registerKeyHandler(\"tab\", handler);\n  },\n  _preventFocusOnPopup: function _preventFocusOnPopup(e) {\n    if (!$(e.target).hasClass(\"dx-texteditor-input\")) {\n      this.callBase.apply(this, arguments);\n      if (!this.dateBox._hasFocusClass()) {\n        this.dateBox.focus();\n      }\n    }\n  },\n  getValue: function getValue() {\n    var date = this._widget.option(\"value\"),\n      time = this._timeView.option(\"value\");\n    date = date ? new Date(date) : new Date();\n    date.setHours(time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds());\n    return date;\n  },\n  dispose: function dispose() {\n    clearTimeout(this._removeMinWidthTimer);\n    clearTimeout(this._repaintTimer);\n    this.callBase();\n  }\n});\nmodule.exports = CalendarWithTimeStrategy;","map":null,"metadata":{},"sourceType":"script"}