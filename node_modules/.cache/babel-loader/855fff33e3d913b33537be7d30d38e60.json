{"ast":null,"code":"/**\r\n * DevExtreme (exporter/excel_creator.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _typeof = \"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\nvar Class = require(\"../core/class\"),\n  window = require(\"../core/utils/window\").getWindow(),\n  typeUtils = require(\"../core/utils/type\"),\n  extend = require(\"../core/utils/extend\").extend,\n  errors = require(\"../ui/widget/ui.errors\"),\n  stringUtils = require(\"../core/utils/string\"),\n  JSZip = require(\"jszip\"),\n  fileSaver = require(\"./file_saver\"),\n  excelFormatConverter = require(\"./excel_format_converter\"),\n  ExcelFile = require(\"./excel/excel.file\"),\n  isDefined = typeUtils.isDefined,\n  XML_TAG = '<?xml version=\"1.0\" encoding=\"utf-8\"?>',\n  GROUP_SHEET_PR_XML = '<sheetPr><outlinePr summaryBelow=\"0\"/></sheetPr>',\n  SINGLE_SHEET_PR_XML = \"<sheetPr/>\",\n  BASE_STYLE_XML2 = '<borders count=\"1\"><border><left style=\"thin\"><color rgb=\"FFD3D3D3\"/></left><right style=\"thin\"><color rgb=\"FFD3D3D3\"/></right><top style=\"thin\"><color rgb=\"FFD3D3D3\"/></top><bottom style=\"thin\"><color rgb=\"FFD3D3D3\"/></bottom></border></borders><cellStyleXfs count=\"1\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\"/></cellStyleXfs>',\n  OPEN_XML_FORMAT_URL = \"http://schemas.openxmlformats.org\",\n  RELATIONSHIP_PART_NAME = \"rels\",\n  XL_FOLDER_NAME = \"xl\",\n  WORKBOOK_FILE_NAME = \"workbook.xml\",\n  CONTENTTYPES_FILE_NAME = \"[Content_Types].xml\",\n  SHAREDSTRING_FILE_NAME = \"sharedStrings.xml\",\n  STYLE_FILE_NAME = \"styles.xml\",\n  WORKSHEETS_FOLDER = \"worksheets\",\n  WORKSHEET_FILE_NAME = \"sheet1.xml\",\n  WORKSHEET_HEADER_XML = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><worksheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" mc:Ignorable=\"x14ac\" xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\">',\n  VALID_TYPES = {\n    \"boolean\": \"b\",\n    date: \"d\",\n    number: \"n\",\n    string: \"s\"\n  },\n  EXCEL_START_TIME = Date.UTC(1899, 11, 30),\n  DAYS_COUNT_BEFORE_29_FEB_1900 = 60,\n  MAX_DIGIT_WIDTH_IN_PIXELS = 7;\nvar ExcelCreator = Class.inherit({\n  _getXMLTag: function _getXMLTag(tagName, attributes, content) {\n    var i,\n      attr,\n      result = \"<\" + tagName,\n      length = attributes.length;\n    for (i = 0; i < length; i++) {\n      attr = attributes[i];\n      if (void 0 !== attr.value) {\n        result = result + \" \" + attr.name + '=\"' + attr.value + '\"';\n      }\n    }\n    return typeUtils.isDefined(content) ? result + \">\" + content + \"</\" + tagName + \">\" : result + \" />\";\n  },\n  _convertToExcelCellRef: function _convertToExcelCellRef(zeroBasedRowIndex, zeroBasedCellIndex) {\n    var charCode,\n      isCellIndexFound,\n      columnName = \"\",\n      max = 26;\n    while (!isCellIndexFound) {\n      charCode = 65 + (zeroBasedCellIndex >= max ? zeroBasedCellIndex % max : Math.ceil(zeroBasedCellIndex));\n      columnName = String.fromCharCode(charCode) + columnName;\n      if (zeroBasedCellIndex >= max) {\n        zeroBasedCellIndex = Math.floor(zeroBasedCellIndex / max) - 1;\n      } else {\n        isCellIndexFound = true;\n      }\n    }\n    return columnName + (zeroBasedRowIndex + 1);\n  },\n  _convertToExcelCellRefAndTrackMaxIndex: function _convertToExcelCellRefAndTrackMaxIndex(rowIndex, cellIndex) {\n    if (this._maxRowIndex < Number(rowIndex)) {\n      this._maxRowIndex = Number(rowIndex);\n    }\n    if (this._maxColumnIndex < Number(cellIndex)) {\n      this._maxColumnIndex = Number(cellIndex);\n    }\n    return this._convertToExcelCellRef(rowIndex, cellIndex);\n  },\n  _getDataType: function _getDataType(dataType) {\n    return VALID_TYPES[dataType] || VALID_TYPES.string;\n  },\n  _tryGetExcelCellDataType: function _tryGetExcelCellDataType(object) {\n    if (typeUtils.isDefined(object)) {\n      if (\"number\" === typeof object) {\n        if (isFinite(object)) {\n          return VALID_TYPES.number;\n        } else {\n          return VALID_TYPES.string;\n        }\n      } else {\n        if (typeUtils.isString(object)) {\n          return VALID_TYPES.string;\n        } else {\n          if (typeUtils.isDate(object)) {\n            return VALID_TYPES.number;\n          } else {\n            if (typeUtils.isBoolean(object)) {\n              return VALID_TYPES.boolean;\n            }\n          }\n        }\n      }\n    }\n  },\n  _formatObjectConverter: function _formatObjectConverter(format, dataType) {\n    var result = {\n      format: format,\n      precision: format && format.precision,\n      dataType: dataType\n    };\n    if (typeUtils.isObject(format)) {\n      return extend(result, format, {\n        format: format.formatter || format.type,\n        currency: format.currency\n      });\n    }\n    return result;\n  },\n  _tryConvertToExcelNumberFormat: function _tryConvertToExcelNumberFormat(format, dataType) {\n    var currency,\n      newFormat = this._formatObjectConverter(format, dataType);\n    format = newFormat.format;\n    currency = newFormat.currency;\n    dataType = newFormat.dataType;\n    return excelFormatConverter.convertFormat(format, newFormat.precision, dataType, currency);\n  },\n  _appendString: function _appendString(value) {\n    if (typeUtils.isDefined(value)) {\n      value = String(value);\n      if (value.length) {\n        value = stringUtils.encodeHtml(value);\n        if (void 0 === this._stringHash[value]) {\n          this._stringHash[value] = this._stringArray.length;\n          this._stringArray.push(value);\n        }\n        return this._stringHash[value];\n      }\n    }\n  },\n  _tryGetExcelDateValue: function _tryGetExcelDateValue(date) {\n    var days, totalTime;\n    if (typeUtils.isDate(date)) {\n      days = Math.floor((Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) - EXCEL_START_TIME) / 864e5);\n      if (days < DAYS_COUNT_BEFORE_29_FEB_1900) {\n        days--;\n      }\n      totalTime = (3600 * date.getHours() + 60 * date.getMinutes() + date.getSeconds()) / 86400;\n      return days + totalTime;\n    }\n  },\n  _prepareValue: function _prepareValue(rowIndex, cellIndex) {\n    var sourceValue,\n      dataProvider = this._dataProvider,\n      _ref = dataProvider.getCellData(rowIndex, cellIndex) || {},\n      value = _ref.value,\n      cellSourceData = _ref.cellSourceData,\n      type = this._getDataType(dataProvider.getCellType(rowIndex, cellIndex));\n    if (type === VALID_TYPES.date && !typeUtils.isDate(value)) {\n      type = VALID_TYPES.string;\n    }\n    switch (type) {\n      case VALID_TYPES.string:\n        sourceValue = value;\n        value = this._appendString(value);\n        break;\n      case VALID_TYPES.date:\n        sourceValue = value;\n        value = this._tryGetExcelDateValue(value);\n        type = VALID_TYPES.number;\n    }\n    return {\n      value: value,\n      type: type,\n      sourceValue: sourceValue,\n      cellSourceData: cellSourceData\n    };\n  },\n  _callCustomizeExcelCell: function _callCustomizeExcelCell(_ref2) {\n    var dataProvider = _ref2.dataProvider,\n      value = _ref2.value,\n      style = _ref2.style,\n      sourceData = _ref2.sourceData;\n    var styleCopy = ExcelFile.copyCellFormat(style);\n    var args = {\n      value: value,\n      numberFormat: styleCopy.numberFormat,\n      clearStyle: function clearStyle() {\n        this.horizontalAlignment = null;\n        this.verticalAlignment = null;\n        this.wrapTextEnabled = null;\n        this.font = null;\n        this.numberFormat = null;\n      }\n    };\n    if (isDefined(styleCopy)) {\n      if (isDefined(styleCopy.alignment)) {\n        args.horizontalAlignment = styleCopy.alignment.horizontal;\n        args.verticalAlignment = styleCopy.alignment.vertical;\n        args.wrapTextEnabled = styleCopy.alignment.wrapText;\n      }\n      args.backgroundColor = styleCopy.backgroundColor;\n      args.fillPatternType = styleCopy.fillPatternType;\n      args.fillPatternColor = styleCopy.fillPatternColor;\n      args.font = styleCopy.font;\n    }\n    dataProvider.customizeExcelCell(args, sourceData);\n    var newStyle = styleCopy || {};\n    newStyle.font = args.font;\n    newStyle.alignment = newStyle.alignment || {};\n    newStyle.alignment.horizontal = args.horizontalAlignment;\n    newStyle.alignment.vertical = args.verticalAlignment;\n    newStyle.alignment.wrapText = args.wrapTextEnabled;\n    newStyle.backgroundColor = args.backgroundColor;\n    newStyle.fillPatternType = args.fillPatternType;\n    newStyle.fillPatternColor = args.fillPatternColor;\n    newStyle.numberFormat = args.numberFormat;\n    return {\n      value: args.value,\n      style: newStyle\n    };\n  },\n  _getDataArray: function _getDataArray() {\n    var rowIndex,\n      cellIndex,\n      cellsArray,\n      cellData,\n      cellsLength,\n      that = this,\n      result = [],\n      dataProvider = that._dataProvider,\n      rowsLength = dataProvider.getRowsCount(),\n      columns = dataProvider.getColumns();\n    for (rowIndex = 0; rowIndex < rowsLength; rowIndex++) {\n      cellsArray = [];\n      cellsLength = columns.length;\n      for (cellIndex = 0; cellIndex !== cellsLength; cellIndex++) {\n        cellData = that._prepareValue(rowIndex, cellIndex);\n        var styleArrayIndex = dataProvider.getStyleId(rowIndex, cellIndex);\n        var cellStyleId = this._styleArrayIndexToCellStyleIdMap[styleArrayIndex];\n        if (dataProvider.hasCustomizeExcelCell && dataProvider.hasCustomizeExcelCell()) {\n          var value = cellData.sourceValue || cellData.value;\n          var modifiedExcelCell = this._callCustomizeExcelCell({\n            dataProvider: dataProvider,\n            value: value,\n            style: that._styleArray[styleArrayIndex],\n            sourceData: cellData.cellSourceData\n          });\n          if (modifiedExcelCell.value !== value) {\n            if (_typeof(modifiedExcelCell.value) !== (\"undefined\" === typeof value ? \"undefined\" : _typeof(value)) || \"number\" === typeof modifiedExcelCell.value && !isFinite(modifiedExcelCell.value)) {\n              var cellDataType = this._tryGetExcelCellDataType(modifiedExcelCell.value);\n              if (typeUtils.isDefined(cellDataType)) {\n                cellData.type = cellDataType;\n              }\n            }\n            switch (cellData.type) {\n              case VALID_TYPES.string:\n                cellData.value = this._appendString(modifiedExcelCell.value);\n                break;\n              case VALID_TYPES.date:\n                cellData.value = modifiedExcelCell.value;\n                break;\n              case VALID_TYPES.number:\n                var newValue = modifiedExcelCell.value;\n                var excelDateValue = this._tryGetExcelDateValue(newValue);\n                if (typeUtils.isDefined(excelDateValue)) {\n                  newValue = excelDateValue;\n                }\n                cellData.value = newValue;\n                break;\n              default:\n                cellData.value = modifiedExcelCell.value;\n            }\n          }\n          cellStyleId = this._excelFile.registerCellFormat(modifiedExcelCell.style);\n        }\n        cellsArray.push({\n          style: cellStyleId,\n          value: cellData.value,\n          type: cellData.type\n        });\n      }\n      if (!that._needSheetPr && dataProvider.getGroupLevel(rowIndex) > 0) {\n        that._needSheetPr = true;\n      }\n      result.push(cellsArray);\n    }\n    return result;\n  },\n  _calculateWidth: function _calculateWidth(pixelsWidth) {\n    pixelsWidth = parseInt(pixelsWidth, 10);\n    if (!pixelsWidth || pixelsWidth < 5) {\n      pixelsWidth = 100;\n    }\n    return Math.min(255, Math.floor((pixelsWidth - 5) / MAX_DIGIT_WIDTH_IN_PIXELS * 100 + .5) / 100);\n  },\n  _prepareStyleData: function _prepareStyleData() {\n    var _this = this;\n    var that = this,\n      styles = that._dataProvider.getStyles();\n    that._dataProvider.getColumns().forEach(function (column) {\n      that._colsArray.push(that._calculateWidth(column.width));\n    });\n    var fonts = [{\n      size: 11,\n      color: {\n        theme: 1\n      },\n      name: \"Calibri\",\n      family: 2,\n      scheme: \"minor\",\n      bold: false\n    }, {\n      size: 11,\n      color: {\n        theme: 1\n      },\n      name: \"Calibri\",\n      family: 2,\n      scheme: \"minor\",\n      bold: true\n    }];\n    this._excelFile.registerFont(fonts[0]);\n    this._excelFile.registerFont(fonts[1]);\n    styles.forEach(function (style) {\n      var numberFormat = that._tryConvertToExcelNumberFormat(style.format, style.dataType);\n      if (!typeUtils.isDefined(numberFormat)) {\n        numberFormat = 0;\n      }\n      that._styleArray.push({\n        font: fonts[Number(!!style.bold)],\n        numberFormat: numberFormat,\n        alignment: {\n          vertical: \"top\",\n          wrapText: !!style.wrapText,\n          horizontal: style.alignment || \"left\"\n        }\n      });\n    });\n    that._styleArrayIndexToCellStyleIdMap = that._styleArray.map(function (item) {\n      return _this._excelFile.registerCellFormat(item);\n    });\n  },\n  _prepareCellData: function _prepareCellData() {\n    this._cellsArray = this._getDataArray();\n  },\n  _createXMLRelationships: function _createXMLRelationships(xmlRelationships) {\n    return this._getXMLTag(\"Relationships\", [{\n      name: \"xmlns\",\n      value: OPEN_XML_FORMAT_URL + \"/package/2006/relationships\"\n    }], xmlRelationships);\n  },\n  _createXMLRelationship: function _createXMLRelationship(id, type, target) {\n    return this._getXMLTag(\"Relationship\", [{\n      name: \"Id\",\n      value: \"rId\" + id\n    }, {\n      name: \"Type\",\n      value: OPEN_XML_FORMAT_URL + \"/officeDocument/2006/relationships/\" + type\n    }, {\n      name: \"Target\",\n      value: target\n    }]);\n  },\n  _getWorkbookContent: function _getWorkbookContent() {\n    var content = '<bookViews><workbookView xWindow=\"0\" yWindow=\"0\" windowWidth=\"0\" windowHeight=\"0\"/></bookViews><sheets><sheet name=\"Sheet\" sheetId=\"1\" r:id=\"rId1\" /></sheets><definedNames><definedName name=\"_xlnm.Print_Titles\" localSheetId=\"0\">Sheet!$1:$1</definedName><definedName name=\"_xlnm._FilterDatabase\" hidden=\"0\" localSheetId=\"0\">Sheet!$A$1:$F$6332</definedName></definedNames>';\n    return XML_TAG + this._getXMLTag(\"workbook\", [{\n      name: \"xmlns:r\",\n      value: OPEN_XML_FORMAT_URL + \"/officeDocument/2006/relationships\"\n    }, {\n      name: \"xmlns\",\n      value: OPEN_XML_FORMAT_URL + \"/spreadsheetml/2006/main\"\n    }], content);\n  },\n  _getContentTypesContent: function _getContentTypesContent() {\n    return XML_TAG + '<Types xmlns=\"' + OPEN_XML_FORMAT_URL + '/package/2006/content-types\"><Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\" /><Default Extension=\"xml\" ContentType=\"application/xml\" /><Override PartName=\"/xl/worksheets/sheet1.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\" /><Override PartName=\"/xl/styles.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\" /><Override PartName=\"/xl/sharedStrings.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml\" /><Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\" /></Types>';\n  },\n  _generateStylesXML: function _generateStylesXML() {\n    var that = this,\n      folder = that._zip.folder(XL_FOLDER_NAME),\n      XML = \"\";\n    XML += this._excelFile.generateNumberFormatsXml();\n    XML += this._excelFile.generateFontsXml();\n    XML += this._excelFile.generateFillsXml();\n    XML += BASE_STYLE_XML2;\n    XML += this._excelFile.generateCellFormatsXml();\n    XML += that._getXMLTag(\"cellStyles\", [{\n      name: \"count\",\n      value: 1\n    }], that._getXMLTag(\"cellStyle\", [{\n      name: \"name\",\n      value: \"Normal\"\n    }, {\n      name: \"xfId\",\n      value: 0\n    }, {\n      name: \"builtinId\",\n      value: 0\n    }]));\n    XML = XML_TAG + that._getXMLTag(\"styleSheet\", [{\n      name: \"xmlns\",\n      value: OPEN_XML_FORMAT_URL + \"/spreadsheetml/2006/main\"\n    }], XML);\n    folder.file(STYLE_FILE_NAME, XML);\n    that._styleArray = [];\n  },\n  _generateStringsXML: function _generateStringsXML() {\n    var stringIndex,\n      folder = this._zip.folder(XL_FOLDER_NAME),\n      stringsLength = this._stringArray.length,\n      sharedStringXml = XML_TAG;\n    for (stringIndex = 0; stringIndex < stringsLength; stringIndex++) {\n      this._stringArray[stringIndex] = this._getXMLTag(\"si\", [], this._getXMLTag(\"t\", [], this._stringArray[stringIndex]));\n    }\n    sharedStringXml += this._getXMLTag(\"sst\", [{\n      name: \"xmlns\",\n      value: OPEN_XML_FORMAT_URL + \"/spreadsheetml/2006/main\"\n    }, {\n      name: \"count\",\n      value: this._stringArray.length\n    }, {\n      name: \"uniqueCount\",\n      value: this._stringArray.length\n    }], this._stringArray.join(\"\"));\n    folder.file(SHAREDSTRING_FILE_NAME, sharedStringXml);\n    this._stringArray = [];\n  },\n  _getPaneXML: function _getPaneXML() {\n    var attributes = [{\n        name: \"activePane\",\n        value: \"bottomLeft\"\n      }, {\n        name: \"state\",\n        value: \"frozen\"\n      }],\n      frozenArea = this._dataProvider.getFrozenArea();\n    if (!(frozenArea.x || frozenArea.y)) {\n      return \"\";\n    }\n    if (frozenArea.x) {\n      attributes.push({\n        name: \"xSplit\",\n        value: frozenArea.x\n      });\n    }\n    if (frozenArea.y) {\n      attributes.push({\n        name: \"ySplit\",\n        value: frozenArea.y\n      });\n    }\n    attributes.push({\n      name: \"topLeftCell\",\n      value: this._convertToExcelCellRefAndTrackMaxIndex(frozenArea.y, frozenArea.x)\n    });\n    return this._getXMLTag(\"pane\", attributes);\n  },\n  _getAutoFilterXML: function _getAutoFilterXML(maxCellIndex) {\n    if (this._options.autoFilterEnabled) {\n      return '<autoFilter ref=\"A' + this._dataProvider.getHeaderRowCount() + \":\" + maxCellIndex + '\" />';\n    }\n    return \"\";\n  },\n  _getIgnoredErrorsXML: function _getIgnoredErrorsXML(maxCellIndex) {\n    if (this._options.ignoreErrors) {\n      return '<ignoredErrors><ignoredError sqref=\"A1:' + maxCellIndex + '\" numberStoredAsText=\"1\" /></ignoredErrors>';\n    }\n    return \"\";\n  },\n  _generateWorksheetXML: function _generateWorksheetXML() {\n    var colIndex,\n      rowIndex,\n      cellData,\n      xmlCells,\n      rightBottomCellRef,\n      cellsLength,\n      xmlRows = [],\n      rowsLength = this._cellsArray.length,\n      colsLength = this._colsArray.length,\n      rSpans = \"1:\" + colsLength,\n      headerRowCount = this._dataProvider.getHeaderRowCount ? this._dataProvider.getHeaderRowCount() : 1,\n      xmlResult = [WORKSHEET_HEADER_XML];\n    xmlResult.push(this._needSheetPr ? GROUP_SHEET_PR_XML : SINGLE_SHEET_PR_XML);\n    xmlResult.push('<dimension ref=\"A1:C1\"/>');\n    xmlResult.push(\"<sheetViews><sheetView \");\n    xmlResult.push(this._rtlEnabled ? 'rightToLeft=\"1\" ' : \"\");\n    xmlResult.push('tabSelected=\"1\" workbookViewId=\"0\">');\n    xmlResult.push(this._getPaneXML());\n    xmlResult.push(\"</sheetView></sheetViews>\");\n    xmlResult.push('<sheetFormatPr defaultRowHeight=\"15\"');\n    xmlResult.push(' outlineLevelRow=\"' + (this._dataProvider.getRowsCount() > 0 ? this._dataProvider.getGroupLevel(0) : 0) + '\"');\n    xmlResult.push(' x14ac:dyDescent=\"0.25\"/>');\n    for (colIndex = 0; colIndex < colsLength; colIndex++) {\n      this._colsArray[colIndex] = this._getXMLTag(\"col\", [{\n        name: \"width\",\n        value: this._colsArray[colIndex]\n      }, {\n        name: \"min\",\n        value: Number(colIndex) + 1\n      }, {\n        name: \"max\",\n        value: Number(colIndex) + 1\n      }]);\n    }\n    xmlResult.push(this._getXMLTag(\"cols\", [], this._colsArray.join(\"\")) + \"<sheetData>\");\n    for (rowIndex = 0; rowIndex < rowsLength; rowIndex++) {\n      xmlCells = [];\n      cellsLength = this._cellsArray[rowIndex].length;\n      for (colIndex = 0; colIndex < cellsLength; colIndex++) {\n        rowIndex = Number(rowIndex);\n        cellData = this._cellsArray[rowIndex][colIndex];\n        xmlCells.push(this._getXMLTag(\"c\", [{\n          name: \"r\",\n          value: this._convertToExcelCellRefAndTrackMaxIndex(rowIndex, colIndex)\n        }, {\n          name: \"s\",\n          value: cellData.style\n        }, {\n          name: \"t\",\n          value: cellData.type\n        }], typeUtils.isDefined(cellData.value) ? this._getXMLTag(\"v\", [], cellData.value) : null));\n      }\n      xmlRows.push(this._getXMLTag(\"row\", [{\n        name: \"r\",\n        value: Number(rowIndex) + 1\n      }, {\n        name: \"spans\",\n        value: rSpans\n      }, {\n        name: \"outlineLevel\",\n        value: rowIndex >= headerRowCount ? this._dataProvider.getGroupLevel(rowIndex) : 0\n      }, {\n        name: \"x14ac:dyDescent\",\n        value: \"0.25\"\n      }], xmlCells.join(\"\")));\n      this._cellsArray[rowIndex] = null;\n      if (xmlRows.length > 1e4) {\n        xmlResult.push(xmlRows.join(\"\"));\n        xmlRows = [];\n      }\n    }\n    xmlResult.push(xmlRows.join(\"\"));\n    xmlRows = [];\n    rightBottomCellRef = this._convertToExcelCellRef(this._maxRowIndex, this._maxColumnIndex);\n    xmlResult.push(\"</sheetData>\" + this._getAutoFilterXML(rightBottomCellRef) + this._generateMergingXML() + this._getIgnoredErrorsXML(rightBottomCellRef) + \"</worksheet>\");\n    this._zip.folder(XL_FOLDER_NAME).folder(WORKSHEETS_FOLDER).file(WORKSHEET_FILE_NAME, xmlResult.join(\"\"));\n    this._colsArray = [];\n    this._cellsArray = [];\n    xmlResult = [];\n  },\n  _generateMergingXML: function _generateMergingXML() {\n    var k,\n      l,\n      cellIndex,\n      rowIndex,\n      mergeArrayLength,\n      mergeIndex,\n      rowsLength = typeUtils.isDefined(this._dataProvider.getHeaderRowCount) ? this._dataProvider.getHeaderRowCount() : this._dataProvider.getRowsCount(),\n      columnsLength = this._dataProvider.getColumns().length,\n      usedArea = [],\n      mergeArray = [],\n      mergeXML = \"\";\n    for (rowIndex = 0; rowIndex < rowsLength; rowIndex++) {\n      for (cellIndex = 0; cellIndex !== columnsLength; cellIndex++) {\n        if (!typeUtils.isDefined(usedArea[rowIndex]) || !typeUtils.isDefined(usedArea[rowIndex][cellIndex])) {\n          var cellMerge = this._dataProvider.getCellMerging(rowIndex, cellIndex);\n          if (cellMerge.colspan || cellMerge.rowspan) {\n            mergeArray.push({\n              start: this._convertToExcelCellRefAndTrackMaxIndex(rowIndex, cellIndex),\n              end: this._convertToExcelCellRefAndTrackMaxIndex(rowIndex + (cellMerge.rowspan || 0), cellIndex + (cellMerge.colspan || 0))\n            });\n            for (k = rowIndex; k <= rowIndex + cellMerge.rowspan || 0; k++) {\n              for (l = cellIndex; l <= cellIndex + cellMerge.colspan || 0; l++) {\n                if (!typeUtils.isDefined(usedArea[k])) {\n                  usedArea[k] = [];\n                }\n                usedArea[k][l] = true;\n              }\n            }\n          }\n        }\n      }\n    }\n    mergeArrayLength = mergeArray.length;\n    for (mergeIndex = 0; mergeIndex < mergeArrayLength; mergeIndex++) {\n      mergeXML += this._getXMLTag(\"mergeCell\", [{\n        name: \"ref\",\n        value: mergeArray[mergeIndex].start + \":\" + mergeArray[mergeIndex].end\n      }]);\n    }\n    return mergeXML.length ? this._getXMLTag(\"mergeCells\", [{\n      name: \"count\",\n      value: mergeArrayLength\n    }], mergeXML) : \"\";\n  },\n  _generateCommonXML: function _generateCommonXML() {\n    var xmlRelationships,\n      relsFileContent = XML_TAG + this._createXMLRelationships(this._createXMLRelationship(1, \"officeDocument\", \"xl/\" + WORKBOOK_FILE_NAME)),\n      folder = this._zip.folder(XL_FOLDER_NAME),\n      relsXML = XML_TAG;\n    this._zip.folder(\"_\" + RELATIONSHIP_PART_NAME).file(\".\" + RELATIONSHIP_PART_NAME, relsFileContent);\n    xmlRelationships = this._createXMLRelationship(1, \"worksheet\", \"worksheets/\" + WORKSHEET_FILE_NAME) + this._createXMLRelationship(2, \"styles\", STYLE_FILE_NAME) + this._createXMLRelationship(3, \"sharedStrings\", SHAREDSTRING_FILE_NAME);\n    relsXML += this._createXMLRelationships(xmlRelationships);\n    folder.folder(\"_\" + RELATIONSHIP_PART_NAME).file(WORKBOOK_FILE_NAME + \".rels\", relsXML);\n    folder.file(WORKBOOK_FILE_NAME, this._getWorkbookContent());\n    this._zip.file(CONTENTTYPES_FILE_NAME, this._getContentTypesContent());\n  },\n  _generateContent: function _generateContent() {\n    this._prepareStyleData();\n    this._prepareCellData();\n    this._generateWorkXML();\n    this._generateCommonXML();\n  },\n  _generateWorkXML: function _generateWorkXML() {\n    this._generateStylesXML();\n    this._generateStringsXML();\n    this._generateWorksheetXML();\n  },\n  ctor: function ctor(dataProvider, options) {\n    this._rtlEnabled = options && !!options.rtlEnabled;\n    this._options = options;\n    this._maxRowIndex = 0;\n    this._maxColumnIndex = 0;\n    this._stringArray = [];\n    this._stringHash = {};\n    this._styleArray = [];\n    this._colsArray = [];\n    this._cellsArray = [];\n    this._needSheetPr = false;\n    this._dataProvider = dataProvider;\n    this._excelFile = new ExcelFile();\n    if (typeUtils.isDefined(ExcelCreator.JSZip)) {\n      this._zip = new ExcelCreator.JSZip();\n    } else {\n      this._zip = null;\n    }\n  },\n  _checkZipState: function _checkZipState() {\n    if (!this._zip) {\n      throw errors.Error(\"E1041\", \"JSZip\");\n    }\n  },\n  ready: function ready() {\n    return this._dataProvider.ready();\n  },\n  getData: function getData(isBlob) {\n    var options = {\n      type: isBlob ? \"blob\" : \"base64\",\n      compression: \"DEFLATE\",\n      mimeType: fileSaver.MIME_TYPES.EXCEL\n    };\n    this._checkZipState();\n    this._generateContent();\n    return this._zip.generateAsync ? this._zip.generateAsync(options) : this._zip.generate(options);\n  }\n});\nExcelCreator.JSZip = JSZip;\nexports.ExcelCreator = ExcelCreator;\nexports.getData = function (data, options) {\n  var excelCreator = new exports.ExcelCreator(data, options);\n  excelCreator._checkZipState();\n  return excelCreator.ready().then(function () {\n    return excelCreator.getData(typeUtils.isFunction(window.Blob));\n  });\n};","map":null,"metadata":{},"sourceType":"script"}