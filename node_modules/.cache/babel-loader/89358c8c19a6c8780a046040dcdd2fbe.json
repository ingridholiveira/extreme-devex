{"ast":null,"code":"/**\r\n * DevExtreme (ui/shared/filtering.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar typeUtils = require(\"../../core/utils/type\"),\n  inArray = require(\"../../core/utils/array\").inArray,\n  iteratorUtils = require(\"../../core/utils/iterator\");\nvar DEFAULT_DATE_INTERVAL = [\"year\", \"month\", \"day\"],\n  DEFAULT_DATETIME_INTERVAL = [\"year\", \"month\", \"day\", \"hour\", \"minute\"];\nmodule.exports = function () {\n  var getFilterSelector = function getFilterSelector(column, target) {\n    var selector = column.dataField || column.selector;\n    if (\"search\" === target) {\n      selector = column.displayField || column.calculateDisplayValue || selector;\n    }\n    return selector;\n  };\n  var isZeroTime = function isZeroTime(date) {\n    return date.getHours() + date.getMinutes() + date.getSeconds() + date.getMilliseconds() < 1;\n  };\n  var isDateType = function isDateType(dataType) {\n    return \"date\" === dataType || \"datetime\" === dataType;\n  };\n  var getDateValues = function getDateValues(dateValue) {\n    if (typeUtils.isDate(dateValue)) {\n      return [dateValue.getFullYear(), dateValue.getMonth(), dateValue.getDate(), dateValue.getHours(), dateValue.getMinutes(), dateValue.getSeconds()];\n    }\n    return iteratorUtils.map((\"\" + dateValue).split(\"/\"), function (value, index) {\n      return 1 === index ? Number(value) - 1 : Number(value);\n    });\n  };\n  var getFilterExpressionByRange = function getFilterExpressionByRange(filterValue, target) {\n    var endFilterValue,\n      startFilterExpression,\n      endFilterExpression,\n      column = this,\n      selector = getFilterSelector(column, target);\n    if (Array.isArray(filterValue) && typeUtils.isDefined(filterValue[0]) && typeUtils.isDefined(filterValue[1])) {\n      startFilterExpression = [selector, \">=\", filterValue[0]];\n      endFilterExpression = [selector, \"<=\", filterValue[1]];\n      if (isDateType(column.dataType) && isZeroTime(filterValue[1])) {\n        endFilterValue = new Date(filterValue[1].getTime());\n        if (\"date\" === column.dataType) {\n          endFilterValue.setDate(filterValue[1].getDate() + 1);\n        }\n        endFilterExpression = [selector, \"<\", endFilterValue];\n      }\n      return [startFilterExpression, \"and\", endFilterExpression];\n    }\n  };\n  var getFilterExpressionForDate = function getFilterExpressionForDate(filterValue, selectedFilterOperation, target) {\n    var dateStart,\n      dateEnd,\n      dateInterval,\n      column = this,\n      values = getDateValues(filterValue),\n      selector = getFilterSelector(column, target);\n    if (\"headerFilter\" === target) {\n      dateInterval = module.exports.getGroupInterval(column)[values.length - 1];\n    } else {\n      if (\"datetime\" === column.dataType) {\n        dateInterval = \"minute\";\n      }\n    }\n    switch (dateInterval) {\n      case \"year\":\n        dateStart = new Date(values[0], 0, 1);\n        dateEnd = new Date(values[0] + 1, 0, 1);\n        break;\n      case \"month\":\n        dateStart = new Date(values[0], values[1], 1);\n        dateEnd = new Date(values[0], values[1] + 1, 1);\n        break;\n      case \"quarter\":\n        dateStart = new Date(values[0], 3 * values[1], 1);\n        dateEnd = new Date(values[0], 3 * values[1] + 3, 1);\n        break;\n      case \"hour\":\n        dateStart = new Date(values[0], values[1], values[2], values[3]);\n        dateEnd = new Date(values[0], values[1], values[2], values[3] + 1);\n        break;\n      case \"minute\":\n        dateStart = new Date(values[0], values[1], values[2], values[3], values[4]);\n        dateEnd = new Date(values[0], values[1], values[2], values[3], values[4] + 1);\n        break;\n      case \"second\":\n        dateStart = new Date(values[0], values[1], values[2], values[3], values[4], values[5]);\n        dateEnd = new Date(values[0], values[1], values[2], values[3], values[4], values[5] + 1);\n        break;\n      default:\n        dateStart = new Date(values[0], values[1], values[2]);\n        dateEnd = new Date(values[0], values[1], values[2] + 1);\n    }\n    switch (selectedFilterOperation) {\n      case \"<\":\n        return [selector, \"<\", dateStart];\n      case \"<=\":\n        return [selector, \"<\", dateEnd];\n      case \">\":\n        return [selector, \">=\", dateEnd];\n      case \">=\":\n        return [selector, \">=\", dateStart];\n      case \"<>\":\n        return [[selector, \"<\", dateStart], \"or\", [selector, \">=\", dateEnd]];\n      default:\n        return [[selector, \">=\", dateStart], \"and\", [selector, \"<\", dateEnd]];\n    }\n  };\n  var getFilterExpressionForNumber = function getFilterExpressionForNumber(filterValue, selectedFilterOperation, target) {\n    var column = this,\n      selector = getFilterSelector(column, target),\n      groupInterval = module.exports.getGroupInterval(column);\n    if (\"headerFilter\" === target && groupInterval && typeUtils.isDefined(filterValue)) {\n      var interval,\n        startFilterValue,\n        endFilterValue,\n        values = (\"\" + filterValue).split(\"/\"),\n        value = Number(values[values.length - 1]);\n      interval = groupInterval[values.length - 1];\n      startFilterValue = [selector, \">=\", value];\n      endFilterValue = [selector, \"<\", value + interval];\n      var condition = [startFilterValue, \"and\", endFilterValue];\n      return condition;\n    }\n    return [selector, selectedFilterOperation || \"=\", filterValue];\n  };\n  return {\n    defaultCalculateFilterExpression: function defaultCalculateFilterExpression(filterValue, selectedFilterOperation, target) {\n      var column = this,\n        selector = getFilterSelector(column, target),\n        isSearchByDisplayValue = column.calculateDisplayValue && \"search\" === target,\n        dataType = isSearchByDisplayValue && column.lookup && column.lookup.dataType || column.dataType,\n        filter = null;\n      if ((\"headerFilter\" === target || \"filterBuilder\" === target) && null === filterValue) {\n        filter = [selector, selectedFilterOperation || \"=\", null];\n        if (\"string\" === dataType) {\n          filter = [filter, \"=\" === selectedFilterOperation ? \"or\" : \"and\", [selector, selectedFilterOperation || \"=\", \"\"]];\n        }\n      } else {\n        if (\"string\" === dataType && (!column.lookup || isSearchByDisplayValue)) {\n          filter = [selector, selectedFilterOperation || \"contains\", filterValue];\n        } else {\n          if (\"between\" === selectedFilterOperation) {\n            return getFilterExpressionByRange.apply(column, [filterValue, target]);\n          } else {\n            if (isDateType(dataType) && typeUtils.isDefined(filterValue)) {\n              return getFilterExpressionForDate.apply(column, arguments);\n            } else {\n              if (\"number\" === dataType) {\n                return getFilterExpressionForNumber.apply(column, arguments);\n              } else {\n                if (\"object\" !== dataType) {\n                  filter = [selector, selectedFilterOperation || \"=\", filterValue];\n                }\n              }\n            }\n          }\n        }\n      }\n      return filter;\n    },\n    getGroupInterval: function getGroupInterval(column) {\n      var index,\n        result = [],\n        dateIntervals = [\"year\", \"month\", \"day\", \"hour\", \"minute\", \"second\"],\n        groupInterval = column.headerFilter && column.headerFilter.groupInterval,\n        interval = \"quarter\" === groupInterval ? \"month\" : groupInterval;\n      if (isDateType(column.dataType) && null !== groupInterval) {\n        result = \"datetime\" === column.dataType ? DEFAULT_DATETIME_INTERVAL : DEFAULT_DATE_INTERVAL;\n        index = inArray(interval, dateIntervals);\n        if (index >= 0) {\n          result = dateIntervals.slice(0, index);\n          result.push(groupInterval);\n          return result;\n        }\n        return result;\n      } else {\n        if (typeUtils.isDefined(groupInterval)) {\n          return Array.isArray(groupInterval) ? groupInterval : [groupInterval];\n        }\n      }\n    }\n  };\n}();","map":null,"metadata":{},"sourceType":"script"}