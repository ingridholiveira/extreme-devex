{"ast":null,"code":"/**\r\n * DevExtreme (ui/collection/ui.collection_widget.edit.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _events_engine = require(\"../../events/core/events_engine\");\nvar _events_engine2 = _interopRequireDefault(_events_engine);\nvar _uiCollection_widget = require(\"./ui.collection_widget.base\");\nvar _uiCollection_widget2 = _interopRequireDefault(_uiCollection_widget);\nvar _ui = require(\"../widget/ui.errors\");\nvar _ui2 = _interopRequireDefault(_ui);\nvar _extend = require(\"../../core/utils/extend\");\nvar _iterator = require(\"../../core/utils/iterator\");\nvar _common = require(\"../../core/utils/common\");\nvar _type = require(\"../../core/utils/type\");\nvar _uiCollection_widgetEditStrategy = require(\"./ui.collection_widget.edit.strategy.plain\");\nvar _uiCollection_widgetEditStrategy2 = _interopRequireDefault(_uiCollection_widgetEditStrategy);\nvar _data = require(\"../../core/utils/data\");\nvar _data_source = require(\"../../data/data_source/data_source\");\nvar _selection = require(\"../selection/selection\");\nvar _selection2 = _interopRequireDefault(_selection);\nvar _deferred = require(\"../../core/utils/deferred\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar ITEM_DELETING_DATA_KEY = \"dxItemDeleting\",\n  NOT_EXISTING_INDEX = -1;\nvar indexExists = function indexExists(index) {\n  return index !== NOT_EXISTING_INDEX;\n};\nvar CollectionWidget = _uiCollection_widget2.default.inherit({\n  _setOptionsByReference: function _setOptionsByReference() {\n    this.callBase();\n    (0, _extend.extend)(this._optionsByReference, {\n      selectedItem: true\n    });\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return (0, _extend.extend)(this.callBase(), {\n      selectionMode: \"none\",\n      selectionRequired: false,\n      selectionByClick: true,\n      selectedItems: [],\n      selectedItemKeys: [],\n      maxFilterLengthInRequest: 1500,\n      keyExpr: null,\n      selectedIndex: NOT_EXISTING_INDEX,\n      selectedItem: null,\n      onSelectionChanged: null,\n      onItemReordered: null,\n      onItemDeleting: null,\n      onItemDeleted: null\n    });\n  },\n  ctor: function ctor(element, options) {\n    this._userOptions = options || {};\n    this.callBase(element, options);\n  },\n  _init: function _init() {\n    this._initEditStrategy();\n    this.callBase();\n    this._initKeyGetter();\n    this._initSelectionModule();\n    if (\"multi\" === this.option(\"selectionMode\")) {\n      this._showDeprecatedSelectionMode();\n    }\n  },\n  _initKeyGetter: function _initKeyGetter() {\n    this._keyGetter = (0, _data.compileGetter)(this.option(\"keyExpr\"));\n  },\n  _getKeysByItems: function _getKeysByItems(selectedItems) {\n    return this._editStrategy.getKeysByItems(selectedItems);\n  },\n  _getItemsByKeys: function _getItemsByKeys(selectedItemKeys, selectedItems) {\n    return this._editStrategy.getItemsByKeys(selectedItemKeys, selectedItems);\n  },\n  _getKeyByIndex: function _getKeyByIndex(index) {\n    return this._editStrategy.getKeyByIndex(index);\n  },\n  _getIndexByKey: function _getIndexByKey(key) {\n    return this._editStrategy.getIndexByKey(key);\n  },\n  _getIndexByItemData: function _getIndexByItemData(itemData) {\n    return this._editStrategy.getIndexByItemData(itemData);\n  },\n  _isKeySpecified: function _isKeySpecified() {\n    return !!(this._dataSource && this._dataSource.key());\n  },\n  _getCombinedFilter: function _getCombinedFilter() {\n    return this._dataSource && this._dataSource.filter();\n  },\n  key: function key() {\n    if (this.option(\"keyExpr\")) {\n      return this.option(\"keyExpr\");\n    }\n    return this._dataSource && this._dataSource.key();\n  },\n  keyOf: function keyOf(item) {\n    var key = item,\n      store = this._dataSource && this._dataSource.store();\n    if (this.option(\"keyExpr\")) {\n      key = this._keyGetter(item);\n    } else {\n      if (store) {\n        key = store.keyOf(item);\n      }\n    }\n    return key;\n  },\n  _initSelectionModule: function _initSelectionModule() {\n    var that = this,\n      itemsGetter = that._editStrategy.itemsGetter;\n    this._selection = new _selection2.default({\n      mode: this.option(\"selectionMode\"),\n      maxFilterLengthInRequest: this.option(\"maxFilterLengthInRequest\"),\n      equalByReference: !this._isKeySpecified(),\n      onSelectionChanged: function onSelectionChanged(args) {\n        if (args.addedItemKeys.length || args.removedItemKeys.length) {\n          that.option(\"selectedItems\", that._getItemsByKeys(args.selectedItemKeys, args.selectedItems));\n          that._updateSelectedItems(args);\n        }\n      },\n      filter: that._getCombinedFilter.bind(that),\n      totalCount: function totalCount() {\n        var items = that.option(\"items\");\n        var dataSource = that._dataSource;\n        return dataSource && dataSource.totalCount() >= 0 ? dataSource.totalCount() : items.length;\n      },\n      key: that.key.bind(that),\n      keyOf: that.keyOf.bind(that),\n      load: function load(options) {\n        if (that._dataSource) {\n          var loadOptions = that._dataSource.loadOptions();\n          options.customQueryParams = loadOptions.customQueryParams;\n          options.userData = that._dataSource._userData;\n        }\n        var store = that._dataSource && that._dataSource.store();\n        if (store) {\n          return store.load(options).done(function (loadResult) {\n            if (that._disposed) {\n              return;\n            }\n            var items = (0, _data_source.normalizeLoadResult)(loadResult).data;\n            that._dataSource._applyMapFunction(items);\n          });\n        } else {\n          return new _deferred.Deferred().resolve(this.plainItems());\n        }\n      },\n      dataFields: function dataFields() {\n        return that._dataSource && that._dataSource.select();\n      },\n      plainItems: itemsGetter.bind(that._editStrategy)\n    });\n  },\n  _initEditStrategy: function _initEditStrategy() {\n    var Strategy = _uiCollection_widgetEditStrategy2.default;\n    this._editStrategy = new Strategy(this);\n  },\n  _getSelectedItemIndices: function _getSelectedItemIndices(keys) {\n    var that = this,\n      indices = [];\n    keys = keys || this._selection.getSelectedItemKeys();\n    that._editStrategy.beginCache();\n    (0, _iterator.each)(keys, function (_, key) {\n      var selectedIndex = that._getIndexByKey(key);\n      if (indexExists(selectedIndex)) {\n        indices.push(selectedIndex);\n      }\n    });\n    that._editStrategy.endCache();\n    return indices;\n  },\n  _initMarkup: function _initMarkup() {\n    var _this = this;\n    this._rendering = true;\n    if (!this._dataSource || !this._dataSource.isLoading()) {\n      this._syncSelectionOptions().done(function () {\n        return _this._normalizeSelectedItems();\n      });\n    }\n    this.callBase();\n  },\n  _render: function _render() {\n    this.callBase();\n    this._rendering = false;\n  },\n  _fireContentReadyAction: function _fireContentReadyAction() {\n    this._rendering = false;\n    this._rendered = true;\n    this.callBase.apply(this, arguments);\n  },\n  _syncSelectionOptions: function _syncSelectionOptions(byOption) {\n    byOption = byOption || this._chooseSelectOption();\n    var selectedItem, selectedIndex;\n    switch (byOption) {\n      case \"selectedIndex\":\n        selectedItem = this._editStrategy.getItemDataByIndex(this.option(\"selectedIndex\"));\n        if ((0, _type.isDefined)(selectedItem)) {\n          this._setOptionSilent(\"selectedItems\", [selectedItem]);\n          this._setOptionSilent(\"selectedItem\", selectedItem);\n          this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]));\n        } else {\n          this._setOptionSilent(\"selectedItems\", []);\n          this._setOptionSilent(\"selectedItemKeys\", []);\n          this._setOptionSilent(\"selectedItem\", null);\n        }\n        break;\n      case \"selectedItems\":\n        var selectedItems = this.option(\"selectedItems\") || [];\n        selectedIndex = this._editStrategy.getIndexByItemData(selectedItems[0]);\n        if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\n          return this._syncSelectionOptions(\"selectedIndex\");\n        }\n        this._setOptionSilent(\"selectedItem\", selectedItems[0]);\n        this._setOptionSilent(\"selectedIndex\", selectedIndex);\n        this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems(selectedItems));\n        break;\n      case \"selectedItem\":\n        selectedItem = this.option(\"selectedItem\");\n        selectedIndex = this._editStrategy.getIndexByItemData(selectedItem);\n        if (this.option(\"selectionRequired\") && !indexExists(selectedIndex)) {\n          return this._syncSelectionOptions(\"selectedIndex\");\n        }\n        if ((0, _type.isDefined)(selectedItem)) {\n          this._setOptionSilent(\"selectedItems\", [selectedItem]);\n          this._setOptionSilent(\"selectedIndex\", selectedIndex);\n          this._setOptionSilent(\"selectedItemKeys\", this._editStrategy.getKeysByItems([selectedItem]));\n        } else {\n          this._setOptionSilent(\"selectedItems\", []);\n          this._setOptionSilent(\"selectedItemKeys\", []);\n          this._setOptionSilent(\"selectedIndex\", NOT_EXISTING_INDEX);\n        }\n        break;\n      case \"selectedItemKeys\":\n        var selectedItemKeys = this.option(\"selectedItemKeys\");\n        if (this.option(\"selectionRequired\")) {\n          var selectedItemIndex = this._getIndexByKey(selectedItemKeys[0]);\n          if (!indexExists(selectedItemIndex)) {\n            return this._syncSelectionOptions(\"selectedIndex\");\n          }\n        }\n        return this._selection.setSelection(selectedItemKeys);\n    }\n    return new _deferred.Deferred().resolve().promise();\n  },\n  _chooseSelectOption: function _chooseSelectOption() {\n    var optionName = \"selectedIndex\";\n    var isOptionDefined = function (optionName) {\n      var optionValue = this.option(optionName),\n        length = (0, _type.isDefined)(optionValue) && optionValue.length;\n      return length || optionName in this._userOptions;\n    }.bind(this);\n    if (isOptionDefined(\"selectedItems\")) {\n      optionName = \"selectedItems\";\n    } else {\n      if (isOptionDefined(\"selectedItem\")) {\n        optionName = \"selectedItem\";\n      } else {\n        if (isOptionDefined(\"selectedItemKeys\")) {\n          optionName = \"selectedItemKeys\";\n        }\n      }\n    }\n    return optionName;\n  },\n  _compareKeys: function _compareKeys(oldKeys, newKeys) {\n    if (oldKeys.length !== newKeys.length) {\n      return false;\n    }\n    for (var i = 0; i < newKeys.length; i++) {\n      if (oldKeys[i] !== newKeys[i]) {\n        return false;\n      }\n    }\n    return true;\n  },\n  _normalizeSelectedItems: function _normalizeSelectedItems() {\n    if (\"none\" === this.option(\"selectionMode\")) {\n      this._setOptionSilent(\"selectedItems\", []);\n      this._syncSelectionOptions(\"selectedItems\");\n    } else {\n      if (\"single\" === this.option(\"selectionMode\")) {\n        var newSelection = this.option(\"selectedItems\");\n        if (newSelection.length > 1 || !newSelection.length && this.option(\"selectionRequired\") && this.option(\"items\") && this.option(\"items\").length) {\n          var currentSelection = this._selection.getSelectedItems();\n          var normalizedSelection = void 0 === newSelection[0] ? currentSelection[0] : newSelection[0];\n          if (void 0 === normalizedSelection) {\n            normalizedSelection = this._editStrategy.itemsGetter()[0];\n          }\n          if (this.option(\"grouped\") && normalizedSelection && normalizedSelection.items) {\n            normalizedSelection.items = [normalizedSelection.items[0]];\n          }\n          this._selection.setSelection(this._getKeysByItems([normalizedSelection]));\n          this._setOptionSilent(\"selectedItems\", [normalizedSelection]);\n          return this._syncSelectionOptions(\"selectedItems\");\n        } else {\n          this._selection.setSelection(this._getKeysByItems(newSelection));\n        }\n      } else {\n        var newKeys = this._getKeysByItems(this.option(\"selectedItems\"));\n        var oldKeys = this._selection.getSelectedItemKeys();\n        if (!this._compareKeys(oldKeys, newKeys)) {\n          this._selection.setSelection(newKeys);\n        }\n      }\n    }\n    return new _deferred.Deferred().resolve().promise();\n  },\n  _itemClickHandler: function _itemClickHandler(e) {\n    this._createAction(function (e) {\n      this._itemSelectHandler(e.event);\n    }.bind(this), {\n      validatingTargetName: \"itemElement\"\n    })({\n      itemElement: (0, _renderer2.default)(e.currentTarget),\n      event: e\n    });\n    this.callBase.apply(this, arguments);\n  },\n  _itemSelectHandler: function _itemSelectHandler(e) {\n    if (!this.option(\"selectionByClick\")) {\n      return;\n    }\n    var $itemElement = e.currentTarget;\n    if (this.isItemSelected($itemElement)) {\n      this.unselectItem(e.currentTarget);\n    } else {\n      this.selectItem(e.currentTarget);\n    }\n  },\n  _selectedItemElement: function _selectedItemElement(index) {\n    return this._itemElements().eq(index);\n  },\n  _postprocessRenderItem: function _postprocessRenderItem(args) {\n    if (\"none\" !== this.option(\"selectionMode\")) {\n      var $itemElement = (0, _renderer2.default)(args.itemElement),\n        normalizedItemIndex = this._editStrategy.getNormalizedIndex($itemElement),\n        isItemSelected = this._isItemSelected(normalizedItemIndex);\n      this._processSelectableItem($itemElement, isItemSelected);\n    }\n  },\n  _processSelectableItem: function _processSelectableItem($itemElement, isSelected) {\n    $itemElement.toggleClass(this._selectedItemClass(), isSelected);\n    this._setAriaSelected($itemElement, String(isSelected));\n  },\n  _updateSelectedItems: function _updateSelectedItems(args) {\n    var that = this,\n      addedItemKeys = args.addedItemKeys,\n      removedItemKeys = args.removedItemKeys;\n    if (that._rendered && (addedItemKeys.length || removedItemKeys.length)) {\n      var selectionChangePromise = that._selectionChangePromise;\n      if (!that._rendering) {\n        var normalizedIndex,\n          i,\n          addedSelection = [],\n          removedSelection = [];\n        that._editStrategy.beginCache();\n        for (i = 0; i < addedItemKeys.length; i++) {\n          normalizedIndex = that._getIndexByKey(addedItemKeys[i]);\n          addedSelection.push(normalizedIndex);\n          that._addSelection(normalizedIndex);\n        }\n        for (i = 0; i < removedItemKeys.length; i++) {\n          normalizedIndex = that._getIndexByKey(removedItemKeys[i]);\n          removedSelection.push(normalizedIndex);\n          that._removeSelection(normalizedIndex);\n        }\n        that._editStrategy.endCache();\n        that._updateSelection(addedSelection, removedSelection);\n      }\n      (0, _deferred.when)(selectionChangePromise).done(function () {\n        that._fireSelectionChangeEvent(args.addedItems, args.removedItems);\n      });\n    }\n  },\n  _fireSelectionChangeEvent: function _fireSelectionChangeEvent(addedItems, removedItems) {\n    this._createActionByOption(\"onSelectionChanged\", {\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    })({\n      addedItems: addedItems,\n      removedItems: removedItems\n    });\n  },\n  _updateSelection: _common.noop,\n  _setAriaSelected: function _setAriaSelected($target, value) {\n    this.setAria(\"selected\", value, $target);\n  },\n  _removeSelection: function _removeSelection(normalizedIndex) {\n    var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\n    if (indexExists(normalizedIndex)) {\n      this._processSelectableItem($itemElement, false);\n      _events_engine2.default.triggerHandler($itemElement, \"stateChanged\", false);\n    }\n  },\n  _showDeprecatedSelectionMode: function _showDeprecatedSelectionMode() {\n    _ui2.default.log(\"W0001\", this.NAME, \"selectionMode: 'multi'\", \"16.1\", \"Use selectionMode: 'multiple' instead\");\n    this.option(\"selectionMode\", \"multiple\");\n  },\n  _addSelection: function _addSelection(normalizedIndex) {\n    var $itemElement = this._editStrategy.getItemElement(normalizedIndex);\n    if (indexExists(normalizedIndex)) {\n      this._processSelectableItem($itemElement, true);\n      _events_engine2.default.triggerHandler($itemElement, \"stateChanged\", true);\n    }\n  },\n  _isItemSelected: function _isItemSelected(index) {\n    var key = this._getKeyByIndex(index);\n    return this._selection.isItemSelected(key);\n  },\n  _optionChanged: function _optionChanged(args) {\n    var _this2 = this;\n    switch (args.name) {\n      case \"selectionMode\":\n        if (\"multi\" === args.value) {\n          this._showDeprecatedSelectionMode();\n        } else {\n          this._invalidate();\n        }\n        break;\n      case \"dataSource\":\n        if (!args.value || Array.isArray(args.value) && !args.value.length) {\n          this.option(\"selectedItemKeys\", []);\n        }\n        this.callBase(args);\n        break;\n      case \"selectedIndex\":\n      case \"selectedItem\":\n      case \"selectedItems\":\n      case \"selectedItemKeys\":\n        this._syncSelectionOptions(args.name).done(function () {\n          return _this2._normalizeSelectedItems();\n        });\n        break;\n      case \"keyExpr\":\n        this._initKeyGetter();\n        break;\n      case \"selectionRequired\":\n        this._normalizeSelectedItems();\n        break;\n      case \"selectionByClick\":\n      case \"onSelectionChanged\":\n      case \"onItemDeleting\":\n      case \"onItemDeleted\":\n      case \"onItemReordered\":\n      case \"maxFilterLengthInRequest\":\n        break;\n      default:\n        this.callBase(args);\n    }\n  },\n  _clearSelectedItems: function _clearSelectedItems() {\n    this._setOptionSilent(\"selectedItems\", []);\n    this._syncSelectionOptions(\"selectedItems\");\n  },\n  _waitDeletingPrepare: function _waitDeletingPrepare($itemElement) {\n    if ($itemElement.data(ITEM_DELETING_DATA_KEY)) {\n      return new _deferred.Deferred().resolve().promise();\n    }\n    $itemElement.data(ITEM_DELETING_DATA_KEY, true);\n    var deferred = new _deferred.Deferred(),\n      deletingActionArgs = {\n        cancel: false\n      },\n      deletePromise = this._itemEventHandler($itemElement, \"onItemDeleting\", deletingActionArgs, {\n        excludeValidators: [\"disabled\", \"readOnly\"]\n      });\n    (0, _deferred.when)(deletePromise).always(function (value) {\n      var deletePromiseExists = !deletePromise,\n        deletePromiseResolved = !deletePromiseExists && \"resolved\" === deletePromise.state(),\n        argumentsSpecified = !!arguments.length,\n        shouldDelete = deletePromiseExists || deletePromiseResolved && !argumentsSpecified || deletePromiseResolved && value;\n      (0, _deferred.when)((0, _deferred.fromPromise)(deletingActionArgs.cancel)).always(function () {\n        $itemElement.data(ITEM_DELETING_DATA_KEY, false);\n      }).done(function (cancel) {\n        shouldDelete && !cancel ? deferred.resolve() : deferred.reject();\n      }).fail(deferred.reject);\n    }.bind(this));\n    return deferred.promise();\n  },\n  _deleteItemFromDS: function _deleteItemFromDS($item) {\n    if (!this._dataSource) {\n      return new _deferred.Deferred().resolve().promise();\n    }\n    var deferred = new _deferred.Deferred(),\n      disabledState = this.option(\"disabled\"),\n      dataStore = this._dataSource.store();\n    this.option(\"disabled\", true);\n    if (!dataStore.remove) {\n      throw _ui2.default.Error(\"E1011\");\n    }\n    dataStore.remove(dataStore.keyOf(this._getItemData($item))).done(function (key) {\n      if (void 0 !== key) {\n        deferred.resolve();\n      } else {\n        deferred.reject();\n      }\n    }).fail(function () {\n      deferred.reject();\n    });\n    deferred.always(function () {\n      this.option(\"disabled\", disabledState);\n    }.bind(this));\n    return deferred;\n  },\n  _tryRefreshLastPage: function _tryRefreshLastPage() {\n    var deferred = new _deferred.Deferred();\n    if (this._isLastPage() || this.option(\"grouped\")) {\n      deferred.resolve();\n    } else {\n      this._refreshLastPage().done(function () {\n        deferred.resolve();\n      });\n    }\n    return deferred.promise();\n  },\n  _refreshLastPage: function _refreshLastPage() {\n    this._expectLastItemLoading();\n    return this._dataSource.load();\n  },\n  _updateSelectionAfterDelete: function _updateSelectionAfterDelete(index) {\n    var key = this._getKeyByIndex(index);\n    this._selection.deselect([key]);\n  },\n  _updateIndicesAfterIndex: function _updateIndicesAfterIndex(index) {\n    var itemElements = this._itemElements();\n    for (var i = index + 1; i < itemElements.length; i++) {\n      (0, _renderer2.default)(itemElements[i]).data(this._itemIndexKey(), i - 1);\n    }\n  },\n  _simulateOptionChange: function _simulateOptionChange(optionName) {\n    var optionValue = this.option(optionName);\n    if (optionValue instanceof _data_source.DataSource) {\n      return;\n    }\n    this._optionChangedAction({\n      name: optionName,\n      fullName: optionName,\n      value: optionValue\n    });\n  },\n  isItemSelected: function isItemSelected(itemElement) {\n    return this._isItemSelected(this._editStrategy.getNormalizedIndex(itemElement));\n  },\n  selectItem: function selectItem(itemElement) {\n    if (\"none\" === this.option(\"selectionMode\")) {\n      return;\n    }\n    var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\n    if (!indexExists(itemIndex)) {\n      return;\n    }\n    var key = this._getKeyByIndex(itemIndex);\n    if (this._selection.isItemSelected(key)) {\n      return;\n    }\n    if (\"single\" === this.option(\"selectionMode\")) {\n      this._selection.setSelection([key]);\n    } else {\n      var selectedItemKeys = this.option(\"selectedItemKeys\");\n      selectedItemKeys.push(key);\n      this._selection.setSelection(selectedItemKeys);\n    }\n  },\n  unselectItem: function unselectItem(itemElement) {\n    var itemIndex = this._editStrategy.getNormalizedIndex(itemElement);\n    if (!indexExists(itemIndex)) {\n      return;\n    }\n    var selectedItemKeys = this._selection.getSelectedItemKeys();\n    if (this.option(\"selectionRequired\") && selectedItemKeys.length <= 1) {\n      return;\n    }\n    var key = this._getKeyByIndex(itemIndex);\n    if (!this._selection.isItemSelected(key)) {\n      return;\n    }\n    this._selection.deselect([key]);\n  },\n  _deleteItemElementByIndex: function _deleteItemElementByIndex(index) {\n    this._updateSelectionAfterDelete(index);\n    this._updateIndicesAfterIndex(index);\n    this._editStrategy.deleteItemAtIndex(index);\n  },\n  _afterItemElementDeleted: function _afterItemElementDeleted($item, deletedActionArgs) {\n    var changingOption = this._dataSource ? \"dataSource\" : \"items\";\n    this._simulateOptionChange(changingOption);\n    this._itemEventHandler($item, \"onItemDeleted\", deletedActionArgs, {\n      beforeExecute: function beforeExecute() {\n        $item.remove();\n      },\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n    this._renderEmptyMessage();\n  },\n  deleteItem: function deleteItem(itemElement) {\n    var that = this,\n      deferred = new _deferred.Deferred(),\n      $item = this._editStrategy.getItemElement(itemElement),\n      index = this._editStrategy.getNormalizedIndex(itemElement),\n      itemResponseWaitClass = this._itemResponseWaitClass();\n    if (indexExists(index)) {\n      this._waitDeletingPrepare($item).done(function () {\n        $item.addClass(itemResponseWaitClass);\n        var deletedActionArgs = that._extendActionArgs($item);\n        that._deleteItemFromDS($item).done(function () {\n          that._deleteItemElementByIndex(index);\n          that._afterItemElementDeleted($item, deletedActionArgs);\n          that._tryRefreshLastPage().done(function () {\n            deferred.resolveWith(that);\n          });\n        }).fail(function () {\n          $item.removeClass(itemResponseWaitClass);\n          deferred.rejectWith(that);\n        });\n      }).fail(function () {\n        deferred.rejectWith(that);\n      });\n    } else {\n      deferred.rejectWith(that);\n    }\n    return deferred.promise();\n  },\n  reorderItem: function reorderItem(itemElement, toItemElement) {\n    var deferred = new _deferred.Deferred(),\n      that = this,\n      strategy = this._editStrategy,\n      $movingItem = strategy.getItemElement(itemElement),\n      $destinationItem = strategy.getItemElement(toItemElement),\n      movingIndex = strategy.getNormalizedIndex(itemElement),\n      destinationIndex = strategy.getNormalizedIndex(toItemElement),\n      changingOption = this._dataSource ? \"dataSource\" : \"items\";\n    var canMoveItems = indexExists(movingIndex) && indexExists(destinationIndex) && movingIndex !== destinationIndex;\n    if (canMoveItems) {\n      deferred.resolveWith(this);\n    } else {\n      deferred.rejectWith(this);\n    }\n    return deferred.promise().done(function () {\n      $destinationItem[strategy.itemPlacementFunc(movingIndex, destinationIndex)]($movingItem);\n      strategy.moveItemAtIndexToIndex(movingIndex, destinationIndex);\n      this._updateIndicesAfterIndex(movingIndex);\n      that.option(\"selectedItems\", that._getItemsByKeys(that._selection.getSelectedItemKeys(), that._selection.getSelectedItems()));\n      if (\"items\" === changingOption) {\n        that._simulateOptionChange(changingOption);\n      }\n      that._itemEventHandler($movingItem, \"onItemReordered\", {\n        fromIndex: strategy.getIndex(movingIndex),\n        toIndex: strategy.getIndex(destinationIndex)\n      }, {\n        excludeValidators: [\"disabled\", \"readOnly\"]\n      });\n    });\n  }\n});\nmodule.exports = CollectionWidget;","map":null,"metadata":{},"sourceType":"script"}