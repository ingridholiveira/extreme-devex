{"ast":null,"code":"/**\r\n * DevExtreme (ui/data_grid/ui.data_grid.grouping.collapsed.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _extend = require(\"../../core/utils/extend\");\nvar _iterator = require(\"../../core/utils/iterator\");\nvar _uiData_grid = require(\"./ui.data_grid.core\");\nvar _uiData_gridGrouping = require(\"./ui.data_grid.grouping.core\");\nvar _uiData_grid2 = require(\"./ui.data_grid.utils\");\nvar _ui = require(\"../widget/ui.errors\");\nvar _ui2 = _interopRequireDefault(_ui);\nvar _errors = require(\"../../data/errors\");\nvar _deferred = require(\"../../core/utils/deferred\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nexports.GroupingHelper = _uiData_gridGrouping.GroupingHelper.inherit(function () {\n  var foreachExpandedGroups = function foreachExpandedGroups(that, callback, updateGroups) {\n    return that.foreachGroups(function (groupInfo, parents) {\n      if (groupInfo.isExpanded) {\n        return callback(groupInfo, parents);\n      }\n    }, true, false, updateGroups, updateGroups);\n  };\n  var processGroupItems = function processGroupItems(that, items, groupsCount, expandedInfo, path, isCustomLoading, isLastGroupExpanded) {\n    var i, item, groupInfo, isExpanded;\n    expandedInfo.items = expandedInfo.items || [];\n    expandedInfo.paths = expandedInfo.paths || [];\n    expandedInfo.count = expandedInfo.count || 0;\n    expandedInfo.lastCount = expandedInfo.lastCount || 0;\n    if (!groupsCount) {\n      return;\n    }\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n      if (void 0 !== item.items) {\n        path.push(item.key);\n        if (isCustomLoading) {\n          isExpanded = true;\n        } else {\n          groupInfo = that.findGroupInfo(path);\n          isExpanded = groupInfo && groupInfo.isExpanded;\n        }\n        if (!isExpanded) {\n          item.collapsedItems = item.items;\n          item.items = null;\n        } else {\n          if (item.items) {\n            processGroupItems(that, item.items, groupsCount - 1, expandedInfo, path, isCustomLoading, isLastGroupExpanded);\n          } else {\n            if (1 === groupsCount && item.count && (!isCustomLoading || isLastGroupExpanded)) {\n              expandedInfo.items.push(item);\n              expandedInfo.paths.push(path.slice(0));\n              expandedInfo.count += expandedInfo.lastCount;\n              expandedInfo.lastCount = item.count;\n            }\n          }\n        }\n        path.pop();\n      }\n    }\n  };\n  var updateGroupInfoItem = function updateGroupInfoItem(that, item, isLastGroupLevel, path, offset) {\n    var count,\n      groupInfo = that.findGroupInfo(path);\n    if (!groupInfo) {\n      if (isLastGroupLevel) {\n        count = item.count > 0 ? item.count : item.items.length;\n      }\n      that.addGroupInfo({\n        isExpanded: that._isGroupExpanded(path.length - 1),\n        path: path.slice(0),\n        offset: offset,\n        count: count || 0\n      });\n    } else {\n      if (isLastGroupLevel) {\n        groupInfo.count = item.count > 0 ? item.count : item.items && item.items.length || 0;\n      } else {\n        item.count = groupInfo.count || item.count;\n      }\n      groupInfo.offset = offset;\n    }\n  };\n  var updateGroupInfos = function updateGroupInfos(that, options, items, loadedGroupCount, groupIndex, path, parentIndex) {\n    var item,\n      count,\n      i,\n      groupCount = options.group ? options.group.length : 0,\n      isLastGroupLevel = groupCount === loadedGroupCount,\n      remotePaging = options.remoteOperations.paging,\n      offset = 0,\n      totalCount = 0;\n    groupIndex = groupIndex || 0;\n    path = path || [];\n    if (remotePaging && !parentIndex) {\n      offset = 0 === groupIndex ? options.skip || 0 : options.skips[groupIndex - 1] || 0;\n    }\n    if (groupIndex >= loadedGroupCount) {\n      return items.length;\n    }\n    for (i = 0; i < items.length; i++) {\n      item = items[i];\n      if (item) {\n        path.push(item.key);\n        if (!item.count && !item.items || void 0 === item.items) {\n          return -1;\n        }\n        updateGroupInfoItem(that, item, isLastGroupLevel, path, offset + i);\n        count = item.items ? updateGroupInfos(that, options, item.items, loadedGroupCount, groupIndex + 1, path, i) : item.count || -1;\n        if (count < 0) {\n          return -1;\n        }\n        totalCount += count;\n        path.pop();\n      }\n    }\n    return totalCount;\n  };\n  var isGroupExpanded = function isGroupExpanded(groups, groupIndex) {\n    return groups && groups.length && groups[groupIndex] && !!groups[groupIndex].isExpanded;\n  };\n  var getTotalOffset = function getTotalOffset(groupInfos, pageSize, offset) {\n    var groupIndex,\n      groupSize,\n      totalOffset = offset;\n    for (groupIndex = 0; groupIndex < groupInfos.length; groupIndex++) {\n      groupSize = groupInfos[groupIndex].offset + 1;\n      if (groupIndex > 0) {\n        groupSize += groupInfos[groupIndex - 1].childrenTotalCount;\n        if (pageSize) {\n          groupSize += getContinuationGroupCount(totalOffset, pageSize, groupSize, groupIndex - 1) * groupIndex;\n        }\n      }\n      totalOffset += groupSize;\n    }\n    return totalOffset;\n  };\n  var getContinuationGroupCount = function getContinuationGroupCount(groupOffset, pageSize, groupSize, groupIndex) {\n    groupIndex = groupIndex || 0;\n    if (pageSize > 1 && groupSize > 0) {\n      var pageOffset = groupOffset - Math.floor(groupOffset / pageSize) * pageSize || pageSize;\n      pageOffset += groupSize - groupIndex - 2;\n      if (pageOffset < 0) {\n        pageOffset += pageSize;\n      }\n      return Math.floor(pageOffset / (pageSize - groupIndex - 1));\n    }\n    return 0;\n  };\n  function applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex) {\n    var item = expandedInfo.items[expandedItemIndex],\n      skip = options.skips && options.skips[groupLevel],\n      take = options.takes && options.takes[groupLevel],\n      isLastExpandedItem = expandedItemIndex === expandedInfo.items.length - 1,\n      isFirstExpandedItem = 0 === expandedItemIndex,\n      lastExpandedItemSkip = isFirstExpandedItem && skip || 0,\n      isItemsTruncatedByTake = item.count > take + lastExpandedItemSkip;\n    if (isFirstExpandedItem && void 0 !== skip) {\n      item.isContinuation = true;\n    }\n    if (isLastExpandedItem && void 0 !== take && isItemsTruncatedByTake) {\n      item.isContinuationOnNextPage = true;\n    }\n  }\n  function fillSkipTakeInExpandedInfo(options, expandedInfo, currentGroupCount) {\n    var currentGroupIndex = currentGroupCount - 1,\n      groupCount = options.group ? options.group.length : 0;\n    expandedInfo.skip = options.skips && options.skips[currentGroupIndex];\n    if (options.takes && void 0 !== options.takes[currentGroupIndex]) {\n      if (groupCount === currentGroupCount) {\n        expandedInfo.take = expandedInfo.count ? expandedInfo.count - (expandedInfo.skip || 0) : 0;\n      } else {\n        expandedInfo.take = 0;\n      }\n      expandedInfo.take += options.takes[currentGroupIndex];\n    }\n  }\n  function isDataDeferred(data) {\n    return !Array.isArray(data);\n  }\n  function makeDataDeferred(options) {\n    if (!isDataDeferred(options.data)) {\n      options.data = new _deferred.Deferred();\n    }\n  }\n  function loadGroupItems(that, options, loadedGroupCount, expandedInfo, groupLevel, data) {\n    if (!options.isCustomLoading) {\n      expandedInfo = {};\n      processGroupItems(that, data, loadedGroupCount, expandedInfo, []);\n      fillSkipTakeInExpandedInfo(options, expandedInfo, loadedGroupCount);\n    }\n    var groupCount = options.group ? options.group.length : 0;\n    if (expandedInfo.paths.length && groupCount - loadedGroupCount > 0) {\n      makeDataDeferred(options);\n      loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data);\n    } else {\n      if (expandedInfo.paths.length && options.storeLoadOptions.group) {\n        makeDataDeferred(options);\n        loadLastLevelGroupItems(that, options, expandedInfo, data);\n      } else {\n        if (isDataDeferred(options.data)) {\n          options.data.resolve(data);\n        }\n      }\n    }\n  }\n  function loadExpandedGroups(that, options, expandedInfo, loadedGroupCount, groupLevel, data) {\n    var groups = options.group || [],\n      currentGroup = groups[groupLevel + 1],\n      deferreds = [];\n    (0, _iterator.each)(expandedInfo.paths, function (expandedItemIndex) {\n      var loadOptions = {\n        requireTotalCount: false,\n        requireGroupCount: true,\n        group: [currentGroup],\n        groupSummary: options.storeLoadOptions.groupSummary,\n        filter: (0, _uiData_grid2.createGroupFilter)(expandedInfo.paths[expandedItemIndex], {\n          filter: options.storeLoadOptions.filter,\n          group: groups\n        })\n      };\n      if (0 === expandedItemIndex) {\n        loadOptions.skip = expandedInfo.skip || 0;\n      }\n      if (expandedItemIndex === expandedInfo.paths.length - 1) {\n        loadOptions.take = expandedInfo.take;\n      }\n      var loadResult = 0 === loadOptions.take ? [] : that._dataSource.loadFromStore(loadOptions);\n      (0, _deferred.when)(loadResult).done(function (data) {\n        var item = expandedInfo.items[expandedItemIndex];\n        applyContinuationToGroupItem(options, expandedInfo, groupLevel, expandedItemIndex);\n        item.items = data;\n      });\n      deferreds.push(loadResult);\n    });\n    _deferred.when.apply(null, deferreds).done(function () {\n      updateGroupInfos(that, options, data, loadedGroupCount + 1);\n      loadGroupItems(that, options, loadedGroupCount + 1, expandedInfo, groupLevel + 1, data);\n    });\n  }\n  function loadLastLevelGroupItems(that, options, expandedInfo, data) {\n    var expandedFilters = [],\n      groups = options.group || [];\n    (0, _iterator.each)(expandedInfo.paths, function (_, expandedPath) {\n      expandedFilters.push((0, _uiData_grid2.createGroupFilter)(expandedPath, {\n        group: options.isCustomLoading ? options.storeLoadOptions.group : groups\n      }));\n    });\n    var filter = options.storeLoadOptions.filter;\n    if (!options.storeLoadOptions.isLoadingAll) {\n      filter = (0, _uiData_grid.combineFilters)([filter, (0, _uiData_grid.combineFilters)(expandedFilters, \"or\")]);\n    }\n    var loadOptions = (0, _extend.extend)({}, options.storeLoadOptions, {\n      requireTotalCount: false,\n      requireGroupCount: false,\n      group: null,\n      sort: groups.concat((0, _uiData_grid.normalizeSortingInfo)(options.storeLoadOptions.sort || [])),\n      filter: filter\n    });\n    var isPagingLocal = that._dataSource.isLastLevelGroupItemsPagingLocal();\n    if (!isPagingLocal) {\n      loadOptions.skip = expandedInfo.skip;\n      loadOptions.take = expandedInfo.take;\n    }\n    (0, _deferred.when)(0 === expandedInfo.take ? [] : that._dataSource.loadFromStore(loadOptions)).done(function (items, extra) {\n      if (isPagingLocal) {\n        items = that._dataSource.sortLastLevelGroupItems(items, groups, expandedInfo.paths);\n        items = expandedInfo.skip ? items.slice(expandedInfo.skip) : items;\n        items = expandedInfo.take ? items.slice(0, expandedInfo.take) : items;\n      }\n      (0, _iterator.each)(expandedInfo.items, function (index, item) {\n        var itemCount = item.count - (0 === index && expandedInfo.skip || 0),\n          expandedItems = items.splice(0, itemCount);\n        applyContinuationToGroupItem(options, expandedInfo, groups.length - 1, index);\n        item.items = expandedItems;\n      });\n      options.data.resolve(data);\n    }).fail(options.data.reject);\n  }\n  var loadGroupTotalCount = function loadGroupTotalCount(dataSource, options) {\n    var d = new _deferred.Deferred(),\n      isGrouping = !!(options.group && options.group.length),\n      loadOptions = (0, _extend.extend)({\n        skip: 0,\n        take: 1,\n        requireGroupCount: isGrouping,\n        requireTotalCount: !isGrouping\n      }, options, {\n        group: isGrouping ? options.group : null\n      });\n    dataSource.load(loadOptions).done(function (data, extra) {\n      var count = extra && (isGrouping ? extra.groupCount : extra.totalCount);\n      if (!isFinite(count)) {\n        throw _errors.errors.Error(isGrouping ? \"E4022\" : \"E4021\");\n      }\n      d.resolve(count);\n    }).fail(d.reject.bind(d));\n    return d;\n  };\n  return {\n    updateTotalItemsCount: function updateTotalItemsCount(options) {\n      var totalItemsCount = 0,\n        totalCount = options.extra && options.extra.totalCount || 0,\n        groupCount = options.extra && options.extra.groupCount || 0,\n        pageSize = this._dataSource.pageSize(),\n        isVirtualPaging = this._isVirtualPaging();\n      foreachExpandedGroups(this, function (groupInfo) {\n        groupInfo.childrenTotalCount = 0;\n      });\n      foreachExpandedGroups(this, function (groupInfo, parents) {\n        var totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, totalItemsCount),\n          count = groupInfo.count + groupInfo.childrenTotalCount;\n        if (!isVirtualPaging) {\n          count += getContinuationGroupCount(totalOffset, pageSize, count, parents.length - 1);\n        }\n        if (parents[parents.length - 2]) {\n          parents[parents.length - 2].childrenTotalCount += count;\n        } else {\n          totalItemsCount += count;\n        }\n      });\n      this.callBase(totalItemsCount - totalCount + groupCount);\n    },\n    _isGroupExpanded: function _isGroupExpanded(groupIndex) {\n      var groups = this._dataSource.group();\n      return isGroupExpanded(groups, groupIndex);\n    },\n    _updatePagingOptions: function _updatePagingOptions(options, callback) {\n      var that = this,\n        isVirtualPaging = that._isVirtualPaging(),\n        pageSize = that._dataSource.pageSize(),\n        skips = [],\n        takes = [],\n        skipChildrenTotalCount = 0,\n        childrenTotalCount = 0;\n      if (options.take) {\n        foreachExpandedGroups(this, function (groupInfo) {\n          groupInfo.childrenTotalCount = 0;\n          groupInfo.skipChildrenTotalCount = 0;\n        });\n        foreachExpandedGroups(that, function (groupInfo, parents) {\n          var skip,\n            take,\n            takeCorrection = 0,\n            parentTakeCorrection = 0,\n            totalOffset = getTotalOffset(parents, isVirtualPaging ? 0 : pageSize, childrenTotalCount),\n            continuationGroupCount = 0,\n            skipContinuationGroupCount = 0,\n            groupInfoCount = groupInfo.count + groupInfo.childrenTotalCount,\n            childrenGroupInfoCount = groupInfoCount;\n          callback && callback(groupInfo, totalOffset);\n          skip = options.skip - totalOffset;\n          if (totalOffset <= options.skip + options.take && groupInfoCount) {\n            take = options.take;\n            if (!isVirtualPaging) {\n              continuationGroupCount = getContinuationGroupCount(totalOffset, pageSize, groupInfoCount, parents.length - 1);\n              groupInfoCount += continuationGroupCount * parents.length;\n              childrenGroupInfoCount += continuationGroupCount;\n              if (pageSize && skip >= 0) {\n                takeCorrection = parents.length;\n                parentTakeCorrection = parents.length - 1;\n                skipContinuationGroupCount = Math.floor(skip / pageSize);\n              }\n            }\n            if (skip >= 0) {\n              if (totalOffset + groupInfoCount > options.skip) {\n                skips.unshift(skip - skipContinuationGroupCount * takeCorrection - groupInfo.skipChildrenTotalCount);\n              }\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take - takeCorrection - groupInfo.childrenTotalCount + groupInfo.skipChildrenTotalCount);\n              }\n            } else {\n              if (totalOffset + groupInfoCount >= options.skip + take) {\n                takes.unshift(take + skip - groupInfo.childrenTotalCount);\n              }\n            }\n          }\n          if (totalOffset <= options.skip) {\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1 - skipContinuationGroupCount * parentTakeCorrection);\n            } else {\n              skipChildrenTotalCount += Math.min(childrenGroupInfoCount, skip + 1);\n            }\n          }\n          if (totalOffset <= options.skip + take) {\n            groupInfoCount = Math.min(childrenGroupInfoCount, skip + take - (skipContinuationGroupCount + 1) * parentTakeCorrection);\n            if (parents[parents.length - 2]) {\n              parents[parents.length - 2].childrenTotalCount += groupInfoCount;\n            } else {\n              childrenTotalCount += groupInfoCount;\n            }\n          }\n        });\n        options.skip -= skipChildrenTotalCount;\n        options.take -= childrenTotalCount - skipChildrenTotalCount;\n      }\n      options.skips = skips;\n      options.takes = takes;\n    },\n    changeRowExpand: function changeRowExpand(path) {\n      var that = this,\n        groupInfo = that.findGroupInfo(path),\n        dataSource = that._dataSource,\n        remoteGroupPaging = dataSource.remoteOperations().groupPaging,\n        groups = (0, _uiData_grid.normalizeSortingInfo)(dataSource.group());\n      if (groupInfo) {\n        groupInfo.isExpanded = !groupInfo.isExpanded;\n        if (remoteGroupPaging && groupInfo.isExpanded && path.length < groups.length) {\n          return loadGroupTotalCount(dataSource, {\n            filter: (0, _uiData_grid2.createGroupFilter)(path, {\n              filter: dataSource.filter(),\n              group: dataSource.group()\n            }),\n            group: [groups[path.length]]\n          }).done(function (groupCount) {\n            groupInfo.count = groupCount;\n          });\n        }\n        return new _deferred.Deferred().resolve();\n      }\n      return new _deferred.Deferred().reject();\n    },\n    handleDataLoading: function handleDataLoading(options) {\n      var that = this,\n        storeLoadOptions = options.storeLoadOptions,\n        groups = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.group || options.loadOptions.group);\n      if (options.isCustomLoading || !groups.length) {\n        return;\n      }\n      if (options.remoteOperations.grouping) {\n        var remotePaging = that._dataSource.remoteOperations().paging;\n        storeLoadOptions.group = (0, _uiData_grid.normalizeSortingInfo)(storeLoadOptions.group);\n        storeLoadOptions.group.forEach(function (group, index) {\n          var isLastGroup = index === storeLoadOptions.group.length - 1;\n          group.isExpanded = !remotePaging || !isLastGroup;\n        });\n      }\n      options.group = options.group || groups;\n      if (options.remoteOperations.paging) {\n        options.skip = storeLoadOptions.skip;\n        options.take = storeLoadOptions.take;\n        storeLoadOptions.requireGroupCount = true;\n        storeLoadOptions.group = groups.slice(0, 1);\n        that._updatePagingOptions(options);\n        storeLoadOptions.skip = options.skip;\n        storeLoadOptions.take = options.take;\n      } else {\n        that.foreachGroups(function (groupInfo) {\n          groupInfo.count = 0;\n        });\n      }\n    },\n    handleDataLoadedCore: function handleDataLoadedCore(options, callBase) {\n      var totalCount,\n        that = this,\n        loadedGroupCount = (0, _uiData_grid.normalizeSortingInfo)(options.storeLoadOptions.group || options.loadOptions.group).length,\n        groupCount = options.group ? options.group.length : 0,\n        expandedInfo = {};\n      if (options.isCustomLoading) {\n        callBase(options);\n        processGroupItems(that, options.data, loadedGroupCount, expandedInfo, [], options.isCustomLoading, options.storeLoadOptions.isLoadingAll);\n      } else {\n        totalCount = updateGroupInfos(that, options, options.data, loadedGroupCount);\n        if (totalCount < 0) {\n          throw _ui2.default.Error(\"E1037\");\n        }\n        if (!options.remoteOperations.paging) {\n          if (loadedGroupCount && options.extra && options.loadOptions.requireTotalCount) {\n            options.extra.totalCount = totalCount;\n            options.extra.groupCount = options.data.length;\n          }\n        }\n        if (groupCount && options.storeLoadOptions.requireGroupCount && !isFinite(options.extra.groupCount)) {\n          throw _errors.errors.Error(\"E4022\");\n        }\n        that.updateTotalItemsCount(options);\n        if (!options.remoteOperations.paging) {\n          that._updatePagingOptions(options);\n        }\n        callBase(options);\n        if (!options.remoteOperations.paging) {\n          that._processPaging(options, loadedGroupCount);\n        }\n      }\n      loadGroupItems(that, options, loadedGroupCount, expandedInfo, 0, options.data);\n    },\n    _processSkips: function _processSkips(items, skips, groupCount) {\n      if (!groupCount) {\n        return;\n      }\n      var firstItem = items[0],\n        skip = skips[0],\n        children = firstItem && firstItem.items;\n      if (void 0 !== skip) {\n        firstItem.isContinuation = true;\n        if (children) {\n          firstItem.items = children.slice(skip);\n          this._processSkips(firstItem.items, skips.slice(1), groupCount - 1);\n        }\n      }\n    },\n    _processTakes: function _processTakes(items, skips, takes, groupCount, parents) {\n      if (!groupCount || !items) {\n        return;\n      }\n      parents = parents || [];\n      var lastItem = items[items.length - 1],\n        children = lastItem && lastItem.items,\n        take = takes[0],\n        skip = skips[0];\n      if (lastItem) {\n        var maxTakeCount = lastItem.count - (lastItem.isContinuation && skip || 0) || children.length;\n        if (void 0 !== take && maxTakeCount > take) {\n          lastItem.isContinuationOnNextPage = true;\n          parents.forEach(function (parent) {\n            parent.isContinuationOnNextPage = true;\n          });\n          if (children) {\n            children = children.slice(0, take);\n            lastItem.items = children;\n          }\n        }\n        parents.push(lastItem);\n        this._processTakes(children, skips.slice(1), takes.slice(1), groupCount - 1, parents);\n      }\n    },\n    _processPaging: function _processPaging(options, groupCount) {\n      this._processSkips(options.data, options.skips, groupCount);\n      this._processTakes(options.data, options.skips, options.takes, groupCount);\n    },\n    isLastLevelGroupItemsPagingLocal: function isLastLevelGroupItemsPagingLocal() {\n      return false;\n    },\n    sortLastLevelGroupItems: function sortLastLevelGroupItems(items) {\n      return items;\n    },\n    refresh: function refresh(options, isReload, operationTypes) {\n      var isExpanded,\n        groupIndex,\n        that = this,\n        dataSource = that._dataSource,\n        storeLoadOptions = options.storeLoadOptions,\n        group = options.group || options.storeLoadOptions.group,\n        oldGroups = (0, _uiData_grid.normalizeSortingInfo)(that._group);\n      function handleGroup(groupInfo, parents) {\n        if (parents.length === groupIndex + 1) {\n          groupInfo.isExpanded = isExpanded;\n        }\n      }\n      for (groupIndex = 0; groupIndex < oldGroups.length; groupIndex++) {\n        isExpanded = isGroupExpanded(group, groupIndex);\n        if (isGroupExpanded(that._group, groupIndex) !== isExpanded) {\n          that.foreachGroups(handleGroup);\n        }\n      }\n      that.callBase.apply(this, arguments);\n      if (group && options.remoteOperations.paging && (isReload || operationTypes.reload)) {\n        return foreachExpandedGroups(that, function (groupInfo) {\n          var groupCountQuery = loadGroupTotalCount(dataSource, {\n              filter: (0, _uiData_grid2.createGroupFilter)(groupInfo.path, {\n                filter: storeLoadOptions.filter,\n                group: group\n              }),\n              group: group.slice(groupInfo.path.length)\n            }),\n            groupOffsetQuery = loadGroupTotalCount(dataSource, {\n              filter: (0, _uiData_gridGrouping.createOffsetFilter)(groupInfo.path, {\n                filter: storeLoadOptions.filter,\n                group: group\n              }),\n              group: group.slice(groupInfo.path.length - 1, 1)\n            });\n          return (0, _deferred.when)(groupOffsetQuery, groupCountQuery).done(function (offset, count) {\n            offset = parseInt(offset.length ? offset[0] : offset);\n            count = parseInt(count.length ? count[0] : count);\n            groupInfo.offset = offset;\n            if (groupInfo.count !== count) {\n              groupInfo.count = count;\n              that.updateTotalItemsCount(options);\n            }\n          });\n        }, true);\n      }\n    }\n  };\n}());","map":null,"metadata":{},"sourceType":"script"}