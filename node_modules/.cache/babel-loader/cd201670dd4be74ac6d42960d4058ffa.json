{"ast":null,"code":"/**\r\n * DevExtreme (ui/drop_down_menu.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../core/renderer\"),\n  window = require(\"../core/utils/window\").getWindow(),\n  devices = require(\"../core/devices\"),\n  registerComponent = require(\"../core/component_registrator\"),\n  extend = require(\"../core/utils/extend\").extend,\n  Widget = require(\"./widget/ui.widget\"),\n  Button = require(\"./button\"),\n  Popover = require(\"./popover\"),\n  DataHelperMixin = require(\"../data_helper\"),\n  List = require(\"./list\"),\n  themes = require(\"./themes\"),\n  ChildDefaultTemplate = require(\"../core/templates/child_default_template\").ChildDefaultTemplate;\nvar DROP_DOWN_MENU_CLASS = \"dx-dropdownmenu\",\n  DROP_DOWN_MENU_POPUP_CLASS = \"dx-dropdownmenu-popup\",\n  DROP_DOWN_MENU_POPUP_WRAPPER_CLASS = \"dx-dropdownmenu-popup-wrapper\",\n  DROP_DOWN_MENU_LIST_CLASS = \"dx-dropdownmenu-list\",\n  DROP_DOWN_MENU_BUTTON_CLASS = \"dx-dropdownmenu-button\";\nvar POPUP_OPTION_MAP = {\n  popupWidth: \"width\",\n  popupHeight: \"height\",\n  popupMaxHeight: \"maxHeight\",\n  popupAutoResizeEnabled: \"autoResizeEnabled\"\n};\nvar BUTTON_OPTION_MAP = {\n  buttonIcon: \"icon\",\n  buttonText: \"text\",\n  buttonWidth: \"width\",\n  buttonHeight: \"height\",\n  buttonTemplate: \"template\"\n};\nvar DropDownMenu = Widget.inherit({\n  _supportedKeys: function _supportedKeys() {\n    var extension = {};\n    if (!this.option(\"opened\") || !this._list.option(\"focusedElement\")) {\n      extension = this._button._supportedKeys();\n    }\n    return extend(this.callBase(), extension, {\n      tab: function tab() {\n        this._popup && this._popup.hide();\n      }\n    });\n  },\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      items: [],\n      onItemClick: null,\n      dataSource: null,\n      itemTemplate: \"item\",\n      buttonText: \"\",\n      buttonIcon: \"overflow\",\n      buttonWidth: void 0,\n      buttonHeight: void 0,\n      buttonTemplate: \"content\",\n      onButtonClick: null,\n      usePopover: false,\n      popupWidth: \"auto\",\n      popupHeight: \"auto\",\n      activeStateEnabled: true,\n      hoverStateEnabled: true,\n      opened: false,\n      deferRendering: false,\n      popupPosition: {\n        my: \"top center\",\n        at: \"bottom center\",\n        collision: \"fit flip\",\n        offset: {\n          v: 1\n        }\n      },\n      popupAnimation: void 0,\n      onItemRendered: null,\n      menuWidget: List,\n      popupMaxHeight: void 0,\n      closeOnClick: true,\n      useInkRipple: false,\n      container: void 0,\n      popupAutoResizeEnabled: false\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: {\n        platform: \"ios\"\n      },\n      options: {\n        usePopover: true\n      }\n    }, {\n      device: {\n        platform: \"generic\"\n      },\n      options: {\n        popupPosition: {\n          offset: {\n            v: 4\n          }\n        }\n      }\n    }, {\n      device: function device() {\n        return \"desktop\" === devices.real().deviceType && !devices.isSimulator();\n      },\n      options: {\n        focusStateEnabled: true\n      }\n    }, {\n      device: {\n        platform: \"android\"\n      },\n      options: {\n        popupPosition: {\n          my: \"top \" + (this.option(\"rtlEnabled\") ? \"left\" : \"right\"),\n          at: \"top \" + (this.option(\"rtlEnabled\") ? \"left\" : \"right\"),\n          collision: \"flipfit\"\n        },\n        popupAnimation: {\n          show: {\n            type: \"pop\",\n            duration: 200,\n            from: {\n              scale: 0\n            },\n            to: {\n              scale: 1\n            }\n          },\n          hide: {\n            type: \"pop\",\n            duration: 200,\n            from: {\n              scale: 1\n            },\n            to: {\n              scale: 0\n            }\n          }\n        }\n      }\n    }, {\n      device: function device() {\n        return themes.isMaterial();\n      },\n      options: {\n        useInkRipple: true\n      }\n    }]);\n  },\n  _initOptions: function _initOptions(options) {\n    if (\"android\" === devices.current().platform) {\n      if (!options.popupPosition) {\n        options.popupPosition = {\n          at: (options.usePopover ? \"bottom \" : \"top \") + (options.rtlEnabled ? \"left\" : \"right\")\n        };\n      }\n    }\n    this.callBase(options);\n  },\n  _dataSourceOptions: function _dataSourceOptions() {\n    return {\n      paginate: false\n    };\n  },\n  _init: function _init() {\n    this.callBase();\n    this.$element().addClass(DROP_DOWN_MENU_CLASS);\n    this._initDataSource();\n    this._initItemClickAction();\n    this._initButtonClickAction();\n  },\n  _initItemClickAction: function _initItemClickAction() {\n    this._itemClickAction = this._createActionByOption(\"onItemClick\");\n  },\n  _initButtonClickAction: function _initButtonClickAction() {\n    this._buttonClickAction = this._createActionByOption(\"onButtonClick\");\n  },\n  _initTemplates: function _initTemplates() {\n    this.callBase();\n    this._defaultTemplates.content = new ChildDefaultTemplate(\"content\");\n  },\n  _initMarkup: function _initMarkup() {\n    this._renderButton();\n    this.callBase();\n  },\n  _render: function _render() {\n    this.callBase();\n    this.setAria({\n      role: \"menubar\",\n      haspopup: true,\n      expanded: this.option(\"opened\")\n    });\n  },\n  _renderContentImpl: function _renderContentImpl() {\n    if (this.option(\"opened\")) {\n      this._renderPopup();\n    }\n  },\n  _clean: function _clean() {\n    this._cleanFocusState();\n    if (this._popup) {\n      this._popup.$element().remove();\n      delete this._$popup;\n    }\n  },\n  _renderButton: function _renderButton() {\n    var $button = this.$element().addClass(DROP_DOWN_MENU_BUTTON_CLASS),\n      config = this._buttonOptions();\n    this._button = this._createComponent($button, Button, config);\n  },\n  _toggleActiveState: function _toggleActiveState($element, value, e) {\n    this._button._toggleActiveState($element, value, e);\n  },\n  _buttonOptions: function _buttonOptions() {\n    return {\n      text: this.option(\"buttonText\"),\n      icon: this.option(\"buttonIcon\"),\n      width: this.option(\"buttonWidth\"),\n      height: this.option(\"buttonHeight\"),\n      useInkRipple: this.option(\"useInkRipple\"),\n      template: this.option(\"buttonTemplate\"),\n      focusStateEnabled: false,\n      onClick: function (e) {\n        this.option(\"opened\", !this.option(\"opened\"));\n        this._buttonClickAction(e);\n      }.bind(this)\n    };\n  },\n  _toggleMenuVisibility: function _toggleMenuVisibility(opened) {\n    var state = void 0 === opened ? !this._popup.option(\"visible\") : opened;\n    if (opened) {\n      this._renderPopup();\n    }\n    this._popup.toggle(state);\n    this.setAria(\"expanded\", state);\n  },\n  _renderPopup: function _renderPopup() {\n    if (this._$popup) {\n      return;\n    }\n    var $popup = this._$popup = $(\"<div>\").appendTo(this.$element()),\n      config = this._popupOptions();\n    this._popup = this._createComponent($popup, Popover, config);\n  },\n  _popupOptions: function _popupOptions() {\n    var usePopup = !this.option(\"usePopover\");\n    return {\n      onInitialized: function onInitialized(args) {\n        args.component._wrapper().addClass(DROP_DOWN_MENU_POPUP_WRAPPER_CLASS).toggleClass(DROP_DOWN_MENU_POPUP_CLASS, usePopup);\n      },\n      visible: this.option(\"opened\"),\n      deferRendering: false,\n      contentTemplate: function (contentElement) {\n        this._renderList(contentElement);\n      }.bind(this),\n      position: this.option(\"popupPosition\"),\n      animation: this.option(\"popupAnimation\"),\n      onOptionChanged: function (args) {\n        if (\"visible\" === args.name) {\n          this.option(\"opened\", args.value);\n        }\n      }.bind(this),\n      target: this.$element(),\n      height: this.option(\"popupHeight\"),\n      width: this.option(\"popupWidth\"),\n      maxHeight: this.option(\"popupMaxHeight\"),\n      container: this.option(\"container\"),\n      autoResizeEnabled: this.option(\"popupAutoResizeEnabled\")\n    };\n  },\n  _renderList: function _renderList(contentElement) {\n    var $content = $(contentElement),\n      listConfig = this._listOptions();\n    $content.addClass(DROP_DOWN_MENU_LIST_CLASS);\n    this._list = this._createComponent($content, this.option(\"menuWidget\"), listConfig);\n    this._list._getAriaTarget = function () {\n      return this.$element();\n    }.bind(this);\n    this._setListDataSource();\n    var listMaxHeight = .5 * $(window).height();\n    if ($content.height() > listMaxHeight) {\n      $content.height(listMaxHeight);\n    }\n  },\n  _listOptions: function _listOptions() {\n    return {\n      _keyboardProcessor: this._listProcessor,\n      pageLoadMode: \"scrollBottom\",\n      indicateLoading: false,\n      noDataText: \"\",\n      itemTemplate: this.option(\"itemTemplate\"),\n      onItemClick: function (e) {\n        if (this.option(\"closeOnClick\")) {\n          this.option(\"opened\", false);\n        }\n        this._itemClickAction(e);\n      }.bind(this),\n      tabIndex: -1,\n      focusStateEnabled: this.option(\"focusStateEnabled\"),\n      activeStateEnabled: this.option(\"activeStateEnabled\"),\n      onItemRendered: this.option(\"onItemRendered\"),\n      _itemAttributes: {\n        role: \"menuitem\"\n      }\n    };\n  },\n  _setListDataSource: function _setListDataSource() {\n    if (this._list) {\n      this._list.option(\"dataSource\", this._dataSource || this.option(\"items\"));\n    }\n    delete this._deferRendering;\n  },\n  _attachKeyboardEvents: function _attachKeyboardEvents() {\n    this.callBase.apply(this, arguments);\n    this._listProcessor = this._keyboardProcessor && this._keyboardProcessor.attachChildProcessor();\n    if (this._list) {\n      this._list.option(\"_keyboardProcessor\", this._listProcessor);\n    }\n  },\n  _cleanFocusState: function _cleanFocusState() {\n    this.callBase.apply(this, arguments);\n    delete this._listProcessor;\n  },\n  _toggleVisibility: function _toggleVisibility(visible) {\n    this.callBase(visible);\n    this._button.option(\"visible\", visible);\n  },\n  _optionChanged: function _optionChanged(args) {\n    var name = args.name;\n    var value = args.value;\n    switch (name) {\n      case \"items\":\n      case \"dataSource\":\n        if (this.option(\"deferRendering\") && !this.option(\"opened\")) {\n          this._deferRendering = true;\n        } else {\n          this._refreshDataSource();\n          this._setListDataSource();\n        }\n        break;\n      case \"itemTemplate\":\n        if (this._list) {\n          this._list.option(name, this._getTemplate(value));\n        }\n        break;\n      case \"onItemClick\":\n        this._initItemClickAction();\n        break;\n      case \"onButtonClick\":\n        this._buttonClickAction();\n        break;\n      case \"buttonIcon\":\n      case \"buttonText\":\n      case \"buttonWidth\":\n      case \"buttonHeight\":\n      case \"buttonTemplate\":\n        this._button.option(BUTTON_OPTION_MAP[name], value);\n        this._renderPopup();\n        break;\n      case \"popupWidth\":\n      case \"popupHeight\":\n      case \"popupMaxHeight\":\n      case \"popupAutoResizeEnabled\":\n        this._popup.option(POPUP_OPTION_MAP[name], value);\n        break;\n      case \"usePopover\":\n      case \"menuWidget\":\n      case \"useInkRipple\":\n        this._invalidate();\n        break;\n      case \"focusStateEnabled\":\n      case \"activeStateEnabled\":\n        if (this._list) {\n          this._list.option(name, value);\n        }\n        this.callBase(args);\n        break;\n      case \"onItemRendered\":\n        if (this._list) {\n          this._list.option(name, value);\n        }\n        break;\n      case \"opened\":\n        if (this._deferRendering) {\n          this._refreshDataSource();\n          this._setListDataSource();\n        }\n        this._toggleMenuVisibility(value);\n        break;\n      case \"deferRendering\":\n      case \"popupPosition\":\n      case \"closeOnClick\":\n        break;\n      case \"container\":\n        this._popup && this._popup.option(args.name, args.value);\n        break;\n      default:\n        this.callBase(args);\n    }\n  },\n  open: function open() {\n    this.option(\"opened\", true);\n  },\n  close: function close() {\n    this.option(\"opened\", false);\n  }\n}).include(DataHelperMixin);\nregisterComponent(\"dxDropDownMenu\", DropDownMenu);\nmodule.exports = DropDownMenu;","map":null,"metadata":{},"sourceType":"script"}