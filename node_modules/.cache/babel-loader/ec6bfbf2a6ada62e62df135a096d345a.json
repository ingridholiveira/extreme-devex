{"ast":null,"code":"/**\r\n * DevExtreme (ui/grid_core/ui.grid_core.selection.js)\r\n * Version: 19.2.2\r\n * Build date: Tue Oct 01 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _renderer = require(\"../../core/renderer\");\nvar _renderer2 = _interopRequireDefault(_renderer);\nvar _events_engine = require(\"../../events/core/events_engine\");\nvar _events_engine2 = _interopRequireDefault(_events_engine);\nvar _uiData_grid = require(\"../data_grid/ui.data_grid.core\");\nvar _uiData_grid2 = _interopRequireDefault(_uiData_grid);\nvar _uiGrid_core = require(\"./ui.grid_core.utils\");\nvar _type = require(\"../../core/utils/type\");\nvar _iterator = require(\"../../core/utils/iterator\");\nvar _extend = require(\"../../core/utils/extend\");\nvar _support = require(\"../../core/utils/support\");\nvar _support2 = _interopRequireDefault(_support);\nvar _click = require(\"../../events/click\");\nvar _click2 = _interopRequireDefault(_click);\nvar _message = require(\"../../localization/message\");\nvar _message2 = _interopRequireDefault(_message);\nvar _utils = require(\"../../events/utils\");\nvar _hold = require(\"../../events/hold\");\nvar _hold2 = _interopRequireDefault(_hold);\nvar _selection = require(\"../selection/selection\");\nvar _selection2 = _interopRequireDefault(_selection);\nvar _deferred = require(\"../../core/utils/deferred\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\",\n  ROW_CLASS = \"dx-row\",\n  ROW_SELECTION_CLASS = \"dx-selection\",\n  SELECT_CHECKBOX_CLASS = \"dx-select-checkbox\",\n  CHECKBOXES_HIDDEN_CLASS = \"dx-select-checkboxes-hidden\",\n  COMMAND_SELECT_CLASS = \"dx-command-select\",\n  SELECTION_DISABLED_CLASS = \"dx-selection-disabled\",\n  DATA_ROW_CLASS = \"dx-data-row\";\nvar SHOW_CHECKBOXES_MODE = \"selection.showCheckBoxesMode\",\n  SELECTION_MODE = \"selection.mode\";\nvar processLongTap = function processLongTap(that, dxEvent) {\n  var selectionController = that.getController(\"selection\"),\n    rowsView = that.getView(\"rowsView\"),\n    $row = (0, _renderer2.default)(dxEvent.target).closest(\".\" + DATA_ROW_CLASS),\n    rowIndex = rowsView.getRowIndex($row);\n  if (rowIndex < 0) {\n    return;\n  }\n  if (\"onLongTap\" === that.option(SHOW_CHECKBOXES_MODE)) {\n    if (selectionController.isSelectionWithCheckboxes()) {\n      selectionController.stopSelectionWithCheckboxes();\n    } else {\n      selectionController.startSelectionWithCheckboxes();\n    }\n  } else {\n    if (\"onClick\" === that.option(SHOW_CHECKBOXES_MODE)) {\n      selectionController.startSelectionWithCheckboxes();\n    }\n    if (\"always\" !== that.option(SHOW_CHECKBOXES_MODE)) {\n      selectionController.changeItemSelection(rowIndex, {\n        control: true\n      });\n    }\n  }\n};\nexports.SelectionController = _uiData_grid2.default.Controller.inherit(function () {\n  var isSeveralRowsSelected = function isSeveralRowsSelected(that, selectionFilter) {\n    var keyIndex = 0,\n      store = that._dataController.store(),\n      key = store && store.key(),\n      isComplexKey = Array.isArray(key);\n    if (!selectionFilter.length) {\n      return false;\n    }\n    if (isComplexKey && Array.isArray(selectionFilter[0]) && \"and\" === selectionFilter[1]) {\n      for (var i = 0; i < selectionFilter.length; i++) {\n        if (Array.isArray(selectionFilter[i])) {\n          if (selectionFilter[i][0] !== key[keyIndex] || \"=\" !== selectionFilter[i][1]) {\n            return true;\n          }\n          keyIndex++;\n        }\n      }\n      return false;\n    }\n    return key !== selectionFilter[0];\n  };\n  var selectionCellTemplate = function selectionCellTemplate(container, options) {\n    var rowsView = options.component.getView(\"rowsView\");\n    rowsView.renderSelectCheckBoxContainer((0, _renderer2.default)(container), options);\n  };\n  var selectionHeaderTemplate = function selectionHeaderTemplate(container, options) {\n    var column = options.column,\n      $cellElement = (0, _renderer2.default)(container),\n      columnHeadersView = options.component.getView(\"columnHeadersView\");\n    $cellElement.addClass(EDITOR_CELL_CLASS);\n    columnHeadersView._renderSelectAllCheckBox($cellElement, column);\n    columnHeadersView._attachSelectAllCheckBoxClickEvent($cellElement);\n  };\n  return {\n    init: function init() {\n      this._dataController = this.getController(\"data\");\n      this._selectionMode = this.option(SELECTION_MODE);\n      this._isSelectionWithCheckboxes = false;\n      this._selection = this._createSelection();\n      this._updateSelectColumn();\n      this.createAction(\"onSelectionChanged\", {\n        excludeValidators: [\"disabled\", \"readOnly\"]\n      });\n    },\n    _getSelectionConfig: function _getSelectionConfig() {\n      var that = this,\n        dataController = that._dataController,\n        selectionOptions = that.option(\"selection\") || {};\n      return {\n        selectedKeys: that.option(\"selectedRowKeys\"),\n        mode: that._selectionMode,\n        deferred: selectionOptions.deferred,\n        maxFilterLengthInRequest: selectionOptions.maxFilterLengthInRequest,\n        selectionFilter: that.option(\"selectionFilter\"),\n        key: function key() {\n          return dataController && dataController.key();\n        },\n        keyOf: function keyOf(item) {\n          return dataController && dataController.keyOf(item);\n        },\n        dataFields: function dataFields() {\n          return dataController.dataSource() && dataController.dataSource().select();\n        },\n        load: function load(options) {\n          return dataController.dataSource() && dataController.dataSource().load(options) || new _deferred.Deferred().resolve([]);\n        },\n        plainItems: function plainItems() {\n          return dataController.items(true);\n        },\n        isItemSelected: function isItemSelected(item) {\n          return item.selected;\n        },\n        isSelectableItem: function isSelectableItem(item) {\n          return item && \"data\" === item.rowType && !item.isNewRow;\n        },\n        getItemData: function getItemData(item) {\n          return item && (item.oldData || item.data || item);\n        },\n        filter: function filter() {\n          return dataController.getCombinedFilter();\n        },\n        totalCount: function totalCount() {\n          return dataController.totalCount();\n        },\n        onSelectionChanged: that._updateSelectedItems.bind(this)\n      };\n    },\n    _updateSelectColumn: function _updateSelectColumn() {\n      var columnsController = this.getController(\"columns\"),\n        isSelectColumnVisible = this.isSelectColumnVisible();\n      columnsController.addCommandColumn({\n        type: \"selection\",\n        command: \"select\",\n        visible: isSelectColumnVisible,\n        visibleIndex: -1,\n        dataType: \"boolean\",\n        alignment: \"center\",\n        cssClass: COMMAND_SELECT_CLASS,\n        width: \"auto\",\n        cellTemplate: selectionCellTemplate,\n        headerCellTemplate: selectionHeaderTemplate\n      });\n      columnsController.columnOption(\"command:select\", \"visible\", isSelectColumnVisible);\n    },\n    _createSelection: function _createSelection() {\n      var options = this._getSelectionConfig();\n      return new _selection2.default(options);\n    },\n    _fireSelectionChanged: function _fireSelectionChanged(options) {\n      if (options) {\n        this.executeAction(\"onSelectionChanged\", options);\n      }\n      var argument = this.option(\"selection.deferred\") ? {\n        selectionFilter: this.option(\"selectionFilter\")\n      } : {\n        selectedRowKeys: this.option(\"selectedRowKeys\")\n      };\n      this.selectionChanged.fire(argument);\n    },\n    _updateCheckboxesState: function _updateCheckboxesState(options) {\n      var isDeferredMode = options.isDeferredMode,\n        selectionFilter = options.selectionFilter,\n        selectedItemKeys = options.selectedItemKeys,\n        removedItemKeys = options.removedItemKeys;\n      if (\"onClick\" === this.option(SHOW_CHECKBOXES_MODE)) {\n        if (isDeferredMode ? selectionFilter && isSeveralRowsSelected(this, selectionFilter) : selectedItemKeys.length > 1) {\n          this.startSelectionWithCheckboxes();\n        } else {\n          if (isDeferredMode ? selectionFilter && !selectionFilter.length : 0 === selectedItemKeys.length && removedItemKeys.length) {\n            this.stopSelectionWithCheckboxes();\n          }\n        }\n      }\n    },\n    _updateSelectedItems: function _updateSelectedItems(args) {\n      var selectionChangedOptions,\n        that = this,\n        isDeferredMode = that.option(\"selection.deferred\"),\n        selectionFilter = that._selection.selectionFilter(),\n        dataController = that._dataController,\n        items = dataController.items();\n      if (!items) {\n        return;\n      }\n      var isSelectionWithCheckboxes = that.isSelectionWithCheckboxes();\n      var changedItemIndexes = that.getChangedItemIndexes(items);\n      that._updateCheckboxesState({\n        selectedItemKeys: args.selectedItemKeys,\n        removedItemKeys: args.removedItemKeys,\n        selectionFilter: selectionFilter,\n        isDeferredMode: isDeferredMode\n      });\n      if (changedItemIndexes.length || isSelectionWithCheckboxes !== that.isSelectionWithCheckboxes()) {\n        dataController.updateItems({\n          changeType: \"updateSelection\",\n          itemIndexes: changedItemIndexes\n        });\n      }\n      if (isDeferredMode) {\n        that.option(\"selectionFilter\", selectionFilter);\n        selectionChangedOptions = {};\n      } else {\n        if (args.addedItemKeys.length || args.removedItemKeys.length) {\n          that._selectedItemsInternalChange = true;\n          that.option(\"selectedRowKeys\", args.selectedItemKeys.slice(0));\n          that._selectedItemsInternalChange = false;\n          selectionChangedOptions = {\n            selectedRowsData: args.selectedItems.slice(0),\n            selectedRowKeys: args.selectedItemKeys.slice(0),\n            currentSelectedRowKeys: args.addedItemKeys.slice(0),\n            currentDeselectedRowKeys: args.removedItemKeys.slice(0)\n          };\n        }\n      }\n      that._fireSelectionChanged(selectionChangedOptions);\n    },\n    getChangedItemIndexes: function getChangedItemIndexes(items) {\n      var that = this,\n        itemIndexes = [],\n        isDeferredSelection = this.option(\"selection.deferred\");\n      for (var i = 0, length = items.length; i < length; i++) {\n        var row = items[i];\n        var isItemSelected = that.isRowSelected(isDeferredSelection ? row.data : row.key);\n        if (that._selection.isDataItem(row) && row.isSelected !== isItemSelected) {\n          itemIndexes.push(i);\n        }\n      }\n      return itemIndexes;\n    },\n    callbackNames: function callbackNames() {\n      return [\"selectionChanged\"];\n    },\n    optionChanged: function optionChanged(args) {\n      var that = this;\n      that.callBase(args);\n      switch (args.name) {\n        case \"selection\":\n          var oldSelectionMode = that._selectionMode;\n          that.init();\n          var selectionMode = that._selectionMode;\n          var selectedRowKeys = that.option(\"selectedRowKeys\");\n          if (oldSelectionMode !== selectionMode) {\n            if (\"single\" === selectionMode) {\n              if (selectedRowKeys.length > 1) {\n                selectedRowKeys = [selectedRowKeys[0]];\n              }\n            } else {\n              if (\"multiple\" !== selectionMode) {\n                selectedRowKeys = [];\n              }\n            }\n          }\n          that.selectRows(selectedRowKeys).always(function () {\n            that._fireSelectionChanged();\n          });\n          that.getController(\"columns\").updateColumns();\n          args.handled = true;\n          break;\n        case \"selectionFilter\":\n          this._selection.selectionFilter(args.value);\n          args.handled = true;\n          break;\n        case \"selectedRowKeys\":\n          var value = args.value || [];\n          if (Array.isArray(value) && !that._selectedItemsInternalChange && (that.component.getDataSource() || !value.length)) {\n            that.selectRows(value);\n          }\n          args.handled = true;\n      }\n    },\n    publicMethods: function publicMethods() {\n      return [\"selectRows\", \"deselectRows\", \"selectRowsByIndexes\", \"getSelectedRowKeys\", \"getSelectedRowsData\", \"clearSelection\", \"selectAll\", \"deselectAll\", \"startSelectionWithCheckboxes\", \"stopSelectionWithCheckboxes\", \"isRowSelected\"];\n    },\n    isRowSelected: function isRowSelected(arg) {\n      return this._selection.isItemSelected(arg);\n    },\n    isSelectColumnVisible: function isSelectColumnVisible() {\n      return \"multiple\" === this.option(SELECTION_MODE) && (\"always\" === this.option(SHOW_CHECKBOXES_MODE) || \"onClick\" === this.option(SHOW_CHECKBOXES_MODE) || this._isSelectionWithCheckboxes);\n    },\n    _isOnePageSelectAll: function _isOnePageSelectAll() {\n      return \"page\" === this.option(\"selection.selectAllMode\");\n    },\n    isSelectAll: function isSelectAll() {\n      return this._selection.getSelectAllState(this._isOnePageSelectAll());\n    },\n    selectAll: function selectAll() {\n      if (\"onClick\" === this.option(SHOW_CHECKBOXES_MODE)) {\n        this.startSelectionWithCheckboxes();\n      }\n      return this._selection.selectAll(this._isOnePageSelectAll());\n    },\n    deselectAll: function deselectAll() {\n      return this._selection.deselectAll(this._isOnePageSelectAll());\n    },\n    clearSelection: function clearSelection() {\n      return this.selectedItemKeys([]);\n    },\n    refresh: function refresh() {\n      var selectedRowKeys = this.option(\"selectedRowKeys\") || [];\n      if (!this.option(\"selection.deferred\") && selectedRowKeys.length) {\n        return this.selectedItemKeys(selectedRowKeys);\n      }\n      return new _deferred.Deferred().resolve().promise();\n    },\n    selectedItemKeys: function selectedItemKeys(value, preserve, isDeselect, isSelectAll) {\n      return this._selection.selectedItemKeys(value, preserve, isDeselect, isSelectAll);\n    },\n    getSelectedRowKeys: function getSelectedRowKeys() {\n      return this._selection.getSelectedItemKeys();\n    },\n    selectRows: function selectRows(keys, preserve) {\n      return this.selectedItemKeys(keys, preserve);\n    },\n    deselectRows: function deselectRows(keys) {\n      return this.selectedItemKeys(keys, true, true);\n    },\n    selectRowsByIndexes: function selectRowsByIndexes(indexes) {\n      var items = this._dataController.items(),\n        keys = [];\n      if (!Array.isArray(indexes)) {\n        indexes = Array.prototype.slice.call(arguments, 0);\n      }\n      (0, _iterator.each)(indexes, function () {\n        var item = items[this];\n        if (item && \"data\" === item.rowType) {\n          keys.push(item.key);\n        }\n      });\n      return this.selectRows(keys);\n    },\n    getSelectedRowsData: function getSelectedRowsData() {\n      return this._selection.getSelectedItems();\n    },\n    changeItemSelection: function changeItemSelection(itemIndex, keys) {\n      keys = keys || {};\n      if (this.isSelectionWithCheckboxes()) {\n        keys.control = true;\n      }\n      return this._selection.changeItemSelection(this._dataController.getRowIndexDelta() + itemIndex, keys);\n    },\n    focusedItemIndex: function focusedItemIndex(itemIndex) {\n      var that = this;\n      if ((0, _type.isDefined)(itemIndex)) {\n        that._selection._focusedItemIndex = itemIndex;\n      } else {\n        return that._selection._focusedItemIndex;\n      }\n    },\n    isSelectionWithCheckboxes: function isSelectionWithCheckboxes() {\n      return \"multiple\" === this.option(SELECTION_MODE) && (\"always\" === this.option(SHOW_CHECKBOXES_MODE) || this._isSelectionWithCheckboxes);\n    },\n    startSelectionWithCheckboxes: function startSelectionWithCheckboxes() {\n      var that = this;\n      if (\"multiple\" === that.option(SELECTION_MODE) && !that.isSelectionWithCheckboxes()) {\n        that._isSelectionWithCheckboxes = true;\n        that._updateSelectColumn();\n        return true;\n      }\n      return false;\n    },\n    stopSelectionWithCheckboxes: function stopSelectionWithCheckboxes() {\n      var that = this;\n      if (that._isSelectionWithCheckboxes) {\n        that._isSelectionWithCheckboxes = false;\n        that._updateSelectColumn();\n        return true;\n      }\n      return false;\n    }\n  };\n}());\nmodule.exports = {\n  defaultOptions: function defaultOptions() {\n    return {\n      selection: {\n        mode: \"none\",\n        showCheckBoxesMode: \"onClick\",\n        allowSelectAll: true,\n        selectAllMode: \"allPages\",\n        maxFilterLengthInRequest: 1500,\n        deferred: false\n      },\n      selectionFilter: [],\n      selectedRowKeys: []\n    };\n  },\n  controllers: {\n    selection: exports.SelectionController\n  },\n  extenders: {\n    controllers: {\n      data: {\n        init: function init() {\n          var selectionController = this.getController(\"selection\"),\n            isDeferredMode = this.option(\"selection.deferred\");\n          this.callBase.apply(this, arguments);\n          if (isDeferredMode) {\n            selectionController._updateCheckboxesState({\n              isDeferredMode: true,\n              selectionFilter: this.option(\"selectionFilter\")\n            });\n          }\n        },\n        _loadDataSource: function _loadDataSource() {\n          var that = this;\n          return that.callBase().done(function () {\n            that.getController(\"selection\").refresh();\n          });\n        },\n        _processDataItem: function _processDataItem(item, options) {\n          var that = this,\n            selectionController = that.getController(\"selection\"),\n            hasSelectColumn = selectionController.isSelectColumnVisible(),\n            isDeferredSelection = options.isDeferredSelection = void 0 === options.isDeferredSelection ? this.option(\"selection.deferred\") : options.isDeferredSelection,\n            dataItem = this.callBase.apply(this, arguments);\n          dataItem.isSelected = selectionController.isRowSelected(isDeferredSelection ? dataItem.data : dataItem.key);\n          if (hasSelectColumn && dataItem.values) {\n            for (var i = 0; i < options.visibleColumns.length; i++) {\n              if (\"select\" === options.visibleColumns[i].command) {\n                dataItem.values[i] = dataItem.isSelected;\n                break;\n              }\n            }\n          }\n          return dataItem;\n        },\n        refresh: function refresh(options) {\n          var that = this,\n            d = new _deferred.Deferred();\n          this.callBase.apply(this, arguments).done(function () {\n            if (!options || options.selection) {\n              that.getController(\"selection\").refresh().done(d.resolve).fail(d.reject);\n            } else {\n              d.resolve();\n            }\n          }).fail(d.reject);\n          return d.promise();\n        },\n        _handleDataChanged: function _handleDataChanged(e) {\n          this.callBase.apply(this, arguments);\n          if ((!e || \"refresh\" === e.changeType) && !this._repaintChangesOnly) {\n            this.getController(\"selection\").focusedItemIndex(-1);\n          }\n        },\n        _applyChange: function _applyChange(change) {\n          var _this = this;\n          if (change && \"updateSelection\" === change.changeType) {\n            change.items.forEach(function (item, index) {\n              var currentItem = _this._items[index];\n              if (currentItem) {\n                currentItem.isSelected = item.isSelected;\n                currentItem.values = item.values;\n              }\n            });\n            return;\n          }\n          return this.callBase.apply(this, arguments);\n        },\n        _endUpdateCore: function _endUpdateCore() {\n          var changes = this._changes;\n          var isUpdateSelection = changes.length > 1 && changes.every(function (change) {\n            return \"updateSelection\" === change.changeType;\n          });\n          if (isUpdateSelection) {\n            var itemIndexes = changes.map(function (change) {\n              return change.itemIndexes || [];\n            }).reduce(function (a, b) {\n              return a.concat(b);\n            });\n            this._changes = [{\n              changeType: \"updateSelection\",\n              itemIndexes: itemIndexes\n            }];\n          }\n          this.callBase.apply(this, arguments);\n        }\n      },\n      contextMenu: {\n        _contextMenuPrepared: function _contextMenuPrepared(options) {\n          var dxEvent = options.event;\n          if (dxEvent.originalEvent && \"dxhold\" !== dxEvent.originalEvent.type || options.items && options.items.length > 0) {\n            return;\n          }\n          processLongTap(this, dxEvent);\n        }\n      }\n    },\n    views: {\n      columnHeadersView: {\n        init: function init() {\n          var that = this;\n          that.callBase();\n          that.getController(\"selection\").selectionChanged.add(that._updateSelectAllValue.bind(that));\n        },\n        _updateSelectAllValue: function _updateSelectAllValue() {\n          var that = this,\n            $element = that.element(),\n            $editor = $element && $element.find(\".\" + SELECT_CHECKBOX_CLASS);\n          if ($element && $editor.length && \"multiple\" === that.option(\"selection.mode\")) {\n            $editor.dxCheckBox(\"instance\").option(\"value\", that.getController(\"selection\").isSelectAll());\n          }\n        },\n        _handleDataChanged: function _handleDataChanged(e) {\n          this.callBase(e);\n          if (!e || \"refresh\" === e.changeType) {\n            this._updateSelectAllValue();\n          }\n        },\n        _renderSelectAllCheckBox: function _renderSelectAllCheckBox($container, column) {\n          var groupElement,\n            that = this,\n            selectionController = that.getController(\"selection\");\n          groupElement = (0, _renderer2.default)(\"<div>\").appendTo($container).addClass(SELECT_CHECKBOX_CLASS);\n          that.setAria(\"label\", _message2.default.format(\"dxDataGrid-ariaSelectAll\"), $container);\n          that.getController(\"editorFactory\").createEditor(groupElement, (0, _extend.extend)({}, column, {\n            parentType: \"headerRow\",\n            dataType: \"boolean\",\n            value: selectionController.isSelectAll(),\n            editorOptions: {\n              visible: that.option(\"selection.allowSelectAll\") || false !== selectionController.isSelectAll()\n            },\n            tabIndex: that.option(\"useLegacyKeyboardNavigation\") ? -1 : that.option(\"tabIndex\") || 0,\n            setValue: function setValue(value, e) {\n              var allowSelectAll = that.option(\"selection.allowSelectAll\");\n              e.component.option(\"visible\", allowSelectAll || false !== e.component.option(\"value\"));\n              if (!e.event || selectionController.isSelectAll() === value) {\n                return;\n              }\n              if (e.value && !allowSelectAll) {\n                e.component.option(\"value\", false);\n              } else {\n                e.value ? selectionController.selectAll() : selectionController.deselectAll();\n              }\n              e.event.preventDefault();\n            }\n          }));\n          return groupElement;\n        },\n        _attachSelectAllCheckBoxClickEvent: function _attachSelectAllCheckBoxClickEvent($element) {\n          _events_engine2.default.on($element, _click2.default.name, this.createAction(function (e) {\n            var event = e.event;\n            if (!(0, _renderer2.default)(event.target).closest(\".\" + SELECT_CHECKBOX_CLASS).length) {\n              _events_engine2.default.trigger((0, _renderer2.default)(event.currentTarget).children(\".\" + SELECT_CHECKBOX_CLASS), _click2.default.name);\n            }\n            event.preventDefault();\n          }));\n        }\n      },\n      rowsView: {\n        renderSelectCheckBoxContainer: function renderSelectCheckBoxContainer($container, options) {\n          if (\"data\" === options.rowType && !options.row.isNewRow) {\n            $container.addClass(EDITOR_CELL_CLASS);\n            this._attachCheckBoxClickEvent($container);\n            this.setAria(\"label\", _message2.default.format(\"dxDataGrid-ariaSelectRow\"), $container);\n            this._renderSelectCheckBox($container, options);\n          } else {\n            (0, _uiGrid_core.setEmptyText)($container);\n          }\n        },\n        _renderSelectCheckBox: function _renderSelectCheckBox(container, options) {\n          var groupElement = (0, _renderer2.default)(\"<div>\").addClass(SELECT_CHECKBOX_CLASS).appendTo(container);\n          this.getController(\"editorFactory\").createEditor(groupElement, (0, _extend.extend)({}, options.column, {\n            parentType: \"dataRow\",\n            dataType: \"boolean\",\n            lookup: null,\n            value: options.value,\n            tabIndex: -1,\n            setValue: function setValue(value, e) {\n              if (e && e.event && \"keydown\" === e.event.type) {\n                _events_engine2.default.trigger(container, _click2.default.name, e);\n              }\n            },\n            row: options.row\n          }));\n          return groupElement;\n        },\n        _attachCheckBoxClickEvent: function _attachCheckBoxClickEvent($element) {\n          _events_engine2.default.on($element, _click2.default.name, this.createAction(function (e) {\n            var selectionController = this.getController(\"selection\"),\n              event = e.event,\n              rowIndex = this.getRowIndex((0, _renderer2.default)(event.currentTarget).closest(\".\" + ROW_CLASS));\n            if (rowIndex >= 0) {\n              selectionController.startSelectionWithCheckboxes();\n              selectionController.changeItemSelection(rowIndex, {\n                shift: event.shiftKey\n              });\n              if ((0, _renderer2.default)(event.target).closest(\".\" + SELECT_CHECKBOX_CLASS).length) {\n                this.getController(\"data\").updateItems({\n                  changeType: \"updateSelection\",\n                  itemIndexes: [rowIndex]\n                });\n              }\n            }\n          }));\n        },\n        _update: function _update(change) {\n          var that = this,\n            tableElements = that.getTableElements();\n          if (\"updateSelection\" === change.changeType) {\n            if (tableElements.length > 0) {\n              (0, _iterator.each)(tableElements, function (_, tableElement) {\n                (0, _iterator.each)(change.itemIndexes || [], function (_, index) {\n                  var $row, isSelected;\n                  if (change.items[index]) {\n                    $row = that._getRowElements((0, _renderer2.default)(tableElement)).eq(index);\n                    if ($row.length) {\n                      isSelected = change.items[index].isSelected;\n                      $row.toggleClass(ROW_SELECTION_CLASS, void 0 === isSelected ? false : isSelected).find(\".\" + SELECT_CHECKBOX_CLASS).dxCheckBox(\"option\", \"value\", isSelected);\n                      that.setAria(\"selected\", isSelected, $row);\n                    }\n                  }\n                });\n              });\n              that._updateCheckboxesClass();\n            }\n          } else {\n            that.callBase(change);\n          }\n        },\n        _createTable: function _createTable() {\n          var that = this,\n            selectionMode = that.option(\"selection.mode\"),\n            $table = that.callBase.apply(that, arguments);\n          if (\"none\" !== selectionMode) {\n            if (\"onLongTap\" === that.option(SHOW_CHECKBOXES_MODE) || !_support2.default.touch) {\n              _events_engine2.default.on($table, (0, _utils.addNamespace)(_hold2.default.name, \"dxDataGridRowsView\"), \".\" + DATA_ROW_CLASS, that.createAction(function (e) {\n                processLongTap(that.component, e.event);\n                e.event.stopPropagation();\n              }));\n            }\n            _events_engine2.default.on($table, \"mousedown selectstart\", that.createAction(function (e) {\n              var event = e.event;\n              if (event.shiftKey) {\n                event.preventDefault();\n              }\n            }));\n          }\n          return $table;\n        },\n        _createRow: function _createRow(row) {\n          var isSelected,\n            $row = this.callBase(row);\n          if (row) {\n            isSelected = !!row.isSelected;\n            if (isSelected) {\n              $row.addClass(ROW_SELECTION_CLASS);\n            }\n            this.setAria(\"selected\", isSelected, $row);\n          }\n          return $row;\n        },\n        _rowClick: function _rowClick(e) {\n          var that = this,\n            dxEvent = e.event,\n            isSelectionDisabled = (0, _renderer2.default)(dxEvent.target).closest(\".\" + SELECTION_DISABLED_CLASS).length;\n          if (!that.isClickableElement((0, _renderer2.default)(dxEvent.target))) {\n            if (!isSelectionDisabled && (\"multiple\" !== that.option(SELECTION_MODE) || \"always\" !== that.option(SHOW_CHECKBOXES_MODE))) {\n              if (that.getController(\"selection\").changeItemSelection(e.rowIndex, {\n                control: dxEvent.ctrlKey || dxEvent.metaKey,\n                shift: dxEvent.shiftKey\n              })) {\n                dxEvent.preventDefault();\n                e.handled = true;\n              }\n            }\n            that.callBase(e);\n          }\n        },\n        isClickableElement: function isClickableElement($target) {\n          var isCommandSelect = $target.closest(\".\" + COMMAND_SELECT_CLASS).length;\n          return !!isCommandSelect;\n        },\n        _renderCore: function _renderCore(change) {\n          this.callBase(change);\n          this._updateCheckboxesClass();\n        },\n        _updateCheckboxesClass: function _updateCheckboxesClass() {\n          var tableElements = this.getTableElements(),\n            selectionController = this.getController(\"selection\"),\n            isCheckBoxesHidden = selectionController.isSelectColumnVisible() && !selectionController.isSelectionWithCheckboxes();\n          (0, _iterator.each)(tableElements, function (_, tableElement) {\n            (0, _renderer2.default)(tableElement).toggleClass(CHECKBOXES_HIDDEN_CLASS, isCheckBoxesHidden);\n          });\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}